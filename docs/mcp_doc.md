# MCP 服务 🔧(Model Context Protocol) 服务使用说明文档

**文档更新时间：2026年1月28日**

**Anywhere** 引入了对 **MCP (Model Context Protocol)** 的深度支持。这是一项革命性的功能，它打破了 AI 与物理环境的隔阂。通过 MCP，AI 不再仅仅是一个对话机器人，它可以读取您的本地文件、执行代码、搜索网络、操作数据库，甚至控制其他软件。

本文档将指导您如何配置和使用 MCP 服务，将您的 AI 升级为真正的“智能代理”。

---

## 1. 前置准备 (必读)

在使用 MCP 功能之前，请务必确保您的运行环境满足以下要求，否则服务将无法启动。

### 1.1 环境安装

绝大多数 MCP 服务依赖于 Python 或 Node.js 环境运行。

* **Python 环境**：如果您计划使用 Python 相关的工具（如内置的 Python 执行器），请前往 [Python 官网](https://www.python.org/) 或 [Anaconda官网](https://anaconda.org/)下载、安装。
* **Node.js 环境**：如果您使用的是基于 `npx` 或 JavaScript 编写的 MCP 服务，请前往 [Node.js 官网](https://nodejs.org/) 下载并安装。
* **Git**：部分工具可能需要 Git 支持。

**⚠️ 重要提示：**
安装完上述环境后，**必须完全退出并重启 uTools**，或者**重启您的电脑**，以确保 Anywhere 能够读取到最新的系统环境变量（PATH）。

### 1.2 模型要求

MCP 的核心机制是 **Function Calling (工具调用)**。

* **推荐模型**：Claude, GPT, Gemini等官方模型，这些模型对工具调用的指令遵循度极高。
* **不推荐模型**：早期的开源模型或不支持 Function Calling 的模型。它们可能无法正确触发工具或无法解析工具返回的结果。

---

## 2. 内置 MCP 服务

Anywhere 为了让您开箱即用，预置了一组强大的内置服务。建议您在“MCP 服务”页面中保持它们的**启用**状态。

* **🐍 Python Executor**：自动检测本地 Python 环境，执行数据分析、绘图脚本等。
* **📂 File Operations**：全能文件操作。AI 可以读取、写入、搜索（Grep）、列出（Glob）您电脑上的文件。
* **💻 Shell Executor**：执行终端命令（Bash/PowerShell）。请谨慎授予 AI 此权限。
* **🌐 Web Search**：使用 DuckDuckGo 进行联网搜索，获取实时信息。
* **🤖 Sub-Agent**：子智能体服务。用于处理复杂任务（如 Skill 技能），支持自主规划。

![img](..\image\内置MCP.png)

---

## 3. 添加自定义 MCP 服务

您可以接入社区成千上万的开源 MCP 服务。点击界面底部的 **“+ 添加 MCP 服务”**。

### 3.1 配置类型 (Type)

#### Stdio (标准输入输出)

这是最常见的本地 MCP 类型。Anywhere 会在后台启动一个子进程来运行服务。

* **命令 (Command)**：启动服务的程序，如 `npx`、`python`、`uv`、`docker`。
* **参数 (Args)**：传递给命令的参数，**每行一个**。
  * *示例 (顺序思维 MCP)*：
    * Command: `npx`
    * Args:
      ```text
      -y
      mcp-sequentialthinking-tools
      ```
* **环境变量 (Env)**：如果服务需要 API Key（如 Github MCP），在此处配置 `KEY: VALUE`或者 `KEY=Value`。

![img](..\image\MCP配置界面.png)

#### SSE / HTTP

用于连接远程或本地以 HTTP 服务形式运行的 MCP 服务器。

* **URL**：输入服务的完整地址，如 `http://localhost:3000/sse`。

### 3.2 关键设置

* **持久连接 (Persistent Connection)**：
  * **关闭 (默认)**：按需启动。AI 决定使用工具时启动进程，使用完一段时间后自动销毁，节省资源。
  * **开启 (ON)**：服务启动后常驻后台，不会断开。
  * *适用场景*：需要保持状态的服务（如数据库连接、REPL 环境、或是启动很慢的大型服务）。
  * *注意*：由于 uTools 限制，同时存在的持久连接最多支持 **5个**。

---

## 4. 在对话中使用 MCP

### 4.1 启用服务

在对话窗口的输入框下方工具栏，点击 **🛠️ (MCP工具)** 图标，勾选您本次对话想要赋予 AI 的能力。

* **快捷指令**：在输入框输入 `@` 可以快速筛选并切换 MCP 服务。

### 4.2 AI 如何调用

启用后，您**无需**告诉 AI 具体怎么做。直接用自然语言提出需求，AI 会自动判断并调用工具。

* *用户*：“帮我看看桌面上的 report.txt 里写了什么。”
* *AI (后台)*：自动调用 `read_file` 工具读取文件。
* *AI (回复)*：“文件内容如下：……”
* *用户*：“搜索一下 Anywhwere 插件的最新功能。”
* *AI (后台)*：自动调用 `web_search` 工具。

### 4.3 审批机制 (安全锁)

为了防止 AI 误操作（如删除文件、发送敏感数据），Anywhere 提供了审批机制。

* **手动批准**：默认情况下，当 AI 试图调用工具时，界面会弹出卡片，显示 AI 想要执行的操作和参数。您点击“确认”后才会执行。
* **自动批准**：在 MCP 弹窗底部，勾选 **“自动批准工具调用”**。开启后，AI 的操作将自动执行，体验更流畅，但请确保您信任当前的模型和工具。

---

## 5. 常见问题 (FAQ)

**Q1: 添加了 Stdio 服务，但连接测试一直转圈或失败？**

> **A:**
>
> 1. 请检查 **前置准备** 中的环境是否安装，且 PATH 环境变量已生效（请重启电脑）。
> 2. 如果是 `npx` 命令，请确保您的网络可以访问 npm 镜像源。
> 3. 尝试使用绝对路径。例如在 Windows 上将 `python` 改为 `C:\Python39\python.exe`。

**Q2: 开启了“持久连接”，为什么提示连接数已满？**

> **A:** 为了保证 uTools 的稳定性，Anywhere 限制最多同时存在 **5个** 持久化进程。请在 MCP 列表页面关闭一些不常用的服务的“持久连接”开关（改为按需加载）。

**Q3: 为什么 AI 总是胡乱调用工具或者参数填错？**

> **A:** 这通常取决于 **AI 模型的能力**。请使用御三家一线模型。较弱的模型（如部分 7B 参数的小模型）可能无法理解复杂的工具定义。

**Q4: 我修改了 MCP 的配置，需要重启插件吗？**

> **A:** 不需要。您可以点击 MCP 列表页面右下角的 **“刷新”** 按钮，或者点击卡片上的 **“🔗 (测试连接)”** 按钮来重新加载工具定义。

**Q5: MCP 和 Skill 有什么区别？**

> **A:**
>
> * **MCP** 是**工具 (Tools)**：是 AI 的“手”，提供了原子化的能力（如：读文件、执行命令）。
> * **Skill** 是**流程 (SOP)**：是 AI 的“脑”，是一套定义好的工作流或知识库（如：代码审查规范、周报生成模板）。
> * *关系*：Skill 通常会指导 AI 去调用 MCP 工具来完成任务。

---

**如需更多帮助，请访问我们的开源社区或联系开发者。祝您使用愉快！**

[GITHUB开源项目 AI Anywhere](https://github.com/Komorebi-yaodong/Anywhere)
QQ群：1065512489
