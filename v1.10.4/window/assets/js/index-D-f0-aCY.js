const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./recorder-core-CUxHkEyR.js","./element-plus-B08iKRmn.js","./vendor-utils-Biw9DGem.js","./ChatMessage-CXUcsiEn.js","./mermaid-PPVm8Dsz.js","../css/ChatMessage-DtE-tXAK.css"])))=>i.map(i=>d[i]);
import{c as ve,r as w,o as Gt,a as Qt,b as R,d as E,e as s,f as te,h as l,w as c,u as a,i as za,E as W,m as qt,j as jt,k as at,t as ee,l as ue,n as Yt,p as Me,q as Da,s as Pa,v as Kt,x as Ce,y as Pt,z as Va,A as Vt,B as Ao,C as Ra,D as eo,F as Oa,G as ko,H as zt,I as ht,J as Fa,K as gt,L as we,M as Re,N as nt,O as Na,P as U,Q as Ha,R as Ua,S as Zt,T as X,U as Jt,V as Wa,W as ot,X as qa,Y as fe,Z as $t,_ as So,$ as ja,a0 as Xt,a1 as se,a2 as tt,a3 as Ka,a4 as Za,a5 as Ja,a6 as Ya,a7 as Xa,a8 as $o,a9 as Mo,aa as Ga,ab as Qa,ac as _o,ad as en,ae as tn,af as on,ag as an}from"./element-plus-B08iKRmn.js";import{_ as Mt}from"./mermaid-PPVm8Dsz.js";import{a as Lo,p as To,d as Eo}from"./vendor-utils-Biw9DGem.js";(function(){const B=document.createElement("link").relList;if(B&&B.supports&&B.supports("modulepreload"))return;for(const z of document.querySelectorAll('link[rel="modulepreload"]'))M(z);new MutationObserver(z=>{for(const O of z)if(O.type==="childList")for(const I of O.addedNodes)I.tagName==="LINK"&&I.rel==="modulepreload"&&M(I)}).observe(document,{childList:!0,subtree:!0});function i(z){const O={};return z.integrity&&(O.integrity=z.integrity),z.referrerPolicy&&(O.referrerPolicy=z.referrerPolicy),z.crossOrigin==="use-credentials"?O.credentials="include":z.crossOrigin==="anonymous"?O.credentials="omit":O.credentials="same-origin",O}function M(z){if(z.ep)return;z.ep=!0;const O=i(z);fetch(z.href,O)}})();const _t=(S,B)=>{const i=S.__vccOpts||S;for(const[M,z]of B)i[M]=z;return i},nn={class:"left-container"},ln={key:0,class:"window-controls mac-traffic-lights no-drag"},sn={class:"app-info-inner"},rn=["src"],cn={class:"app-title"},un={key:1,class:"divider-vertical"},dn={class:"conversation-inner"},pn={class:"conversation-title"},fn={class:"right-container"},vn={key:0,class:"function-group no-drag"},mn={key:0,viewBox:"0 0 24 24",width:"16",height:"16"},gn={key:1,viewBox:"0 0 24 24",width:"16",height:"16"},hn={key:0,viewBox:"0 0 24 24",width:"16",height:"16",fill:"none",stroke:"currentColor","stroke-width":"2"},wn={key:1,viewBox:"0 0 24 24",width:"16",height:"16"},yn={key:1,class:"function-group no-drag"},bn={class:"func-btn",title:"Êõ¥Â§öÈÄâÈ°π"},xn={class:"dropdown-text-col"},Cn={class:"dropdown-subtext"},kn={class:"dropdown-check-row"},Sn={class:"dropdown-check-row"},$n={key:2,class:"divider-vertical"},Mn={key:3,class:"window-controls win-controls no-drag"},_n={key:4,class:"window-controls linux-controls no-drag"},Ln={__name:"TitleBar",props:{favicon:String,promptName:String,conversationName:String,isAlwaysOnTop:Boolean,autoCloseOnBlur:Boolean,isDarkMode:Boolean,os:{type:String,default:"win"}},emits:["save-window-size","save-session","toggle-pin","toggle-always-on-top","minimize","maximize","close"],setup(S,{emit:B}){const i=S,M=B,z=ve(()=>i.conversationName||"‰∏¥Êó∂ÂØπËØù"),O=ve(()=>i.os==="macos"||i.os==="darwin"),I=ve(()=>i.os==="win"),_=ve(()=>!O.value&&!I.value),N=w(window.innerWidth),j=ve(()=>N.value<400),J=()=>{N.value=window.innerWidth};return Gt(()=>{window.addEventListener("resize",J)}),Qt(()=>{window.removeEventListener("resize",J)}),(q,y)=>(E(),R("div",{class:Me(["title-bar",[`os-${S.os}`,{"dark-mode":S.isDarkMode}]])},[s("div",nn,[O.value?(E(),R("div",ln,[s("div",{class:"traffic-btn close",onClick:y[0]||(y[0]=P=>M("close"))},[l(a(W),{class:"traffic-icon"},{default:c(()=>[l(a(za))]),_:1})]),s("div",{class:"traffic-btn minimize",onClick:y[1]||(y[1]=P=>M("minimize"))},[l(a(W),{class:"traffic-icon icon-minus"},{default:c(()=>[l(a(qt))]),_:1})]),s("div",{class:"traffic-btn maximize",onClick:y[2]||(y[2]=P=>M("maximize"))},[l(a(W),{class:"traffic-icon icon-fullscreen"},{default:c(()=>[l(a(jt))]),_:1})])])):te("",!0),s("div",{class:"app-info no-drag",onClick:y[3]||(y[3]=P=>M("save-window-size")),onDblclick:y[4]||(y[4]=at(P=>M("maximize"),["stop"]))},[l(a(ue),{content:"ÁÇπÂáª‰øùÂ≠òÂΩìÂâçÁ™óÂè£Â§ßÂ∞è‰∏é‰ΩçÁΩÆ / ÂèåÂáªÂÖ®Â±è",placement:"bottom","show-after":500},{default:c(()=>[s("div",sn,[s("img",{src:S.favicon,class:"app-logo",alt:"Logo"},null,8,rn),s("span",cn,ee(S.promptName||"Anywhere"),1)])]),_:1})],32),j.value?te("",!0):(E(),R("div",un)),j.value?te("",!0):(E(),R("div",{key:2,class:"conversation-info no-drag",onClick:y[5]||(y[5]=P=>M("save-session")),onDblclick:y[6]||(y[6]=at(P=>M("maximize"),["stop"]))},[l(a(ue),{content:"ÁÇπÂáª‰øùÂ≠ò‰ºöËØù",placement:"bottom","show-after":500},{default:c(()=>[s("div",dn,[s("span",pn,ee(z.value),1),l(a(W),{class:"download-icon"},{default:c(()=>[l(a(Yt))]),_:1})])]),_:1})],32))]),s("div",fn,[j.value?(E(),R("div",yn,[l(a(Va),{trigger:"click",placement:"bottom-end","popper-class":"title-bar-dropdown"},{dropdown:c(()=>[l(a(Pa),null,{default:c(()=>[l(a(Kt),{onClick:y[9]||(y[9]=P=>M("save-session"))},{default:c(()=>[l(a(W),null,{default:c(()=>[l(a(Yt))]),_:1}),s("div",xn,[y[22]||(y[22]=s("span",null,"‰øùÂ≠ò/ÈáçÂëΩÂêç",-1)),s("span",Cn,ee(z.value),1)])]),_:1}),l(a(Kt),{onClick:y[10]||(y[10]=P=>M("toggle-pin"))},{default:c(()=>[s("div",kn,[y[23]||(y[23]=s("div",{class:"dropdown-text-col"},[s("span",null,"Â§±ÁÑ¶Ëá™Âä®ÂÖ≥Èó≠")],-1)),S.autoCloseOnBlur?(E(),Ce(a(W),{key:0,class:"check-icon"},{default:c(()=>[l(a(Pt))]),_:1})):te("",!0)])]),_:1}),l(a(Kt),{onClick:y[11]||(y[11]=P=>M("toggle-always-on-top"))},{default:c(()=>[s("div",Sn,[y[24]||(y[24]=s("div",{class:"dropdown-text-col"},[s("span",null,"Á™óÂè£ÁΩÆÈ°∂")],-1)),S.isAlwaysOnTop?(E(),Ce(a(W),{key:0,class:"check-icon"},{default:c(()=>[l(a(Pt))]),_:1})):te("",!0)])]),_:1})]),_:1})]),default:c(()=>[s("div",bn,[l(a(W),null,{default:c(()=>[l(a(Da))]),_:1})])]),_:1})])):(E(),R("div",vn,[l(a(ue),{content:S.autoCloseOnBlur?"Â§±ÁÑ¶Ëá™Âä®ÂÖ≥Èó≠: ÂºÄ":"Â§±ÁÑ¶Ëá™Âä®ÂÖ≥Èó≠: ÂÖ≥",placement:"bottom","show-after":500},{default:c(()=>[s("div",{class:Me(["func-btn",{active:!S.autoCloseOnBlur}]),onClick:y[7]||(y[7]=P=>M("toggle-pin"))},[S.autoCloseOnBlur?(E(),R("svg",gn,y[19]||(y[19]=[s("path",{fill:"currentColor",d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"},null,-1)]))):(E(),R("svg",mn,y[18]||(y[18]=[s("path",{fill:"currentColor",d:"M12 17c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm6-9h-1V7c0-2.76-2.24-5-5-5S7 4.24 7 7v1H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zM8.9 7c0-1.71 1.39-3.1 3.1-3.1s3.1 1.39 3.1 3.1v1H8.9V7z"},null,-1)])))],2)]),_:1},8,["content"]),l(a(ue),{content:S.isAlwaysOnTop?"ÂèñÊ∂àÁΩÆÈ°∂":"ÁΩÆÈ°∂Á™óÂè£",placement:"bottom","show-after":500},{default:c(()=>[s("div",{class:Me(["func-btn",{active:S.isAlwaysOnTop}]),onClick:y[8]||(y[8]=P=>M("toggle-always-on-top"))},[S.isAlwaysOnTop?(E(),R("svg",hn,y[20]||(y[20]=[s("path",{d:"M14.6358 3.90949C15.2888 3.47412 15.6153 3.25643 15.9711 3.29166C16.3269 3.32689 16.6044 3.60439 17.1594 4.15938L19.8406 6.84062C20.3956 7.39561 20.6731 7.67311 20.7083 8.02888C20.7436 8.38465 20.5259 8.71118 20.0905 9.36424L18.4419 11.8372C17.88 12.68 17.5991 13.1013 17.3749 13.5511C17.2086 13.8845 17.0659 14.2292 16.9476 14.5825C16.7882 15.0591 16.6889 15.5557 16.4902 16.5489L16.2992 17.5038C16.2986 17.5072 16.2982 17.5089 16.298 17.5101C16.1556 18.213 15.3414 18.5419 14.7508 18.1351C14.7497 18.1344 14.7483 18.1334 14.7455 18.1315V18.1315C14.7322 18.1223 14.7255 18.1177 14.7189 18.1131C11.2692 15.7225 8.27754 12.7308 5.88691 9.28108C5.88233 9.27448 5.87772 9.26782 5.86851 9.25451V9.25451C5.86655 9.25169 5.86558 9.25028 5.86486 9.24924C5.45815 8.65858 5.78704 7.84444 6.4899 7.70202C6.49113 7.70177 6.49282 7.70144 6.49618 7.70076L7.45114 7.50977C8.44433 7.31113 8.94092 7.21182 9.4175 7.05236C9.77083 6.93415 10.1155 6.79139 10.4489 6.62514C10.8987 6.40089 11.32 6.11998 12.1628 5.55815L14.6358 3.90949Z"},null,-1),s("path",{d:"M5 19L9.5 14.5","stroke-linecap":"round"},null,-1)]))):(E(),R("svg",wn,y[21]||(y[21]=[s("path",{fill:"currentColor",d:"M20,8 L20,5.5 C20,4.67157288 19.3284271,4 18.5,4 L5.5,4 C4.67157288,4 4,4.67157288 4,5.5 L4,8 L20,8 Z M20,9 L4,9 L4,18.5 C4,19.3284271 4.67157288,20 5.5,20 L18.5,20 C19.3284271,20 20,19.3284271 20,18.5 L20,9 Z M3,5.5 C3,4.11928813 4.11928813,3 5.5,3 L18.5,3 C19.8807119,3 21,4.11928813 21,5.5 L21,18.5 C21,19.8807119 19.8807119,21 18.5,21 L5.5,21 C4.11928813,21 3,19.8807119 3,18.5 L3,5.5 Z"},null,-1)])))],2)]),_:1},8,["content"])])),I.value?(E(),R("div",$n)):te("",!0),I.value?(E(),R("div",Mn,[s("div",{class:"win-btn minimize",onClick:y[12]||(y[12]=P=>M("minimize")),title:"ÊúÄÂ∞èÂåñ"},[l(a(W),null,{default:c(()=>[l(a(qt))]),_:1})]),s("div",{class:"win-btn maximize",onClick:y[13]||(y[13]=P=>M("maximize")),title:"ÊúÄÂ§ßÂåñ"},[l(a(W),null,{default:c(()=>[l(a(jt))]),_:1})]),s("div",{class:"win-btn close",onClick:y[14]||(y[14]=P=>M("close")),title:"ÂÖ≥Èó≠"},[l(a(W),null,{default:c(()=>[l(a(Vt))]),_:1})])])):te("",!0),_.value?(E(),R("div",_n,[s("div",{class:"linux-btn minimize",onClick:y[15]||(y[15]=P=>M("minimize"))},[l(a(W),null,{default:c(()=>[l(a(qt))]),_:1})]),s("div",{class:"linux-btn maximize",onClick:y[16]||(y[16]=P=>M("maximize"))},[l(a(W),null,{default:c(()=>[l(a(jt))]),_:1})]),s("div",{class:"linux-btn close",onClick:y[17]||(y[17]=P=>M("close"))},[l(a(W),null,{default:c(()=>[l(a(Vt))]),_:1})])])):te("",!0)])],2))}},Tn=_t(Ln,[["__scopeId","data-v-550c05bf"]]),En={class:"model-header-wrapper"},An={class:"header-content-group"},Bn={class:"expandable-content"},In={class:"model-text"},zn={key:0,class:"model-text prompt-text"},Dn={key:1,class:"model-text prompt-text placeholder"},Pn={__name:"ChatHeader",props:{modelMap:Object,model:String,isMcpLoading:Boolean,systemPrompt:String},emits:["open-model-dialog","show-system-prompt","open-search"],setup(S,{emit:B}){const i=S,M=B,z=I=>{let _=0;for(let q=0;q<I.length;q++)_=I.charCodeAt(q)+((_<<5)-_);const N=Math.abs(_)%360,j=60+Math.abs(_)%20,J=50+Math.abs(_)%10;return`hsl(${N}, ${j}%, ${J}%)`},O=ve(()=>{const I=i.model&&i.model.split("|")[1]||"default";return z(I)});return(I,_)=>(E(),Ce(a(Oa),{class:"model-header"},{default:c(()=>[s("div",En,[s("div",An,[s("div",{class:Me(["model-pill expandable-pill",{"is-disabled":S.isMcpLoading,"is-loading":S.isMcpLoading}]),onClick:_[0]||(_[0]=N=>!S.isMcpLoading&&M("open-model-dialog"))},[s("div",{class:"model-logo-container",style:Ao({color:S.isMcpLoading?"#F59E0B":O.value})},_[3]||(_[3]=[s("svg",{class:"model-logo",width:"18",height:"18",viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[s("g",{"clip-path":"url(#clip0_11482_204655)"},[s("path",{d:"M24.9439 24.7319C25.824 27.2847 25.4279 29.2944 23.7589 30.7231C22.2911 31.9822 19.8552 32.4878 18.3842 31.2946C16.8252 30.0291 15.9012 30.1076 14.3202 31.2914C12.7769 32.4438 10.8062 32.1141 9.19691 30.8926C7.59392 29.6743 7.04073 28.0069 7.33304 26.0413C7.39276 25.6425 7.7165 25.2908 7.5562 24.7633C6.48126 25.0396 5.45346 25.564 4.29051 25.3599C2.38579 25.0239 1.01225 24.0128 0.333338 22.1948C-0.370719 20.3076 0.0724596 18.6088 1.38942 17.1142C1.75717 16.6966 2.3795 16.4642 1.64087 15.6698C-0.226136 13.6602 -0.465012 11.5218 0.732513 9.54359C1.93004 7.56224 4.08621 6.84317 6.77043 7.53084C6.91815 7.62504 7.06588 7.71924 7.21046 7.8103C7.34562 7.55596 7.30161 7.34244 7.05645 7.17915C5.67662 3.03432 8.04024 -0.356908 12.0414 0.0324552C13.2515 0.148636 14.2196 0.732681 15.0462 1.57107C15.4266 1.95729 15.7126 2.19907 16.1683 1.65585C17.9442 -0.454249 20.9679 -0.259567 22.4577 0.713841C24.4316 2.00125 25.0162 3.81305 24.353 6.92167C24.3467 6.95307 24.4158 7.00017 24.5039 7.11007C25.3902 6.85259 26.286 6.41299 27.2824 6.49463C29.2782 6.65477 30.7649 7.58422 31.5664 9.43683C32.3899 11.3491 32.0159 13.0981 30.6958 14.6932C30.3815 15.0732 29.426 15.3401 30.3092 16.1157C32.4622 17.9965 32.2642 20.7849 31.2427 22.3769C29.9949 24.3206 28.1404 24.9674 25.3179 24.3928C25.1105 24.2107 24.8873 24.1541 24.639 24.3017C24.7427 24.4462 24.8465 24.5906 24.9502 24.7319H24.9439ZM2.46122 12.2315C2.45179 12.9694 2.87297 13.5974 3.44816 14.1657C4.96942 15.6666 6.46555 17.1896 7.98995 18.6873C8.91717 19.5948 9.87582 21.1554 10.8219 21.1585C11.7491 21.1585 12.6763 19.554 13.6067 18.6559C13.6821 18.5837 13.7513 18.5052 13.833 18.4393C14.295 18.0813 14.1504 17.783 13.7921 17.4282C11.3845 15.0481 9.01146 12.6334 6.58498 10.2721C5.80864 9.51533 4.8217 9.38031 3.83476 9.86702C2.91383 10.316 2.44236 11.0853 2.46122 12.2346V12.2315ZM12.1609 29.5267C12.9781 29.4671 13.5784 29.0997 14.1127 28.5596C15.6529 27.0053 17.2118 25.4667 18.7645 23.9249C20.6986 22.0011 20.6755 20.1213 18.6954 18.2854C18.62 18.2163 18.5477 18.1378 18.4817 18.0593C18.1925 17.7139 17.9316 17.7014 17.5984 18.0405C15.1468 20.5243 12.6606 22.9766 10.2341 25.4855C9.51436 26.2297 9.53322 27.2094 9.94811 28.1231C10.3787 29.0683 11.2022 29.4671 12.164 29.5299L12.1609 29.5267ZM21.0999 10.2156C20.1224 11.2926 19.2454 12.3257 18.2962 13.2865C17.8185 13.7701 17.8216 14.0715 18.3056 14.5457C20.6504 16.8442 22.9354 19.2023 25.2959 21.482C26.4589 22.6061 27.9204 22.5496 28.9168 21.4883C29.8377 20.5054 29.8283 19.0453 28.7879 17.9777C26.3174 15.4406 23.8092 12.9411 21.0999 10.2124V10.2156ZM22.3445 4.88066C22.3445 3.83189 21.8165 3.06258 20.927 2.62612C19.8866 2.11743 18.8934 2.35293 18.0668 3.1662C16.4355 4.77703 14.8105 6.39101 13.1949 8.01754C10.2907 10.9378 10.3127 10.9252 13.3741 13.6853C13.8927 14.1532 14.1284 14.1155 14.5905 13.6445C16.8504 11.3397 19.1511 9.07259 21.4393 6.79607C21.9737 6.26541 22.3382 5.65938 22.3445 4.88066ZM8.91717 4.83983C8.99575 5.81952 9.4075 6.66733 10.2058 7.07239C10.9979 7.47432 11.2399 6.46323 11.7083 6.08328C12.3494 5.56204 12.8932 4.92148 13.4904 4.34371C13.723 4.11763 13.9744 3.91667 13.6601 3.58382C12.8806 2.76114 12.0383 2.11429 10.7936 2.4754C9.58351 2.82708 9.05547 3.70001 8.91717 4.83983ZM27.1535 8.87791C26.0691 8.91873 25.2645 9.41799 24.859 10.1873C24.5039 10.8624 25.4374 11.1387 25.802 11.5752C26.33 12.2095 26.9523 12.7684 27.5558 13.3367C27.779 13.5471 27.9456 14.0181 28.4076 13.5754C29.2374 12.7778 29.8629 11.8986 29.4763 10.696C29.1054 9.54987 28.2693 8.92187 27.1535 8.88105V8.87791ZM4.46338 22.9766C5.9155 22.9986 6.72642 22.4962 7.13188 21.7332C7.53735 20.9701 6.51269 20.7127 6.13238 20.2354C5.62005 19.5885 4.97257 19.0516 4.40052 18.455C4.11136 18.1535 3.87248 18.0531 3.50788 18.3828C2.61209 19.1866 2.20034 20.1569 2.58066 21.3061C2.93898 22.3926 3.7719 22.9546 4.46338 22.9766ZM23.036 27.0649C23.0989 26.0036 22.5331 25.1778 21.7128 24.7633C21.1062 24.4556 20.7856 25.3725 20.3487 25.743C19.7169 26.2768 19.1731 26.9079 18.5822 27.492C18.3151 27.7557 18.0322 27.9881 18.4188 28.3869C19.1763 29.1656 20.0124 29.7528 21.1627 29.4325C22.3445 29.1028 22.9669 28.2895 23.0392 27.0681L23.036 27.0649Z",fill:"currentColor"})]),s("defs",null,[s("clipPath",{id:"clip0_11482_204655"},[s("rect",{width:"32",height:"32",fill:"white"})])])],-1)]),4),s("div",Bn,[s("span",In,ee(S.isMcpLoading?"MCPÂ∑•ÂÖ∑Âä†ËΩΩ‰∏≠...":S.modelMap[S.model]||S.model||"ÈÄâÊã©Ê®°Âûã"),1),l(a(W),{class:"arrow-icon",size:12},{default:c(()=>_[4]||(_[4]=[s("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[s("path",{d:"M7 10L12 5L17 10",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"}),s("path",{d:"M7 14L12 19L17 14",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])),_:1})])],2),_[5]||(_[5]=s("div",{class:"header-divider"},null,-1)),s("div",{class:"model-pill prompt-pill",onClick:_[1]||(_[1]=N=>M("show-system-prompt"))},[l(a(W),{size:14,class:"prompt-icon"},{default:c(()=>[l(a(Ra))]),_:1}),S.systemPrompt?(E(),R("span",zn,ee(S.systemPrompt),1)):(E(),R("span",Dn,"Á≥ªÁªüÊèêÁ§∫ËØç"))]),l(a(ue),{content:"ÊêúÁ¥¢ÂÜÖÂÆπ (Ctrl/Cmd+F)",placement:"bottom","show-after":500},{default:c(()=>[s("div",{class:"model-pill icon-pill",onClick:_[2]||(_[2]=N=>M("open-search"))},[l(a(W),{size:14,class:"header-icon"},{default:c(()=>[l(a(eo))]),_:1})])]),_:1})])])]),_:1}))}},Vn=_t(Pn,[["__scopeId","data-v-42168140"]]),Rn={key:0,class:"drag-overlay"},On={class:"file-card-container"},Fn={class:"file-icon"},Nn={class:"file-info"},Hn=["title"],Un={class:"file-size"},Wn={class:"file-actions"},qn={class:"waveform-display-area"},jn={key:1,class:"recording-status-text"},Kn={class:"option-selector-content"},Zn={class:"option-selector-content"},Jn={class:"option-selector-content"},Yn={class:"chat-input-area-vertical"},Xn={key:0,class:"mcp-quick-select"},Gn={class:"mcp-quick-list-scroll"},Qn=["onMousedown"],el={class:"mcp-item-left"},tl={class:"mcp-index-badge"},ol={class:"mcp-name"},al={class:"mcp-tags"},nl={key:0,class:"mcp-tag type-tag"},ll={class:"mcp-item-right"},sl={class:"input-wrapper"},il={class:"input-actions-bar"},rl={class:"action-buttons-left"},cl={xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",class:"icon",style:{"margin-top":"-2px"}},ul={class:"action-buttons-right"},dl={__name:"ChatInput",props:ko({loading:Boolean,ctrlEnterToSend:Boolean,voiceList:{type:Array,default:()=>[]},layout:{type:String,default:"horizontal"},isMcpActive:Boolean,allMcpServers:{type:Array,default:()=>[]},activeMcpIds:{type:Array,default:()=>[]}},{prompt:{},promptModifiers:{},fileList:{},fileListModifiers:{},selectedVoice:{},selectedVoiceModifiers:{},tempReasoningEffort:{},tempReasoningEffortModifiers:{}}),emits:ko(["submit","cancel","clear-history","remove-file","upload","send-audio","open-mcp-dialog","pick-file-start","toggle-mcp"],["update:prompt","update:fileList","update:selectedVoice","update:tempReasoningEffort"]),setup(S,{expose:B,emit:i}){const M=zt(S,"prompt"),z=zt(S,"fileList"),O=zt(S,"selectedVoice"),I=zt(S,"tempReasoningEffort"),_=S,N=i,j=w(null),J=w(null),q=w(null),y=w(!1),P=w(0),F=w(!1),re=w(!1),Ie=w(""),Oe=w(0),Fe=w(null),wt=w(null),je=w(null),Lt=w(null),ct=w(null),Ke=w(null);let ye=null,Le=null,me=null,D=[],Ue=null;const ze=w(null),We=w(!1),De=w(!1),g=w(!1),ae=w(!1),Pe=w(_.voiceList||[]);ht(()=>_.voiceList,f=>{Pe.value=f||[]},{immediate:!0});const ke=ve(()=>`ÊÄùËÄÉÈ¢ÑÁÆó: ${{default:"ÈªòËÆ§",low:"‰Ωé",medium:"‰∏≠",high:"È´ò"}[I.value]||"ÈªòËÆ§"}`),Y=ve(()=>{if(!re.value)return[];const f=Ie.value.toLowerCase();return _.allMcpServers.filter(b=>{const K=b.name&&b.name.toLowerCase().includes(f),de=b.tags&&b.tags.some(dt=>dt.toLowerCase().includes(f)),Z=(b.type||"").toLowerCase();let he="";Z==="builtin"?he="ÂÜÖÁΩÆ":Z==="stdio"?he="stdio":Z==="sse"?he="sse":Z.includes("http")&&(he="ÂèØÊµÅÂºè http");const He=Z.includes(f)||he.includes(f);return K||de||He}).slice(0,10)});ht(M,f=>{if(f.startsWith("/")){const u=f.match(/^\/([^ \n\r]*)$/);u?(Ie.value=u[1],re.value=!0,Oe.value=0):re.value=!1}else re.value=!1});const yt=()=>{const f=j.value?.$refs.textarea;if(!f)return;const u=f.selectionStart,b=f.selectionEnd,K=M.value;M.value=K.substring(0,u)+`
`+K.substring(b),fe(()=>{f.selectionStart=f.selectionEnd=u+1,f.focus()})},bt=f=>{if(f.isComposing)return;if(re.value&&Y.value.length>0){if(f.key==="Escape"){f.preventDefault(),f.stopPropagation(),re.value=!1;return}if(f.key==="ArrowUp"){f.preventDefault(),Oe.value=(Oe.value-1+Y.value.length)%Y.value.length,fe(()=>{const b=document.querySelector(".mcp-quick-item.highlighted");b&&b.scrollIntoView({block:"nearest"})});return}if(f.key==="ArrowDown"){f.preventDefault(),Oe.value=(Oe.value+1)%Y.value.length,fe(()=>{const b=document.querySelector(".mcp-quick-item.highlighted");b&&b.scrollIntoView({block:"nearest"})});return}if(f.key==="Enter"){f.preventDefault();const b=Y.value[Oe.value];b&&_e(b.id);return}if(/^[0-9]$/.test(f.key)){f.preventDefault();const b=parseInt(f.key);b<Y.value.length&&_e(Y.value[b].id);return}}if(F.value){(f.ctrlKey||f.metaKey)&&f.key.toLowerCase()==="c"||f.preventDefault();return}if(f.key!=="Enter")return;const u=f.ctrlKey||f.metaKey;_.ctrlEnterToSend?u&&(f.preventDefault(),_.loading||N("submit")):u?(f.preventDefault(),yt()):f.shiftKey||(f.preventDefault(),_.loading||N("submit"))},_e=f=>{N("toggle-mcp",f),re.value=!1,M.value=""},Ye=f=>{_e(f.id)},Xe=()=>{_.loading||N("submit")},H=()=>N("cancel"),L=()=>N("clear-history"),ge=f=>N("remove-file",f),lt=()=>{F.value||(g.value=!g.value,g.value&&(ae.value=!1,De.value=!1))},Te=f=>{I.value=f,g.value=!1},Ee=async()=>{if(!F.value){if(!ae.value){try{const f=await window.api.getConfig();f?.config?.voiceList&&(Pe.value=f.config.voiceList)}catch(f){console.error("Âà∑Êñ∞ËØ≠Èü≥ÂàóË°®Â§±Ë¥•",f)}g.value=!1,De.value=!1}ae.value=!ae.value}},ie=f=>{O.value=f,ae.value=!1},Ae=()=>{N("pick-file-start"),fe(()=>{J.value?.click()})},G=f=>{const u=f.target.files;u.length&&N("upload",{file:u[0],fileList:Array.from(u)}),J.value&&(J.value.value="")},be=f=>f.preventDefault(),qe=f=>{be(f),P.value++,y.value=!0},Se=f=>{be(f),P.value--,P.value<=0&&(y.value=!1,P.value=0)},ut=f=>{be(f),y.value=!1,P.value=0;const u=f.dataTransfer.files;u&&u.length>0&&(N("upload",{file:u[0],fileList:Array.from(u)}),Ze())},Be=f=>{const u=f.clipboardData||window.clipboardData;if(!u)return;const b=Array.from(u.items).filter(K=>K.kind==="file");if(b.length>0){be(f);const K=b.map(de=>de.getAsFile());N("upload",{file:K[0],fileList:K}),Ze()}},Ge=()=>{F.value||(De.value=!De.value,De.value&&(ae.value=!1,g.value=!1))},Tt=async f=>{if(De.value=!1,!F.value){F.value=!0,ze.value=f,We.value=!1;try{if(f==="microphone"){const b=(await Mt(()=>import("./recorder-core-CUxHkEyR.js").then(K=>K.r),__vite__mapDeps([0,1,2]),import.meta.url)).default;await Mt(()=>import("./waveview-BCcBXsEP.js"),[],import.meta.url),await Mt(()=>import("./wav-Cwu-lTX3.js"),[],import.meta.url),await new Promise((K,de)=>{b.TrafficFree=!0,ye=b({type:"wav",sampleRate:16e3,bitRate:16,onProcess:(Z,he,He,dt)=>{Le&&Le.input(Z[Z.length-1],he,dt)}}),ye.open(()=>{fe(()=>{q.value&&(Le=b.WaveView({elem:q.value,lineWidth:3})),ye.start(),K()})},(Z,he)=>{const He=(he?"Áî®Êà∑ÊãíÁªù‰∫ÜÊùÉÈôê, ":"")+"Êó†Ê≥ïÂΩïÈü≥: "+Z;$t.error(He),ye=null,de(new Error(He))})})}else if(f==="system"){const u=await window.api.desktopCaptureSources({types:["screen","window"]});if(!u||u.length===0)throw new Error("Êú™ÊâæÂà∞ÂèØÁî®ÁöÑÁ≥ªÁªüÈü≥È¢ëÊ∫ê");Ue=await navigator.mediaDevices.getUserMedia({audio:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:u[0].id}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:u[0].id}}}),D=[],me=new MediaRecorder(Ue),me.ondataavailable=b=>D.push(b.data),me.onstop=()=>{if(We.value){Ne();return}const b=new Blob(D,{type:"audio/wav"}),K=new Date,de=`${K.getHours().toString().padStart(2,"0")}${K.getMinutes().toString().padStart(2,"0")}${K.getSeconds().toString().padStart(2,"0")}`,Z=new File([b],`audio-${de}.wav`,{type:"audio/wav"});N("send-audio",Z),Ne()},me.start()}}catch(u){console.error("ÂΩïÈü≥ÂêØÂä®Â§±Ë¥•:",u),$t.error(u.message||"Êó†Ê≥ïÂºÄÂßãÂΩïÈü≥"),Ne()}}},Ne=()=>{ye&&(ye.close(),ye=null),Le&&(q.value&&(q.value.innerHTML=""),Le=null),me&&me.state==="recording"&&me.stop(),Ue&&Ue.getTracks().forEach(f=>f.stop()),me=null,Ue=null,D=[],F.value=!1,ze.value=null},Et=()=>{We.value=!0,$t.info("ÂΩïÈü≥Â∑≤ÂèñÊ∂à"),ze.value==="microphone"&&ye?ye.stop(()=>Ne(),()=>Ne()):ze.value==="system"&&me&&me.stop()},Rt=()=>{We.value=!1,ze.value==="microphone"&&ye?ye.stop(f=>{if(We.value){Ne();return}const u=new Date,b=`${u.getHours().toString().padStart(2,"0")}${u.getMinutes().toString().padStart(2,"0")}${u.getSeconds().toString().padStart(2,"0")}`,K=new File([f],`audio-${b}.wav`,{type:"audio/wav"});N("send-audio",K),Ne()},f=>{$t.error("ÂΩïÈü≥Â§±Ë¥•: "+f),Ne()}):ze.value==="system"&&me&&me.stop()},ce=f=>{const u=f.target;u&&(g.value&&Fe.value&&!Fe.value.contains(u)&&Lt.value&&!Lt.value.$el.contains(u)&&(g.value=!1),ae.value&&wt.value&&!wt.value.$el.contains(u)&&ct.value&&!ct.value.$el.contains(u)&&(ae.value=!1),De.value&&je.value&&!je.value.contains(u)&&Ke.value&&!Ke.value.$el.contains(u)&&(De.value=!1))};Gt(()=>{window.addEventListener("dragenter",qe),window.addEventListener("dragleave",Se),window.addEventListener("dragover",be),window.addEventListener("drop",ut),window.addEventListener("paste",Be),document.addEventListener("click",ce)}),Qt(()=>{window.removeEventListener("dragenter",qe),window.removeEventListener("dragleave",Se),window.removeEventListener("dragover",be),window.removeEventListener("drop",ut),window.removeEventListener("paste",Be),document.removeEventListener("click",ce),Ne()});const Ze=(f={})=>{const u=j.value?.$refs.textarea;u&&(u.focus(),fe(()=>{if(f.position&&typeof f.position.start=="number"){const b=M.value?.length||0,K=Math.min(f.position.start,b),de=Math.min(f.position.end,b);u.setSelectionRange(K,de)}else if(f.cursor==="end"){const b=M.value?.length||0;u.setSelectionRange(b,b)}}))},Qe=f=>{if(!f)return"";const u=/^streamable[\s_-]?http$/i,b=f.toLowerCase();return b==="builtin"?"ÂÜÖÁΩÆ":u.test(b)||b==="http"?"HTTP":b==="sse"?"SSE":b==="stdio"?"Stdio":f};return B({focus:Ze,senderRef:j}),(f,u)=>(E(),R(Re,null,[y.value?(E(),R("div",Rn,u[9]||(u[9]=[s("div",{class:"drag-overlay-content"}," ÊãñÊãΩÊñá‰ª∂Âà∞Ê≠§Â§Ñ‰ª•‰∏ä‰º† ",-1)]))):te("",!0),l(a(qa),{class:"input-footer"},{default:c(()=>[z.value.length>0&&!F.value?(E(),Ce(a(gt),{key:0},{default:c(()=>[l(a(we),{span:0}),l(a(we),{span:24},{default:c(()=>[s("div",On,[(E(!0),R(Re,null,nt(z.value,(b,K)=>(E(),R("div",{key:K,class:"custom-file-card"},[s("div",Fn,[l(a(W),{size:20},{default:c(()=>[l(a(Na))]),_:1})]),s("div",Nn,[s("div",{class:"file-name",title:b.name},ee(b.name),9,Hn),s("div",Un,ee((b.size/1024).toFixed(1))+" KB",1)]),s("div",Wn,[l(a(U),{type:"danger",link:"",icon:a(Ha),size:"small",onClick:de=>ge(K)},null,8,["icon","onClick"])])]))),128))])]),_:1}),l(a(we),{span:0})]),_:1})):te("",!0),Fa(l(a(gt),{class:"waveform-row"},{default:c(()=>[l(a(we),{span:0}),l(a(we),{span:24},{default:c(()=>[s("div",qn,[ze.value==="microphone"?(E(),R("div",{key:0,ref_key:"waveformCanvasContainer",ref:q,class:"waveform-canvas"},null,512)):(E(),R("span",jn,"Ê≠£Âú®ÂΩïÂà∂Á≥ªÁªüÈü≥È¢ë..."))])]),_:1}),l(a(we),{span:0})]),_:1},512),[[Ua,F.value]]),De.value?(E(),Ce(a(gt),{key:1,class:"option-selector-row"},{default:c(()=>[l(a(we),{span:0}),l(a(we),{span:24},{default:c(()=>[s("div",{class:"option-selector-wrapper",ref_key:"audioSourceSelectorRef",ref:je},[s("div",Kn,[l(a(Zt),{tag:"b",class:"selector-label"},{default:c(()=>u[10]||(u[10]=[X("ÈÄâÊã©Èü≥Ê∫ê")])),_:1}),l(a(Jt),{direction:"vertical"}),l(a(U),{onClick:u[0]||(u[0]=b=>Tt("microphone")),round:""},{default:c(()=>u[11]||(u[11]=[X("üéôÔ∏è È∫¶ÂÖãÈ£é")])),_:1}),l(a(U),{onClick:u[1]||(u[1]=b=>Tt("system")),round:""},{default:c(()=>u[12]||(u[12]=[X("üíª Á≥ªÁªüÈü≥È¢ë")])),_:1})])],512)]),_:1}),l(a(we),{span:0})]),_:1})):te("",!0),g.value?(E(),Ce(a(gt),{key:2,class:"option-selector-row"},{default:c(()=>[l(a(we),{span:0}),l(a(we),{span:24},{default:c(()=>[s("div",{class:"option-selector-wrapper",ref_key:"reasoningSelectorRef",ref:Fe},[s("div",Zn,[l(a(Zt),{tag:"b",class:"selector-label"},{default:c(()=>u[13]||(u[13]=[X("ÊÄùËÄÉÈ¢ÑÁÆó")])),_:1}),l(a(Jt),{direction:"vertical"}),l(a(U),{onClick:u[2]||(u[2]=b=>Te("default")),type:I.value==="default"?"primary":"default",round:""},{default:c(()=>u[14]||(u[14]=[X("ÈªòËÆ§")])),_:1},8,["type"]),l(a(U),{onClick:u[3]||(u[3]=b=>Te("low")),type:I.value==="low"?"primary":"default",round:""},{default:c(()=>u[15]||(u[15]=[X("Âø´ÈÄü")])),_:1},8,["type"]),l(a(U),{onClick:u[4]||(u[4]=b=>Te("medium")),type:I.value==="medium"?"primary":"default",round:""},{default:c(()=>u[16]||(u[16]=[X("ÂùáË°°")])),_:1},8,["type"]),l(a(U),{onClick:u[5]||(u[5]=b=>Te("high")),type:I.value==="high"?"primary":"default",round:""},{default:c(()=>u[17]||(u[17]=[X("Ê∑±ÂÖ•")])),_:1},8,["type"])])],512)]),_:1}),l(a(we),{span:0})]),_:1})):te("",!0),ae.value?(E(),Ce(a(gt),{key:3,class:"option-selector-row"},{default:c(()=>[l(a(we),{span:0}),l(a(we),{span:24},{default:c(()=>[l(a(Wa),{class:"option-selector-wrapper",ref_key:"voiceSelectorRef",ref:wt},{default:c(()=>[s("div",Jn,[l(a(Zt),{tag:"b",class:"selector-label"},{default:c(()=>u[18]||(u[18]=[X("ÈÄâÊã©Èü≥Ëâ≤")])),_:1}),l(a(Jt),{direction:"vertical"}),l(a(U),{onClick:u[6]||(u[6]=b=>ie(null)),type:O.value?"default":"primary",round:""},{default:c(()=>u[19]||(u[19]=[X(" ÂÖ≥Èó≠ËØ≠Èü≥ ")])),_:1},8,["type"]),(E(!0),R(Re,null,nt(Pe.value,b=>(E(),Ce(a(U),{key:b,onClick:K=>ie(b),type:O.value===b?"primary":"default",round:""},{default:c(()=>[X(ee(b),1)]),_:2},1032,["onClick","type"]))),128))])]),_:1},512)]),_:1}),l(a(we),{span:0})]),_:1})):te("",!0),l(a(gt),null,{default:c(()=>[l(a(we),{span:0}),l(a(we),{span:24},{default:c(()=>[s("div",Yn,[re.value&&Y.value.length>0?(E(),R("div",Xn,[u[20]||(u[20]=s("div",{class:"mcp-quick-header"},[s("span",{class:"header-title"},"MCPÂø´Êç∑ÈÄâÊã©"),s("span",{class:"header-hint"},[X("Esc ÂèñÊ∂à "),s("span",{class:"divider"},"|"),X(" ‚áÖ ÈÄâÊã© "),s("span",{class:"divider"},"|"),X(" Enter/Êï∞Â≠óÈîÆ Á°ÆËÆ§")])],-1)),s("div",Gn,[(E(!0),R(Re,null,nt(Y.value,(b,K)=>(E(),R("div",{key:b.id,class:Me(["mcp-quick-item",{highlighted:K===Oe.value,active:S.activeMcpIds.includes(b.id)}]),onMousedown:at(de=>Ye(b),["prevent"])},[s("div",el,[s("span",tl,ee(K),1),s("span",ol,ee(b.name),1),s("div",al,[b.type?(E(),R("span",nl,ee(Qe(b.type)),1)):te("",!0),(E(!0),R(Re,null,nt((b.tags||[]).slice(0,2),de=>(E(),R("span",{key:de,class:"mcp-tag"},ee(de),1))),128))])]),s("div",ll,[S.activeMcpIds.includes(b.id)?(E(),Ce(a(W),{key:0,class:"active-icon"},{default:c(()=>[l(a(Pt))]),_:1})):te("",!0)])],42,Qn))),128))])])):te("",!0),s("div",sl,[l(a(ot),{ref_key:"senderRef",ref:j,class:"chat-textarea-vertical",modelValue:M.value,"onUpdate:modelValue":u[7]||(u[7]=b=>M.value=b),type:"textarea",placeholder:F.value?"ÂΩïÈü≥‰∏≠... ÁªìÊùüÂêéÂ∞ÜËøûÂêåÊñáÊú¨‰∏ÄËµ∑ÂèëÈÄÅ":"ËæìÂÖ•„ÄÅÁ≤òË¥¥„ÄÅÊãñÊãΩ‰ª•ÂèëÈÄÅÂÜÖÂÆπÔºå‚Äú\\‚ÄùÈÄâÊã©MCP",autosize:{minRows:1,maxRows:15},resize:"none",onKeydown:bt,disabled:F.value},null,8,["modelValue","placeholder","disabled"])]),s("div",il,[s("div",rl,[l(a(ue),{content:"Ê∏ÖÈô§ËÅäÂ§©ËÆ∞ÂΩï"},{default:c(()=>[l(a(U),{size:"default",onClick:L,circle:"",disabled:F.value},{default:c(()=>[l(a(W),{size:18},{default:c(()=>u[21]||(u[21]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"lucide lucide-paintbrush-vertical","aria-hidden":"true"},[s("path",{d:"M10 2v2"}),s("path",{d:"M14 2v4"}),s("path",{d:"M17 2a1 1 0 0 1 1 1v9H6V3a1 1 0 0 1 1-1z"}),s("path",{d:"M6 12a1 1 0 0 0-1 1v1a2 2 0 0 0 2 2h2a1 1 0 0 1 1 1v2.9a2 2 0 1 0 4 0V17a1 1 0 0 1 1-1h2a2 2 0 0 0 2-2v-1a1 1 0 0 0-1-1"})],-1)])),_:1})]),_:1},8,["disabled"])]),_:1}),l(a(ue),{content:"Ê∑ªÂä†ÈôÑ‰ª∂"},{default:c(()=>[l(a(U),{size:"default",onClick:Ae,circle:"",disabled:F.value},{default:c(()=>[l(a(W),{size:17},{default:c(()=>u[22]||(u[22]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"lucide lucide-paperclip","aria-hidden":"true"},[s("path",{d:"m16 6-8.414 8.586a2 2 0 0 0 2.829 2.829l8.414-8.586a4 4 0 1 0-5.657-5.657l-8.379 8.551a6 6 0 1 0 8.485 8.485l8.379-8.551"})],-1)])),_:1})]),_:1},8,["disabled"])]),_:1}),l(a(ue),{content:ke.value},{default:c(()=>[l(a(U),{ref_key:"reasoningButtonRef",ref:Lt,class:Me({"is-active-special":I.value&&I.value!=="default"}),size:"default",circle:"",disabled:F.value,onClick:lt},{default:c(()=>[l(a(W),{size:18},{default:c(()=>[(E(),R("svg",cl,u[23]||(u[23]=[s("path",{fill:"currentColor",d:"M1 11h3v2H1zm9 11c0 .6.4 1 1 1h2c.6 0 1-.4 1-1v-1h-4zm3-21h-2v3h2zM4.9 3.5L3.5 4.9L5.6 7L7 5.6zM20 11v2h3v-2zm-.9-7.5L17 5.6L18.4 7l2.1-2.1zM18 12c0 2.2-1.2 4.2-3 5.2V19c0 .6-.4 1-1 1h-4c-.6 0-1-.4-1-1v-1.8c-1.8-1-3-3-3-5.2c0-3.3 2.7-6 6-6s6 2.7 6 6M8 12c0 .35.05.68.14 1h7.72c.09-.32.14-.65.14-1c0-2.21-1.79-4-4-4s-4 1.79-4 4"},null,-1)])))]),_:1})]),_:1},8,["class","disabled"])]),_:1},8,["content"]),l(a(ue),{content:"ËØ≠Èü≥ÂõûÂ§çËÆæÁΩÆ"},{default:c(()=>[l(a(U),{ref_key:"voiceButtonRef",ref:ct,size:"default",circle:"",disabled:F.value,class:Me({"is-active-special":O.value}),onClick:Ee},{default:c(()=>[l(a(W),{size:18},{default:c(()=>u[24]||(u[24]=[s("svg",{t:"1765028999430",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"60819",width:"200",height:"200"},[s("path",{d:"M85.333333 512C85.333333 276.352 276.352 85.333333 512 85.333333s426.666667 191.018667 426.666667 426.666667-191.018667 426.666667-426.666667 426.666667H85.333333l124.970667-124.970667A425.344 425.344 0 0 1 85.333333 512z m205.994667 341.333333H512a341.333333 341.333333 0 1 0-341.333333-341.333333c0 91.818667 36.309333 177.706667 99.968 241.365333l60.330666 60.330667-39.637333 39.637333zM469.333333 256h85.333334v512h-85.333334V256zM298.666667 384h85.333333v256H298.666667V384z m341.333333 0h85.333333v256h-85.333333V384z","p-id":"60820"})],-1)])),_:1})]),_:1},8,["disabled","class"])]),_:1}),l(a(ue),{content:"MCPÂ∑•ÂÖ∑"},{default:c(()=>[l(a(U),{size:"default",circle:"",disabled:F.value,class:Me({"is-active-special":S.isMcpActive}),onClick:u[8]||(u[8]=b=>f.$emit("open-mcp-dialog"))},{default:c(()=>[l(a(W),{size:18},{default:c(()=>u[25]||(u[25]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"lucide lucide-hammer","aria-hidden":"true"},[s("path",{d:"m15 12-8.373 8.373a1 1 0 1 1-3-3L12 9"}),s("path",{d:"m18 15 4-4"}),s("path",{d:"m21.5 11.5-1.914-1.914A2 2 0 0 1 19 8.172V7l-2.26-2.26a6 6 0 0 0-4.202-1.756L9 2.96l.92.82A6.18 6.18 0 0 1 12 8.4V10l2 2h1.172a2 2 0 0 1 1.414.586L18.5 14.5"})],-1)])),_:1})]),_:1},8,["disabled","class"])]),_:1})]),s("div",ul,[F.value?(E(),R(Re,{key:0},[l(a(ue),{content:"ÂèñÊ∂àÂΩïÈü≥"},{default:c(()=>[l(a(U),{icon:a(Vt),size:"default",onClick:Et,circle:""},null,8,["icon"])]),_:1}),l(a(ue),{content:"ÁªìÊùüÂπ∂ÂèëÈÄÅ"},{default:c(()=>[l(a(U),{icon:a(Pt),size:"default",onClick:Rt,circle:""},null,8,["icon"])]),_:1})],64)):(E(),R(Re,{key:1},[l(a(ue),{content:"ÂèëÈÄÅËØ≠Èü≥"},{default:c(()=>[l(a(U),{ref_key:"audioButtonRef",ref:Ke,size:"default",onClick:Ge,circle:""},{default:c(()=>[l(a(W),{size:17},{default:c(()=>u[26]||(u[26]=[s("svg",{t:"1765029327206",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"68987",width:"200",height:"200"},[s("path",{d:"M516.368 732.288c126.944 0 230.096-99.696 230.096-222.272V230.272c0-122.56-103.28-222.272-230.096-222.272S286.16 107.696 286.16 230.272v279.744c0 122.56 103.28 222.272 230.208 222.272zM377.664 230.272c0-73.808 62.256-133.984 138.704-133.984 76.448 0 138.688 60.048 138.688 133.984v279.744c0 73.808-62.256 134-138.688 134-76.448 0-138.704-60.048-138.704-134V230.272z","p-id":"68988"}),s("path",{d:"M465.088 899.296C267.52 876.656 113.776 712.928 113.776 514.928c0-24.832 20.64-44.896 46.16-44.896 25.536 0 46.16 20.064 46.16 44.896 0 163.952 137.184 297.376 305.856 297.376 168.656 0 305.968-133.424 305.968-297.376 0-24.832 20.656-44.896 46.192-44.896 25.504 0 46.128 20.064 46.128 44.896 0 196.976-152.096 359.872-348.16 384.016v68.592A48.416 48.416 0 0 1 513.6 1016a48.448 48.448 0 0 1-48.496-48.464v-68.24z","p-id":"68989"})],-1)])),_:1})]),_:1},512)]),_:1}),S.loading?(E(),Ce(a(U),{key:1,onClick:H,circle:"",class:"cancel-button-animated"},{default:c(()=>[l(a(W),{class:"static-icon"},{default:c(()=>[l(a(Vt))]),_:1}),u[28]||(u[28]=s("div",{class:"cancel-spinner"},null,-1))]),_:1})):(E(),Ce(a(U),{key:0,onClick:Xe,circle:"",disabled:S.loading},{default:c(()=>[l(a(W),{size:18},{default:c(()=>u[27]||(u[27]=[s("svg",{t:"1765029205363",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"63447",width:"200",height:"200"},[s("path",{d:"M866.133333 298.666667l-277.333333 396.8 174.933333 64L866.133333 298.666667zM469.333333 691.2l362.666667-482.133333-652.8 332.8 230.4 72.533333c21.333333 8.533333 29.866667 29.866667 21.333333 51.2v4.266667c-12.8 21.333333-42.666667 34.133333-68.266666 21.333333L76.8 597.333333c-21.333333-8.533333-34.133333-29.866667-25.6-55.466666 4.266667-8.533333 12.8-17.066667 21.333333-25.6L913.066667 72.533333c21.333333-12.8 46.933333-4.266667 59.733333 17.066667 4.266667 8.533333 4.266667 17.066667 4.266667 29.866667l-140.8 699.733333c-4.266667 21.333333-25.6 38.4-51.2 34.133333h-4.266667l-238.933333-89.6v162.133334c0 21.333333-17.066667 38.4-38.4 42.666666-21.333333 0-38.4-17.066667-38.4-42.666666","p-id":"63448"})],-1)])),_:1})]),_:1},8,["disabled"]))],64))])])]),s("input",{ref_key:"fileInputRef",ref:J,type:"file",multiple:"",onChange:G,style:{display:"none"}},null,544)]),_:1}),l(a(we),{span:0})]),_:1})]),_:1})],64))}},pl=_t(dl,[["__scopeId","data-v-9a054c08"]]),fl={class:"model-search-container"},vl={__name:"ModelSelectionDialog",props:{modelValue:Boolean,modelList:Array,currentModel:String},emits:["update:modelValue","select","save-model"],setup(S,{emit:B}){const i=S,M=B,z=w(""),O=w(null),I=()=>{O.value&&O.value.focus()},_=ve(()=>{if(!z.value)return i.modelList;const q=z.value.toLowerCase();return i.modelList.filter(y=>y.label.toLowerCase().includes(q))}),N=({row:q,column:y,rowIndex:P,columnIndex:F})=>{if(F===0){if(P>0&&_.value[P-1].label.split("|")[0]===q.label.split("|")[0])return{rowspan:0,colspan:0};let re=1;for(let Ie=P+1;Ie<_.value.length&&_.value[Ie].label.split("|")[0]===q.label.split("|")[0];Ie++)re++;return{rowspan:re,colspan:1}}},j=q=>{q.value===i.currentModel?M("save-model",q.value):M("select",q.value)},J=()=>{z.value="",M("update:modelValue",!1)};return(q,y)=>(E(),Ce(a(Xt),{"model-value":S.modelValue,"onUpdate:modelValue":J,width:"80%","custom-class":"model-dialog no-header-dialog",onOpened:I,"show-close":!1},{header:c(()=>y[1]||(y[1]=[s("div",{style:{display:"none"}},null,-1)])),footer:c(()=>[l(a(U),{onClick:J},{default:c(()=>y[2]||(y[2]=[X("ÂÖ≥Èó≠")])),_:1})]),default:c(()=>[s("div",fl,[l(a(ot),{ref_key:"searchInputRef",ref:O,modelValue:z.value,"onUpdate:modelValue":y[0]||(y[0]=P=>z.value=P),placeholder:"ÊêúÁ¥¢ÊúçÂä°ÂïÜÊàñÊ®°ÂûãÂêçÁß∞...",clearable:"","prefix-icon":a(eo)},null,8,["modelValue","prefix-icon"])]),l(a(ja),{data:_.value,stripe:"",style:{width:"100%"},"max-height":"50vh",border:!0,"span-method":N,width:"100%"},{default:c(()=>[l(a(So),{label:"ÊúçÂä°ÂïÜ",align:"center",prop:"provider",width:"120"},{default:c(P=>[s("strong",null,ee(P.row.label.split("|")[0]),1)]),_:1}),l(a(So),{label:"Ê®°Âûã",align:"center",prop:"modelName"},{default:c(P=>[l(a(ue),{content:P.row.value===S.currentModel?"ÂΩìÂâçÊ®°ÂûãÔºåÂÜçÊ¨°ÁÇπÂáªÂèØ‰øùÂ≠ò‰∏∫ÈªòËÆ§":"ÈÄâÊã©Ê≠§Ê®°Âûã",placement:"top",enterable:!1},{default:c(()=>[l(a(U),{link:"",size:"large",onClick:F=>j(P.row),class:Me({"is-current-model":P.row.value===S.currentModel})},{default:c(()=>[X(ee(P.row.label.split("|")[1]),1)]),_:2},1032,["onClick","class"])]),_:2},1032,["content"])]),_:1})]),_:1},8,["data"])]),_:1},8,["model-value"]))}},ml=_t(vl,[["__scopeId","data-v-f79263e1"]]);class gl{constructor(B={}){this.options=Object.assign({theme:"auto",scope:"body",beforeShow:null},B),this.container=null,this.input=null,this.matches=[],this.currentIndex=-1,this.isOpen=!1,this.searchScope=null,this._handleResize=this._constrainToWindow.bind(this),this._init()}_init(){this._injectStyles(),this._createUI(),this._bindEvents(),this.setTheme(this.options.theme),this.setScope(this.options.scope)}_injectStyles(){const B="text-search-ui-style";if(document.getElementById(B))return;const i=`
      :root {
        --ts-bg: #ffffff;
        --ts-text: #333333;
        --ts-border: #e5e7eb;
        --ts-hover: #f3f4f6;
        --ts-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
        --ts-highlight: #ffeb3b;
        --ts-highlight-current: #ff9800;
        --ts-highlight-text: #000000;
      }
      
      [data-search-theme="dark"] {
        --ts-bg: #2a2a2a;
        --ts-text: #e5e7eb;
        --ts-border: #4b5563;
        --ts-hover: #374151;
        --ts-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.5);
        --ts-highlight: #b45309;
        --ts-highlight-current: #f59e0b;
        --ts-highlight-text: #ffffff;
      }

      .text-search-container {
        position: fixed;
        top: 20px;
        right: 40px;
        z-index: 10000;
        background: var(--ts-bg);
        color: var(--ts-text);
        padding: 8px;
        border-radius: 6px;
        box-shadow: var(--ts-shadow);
        border: 1px solid var(--ts-border);
        display: flex;
        align-items: center;
        gap: 8px;
        font-family: system-ui, -apple-system, sans-serif;
        font-size: 14px;
        transition: opacity 0.2s;
        min-width: 300px;
      }

      .text-search-container.hidden {
        opacity: 0;
        pointer-events: none;
        /* ÈöêËóèÊó∂‰∏çÊîπÂèò‰ΩçÁΩÆÔºåÈÅøÂÖçÂä®Áîª‰π±Ë∑≥ÔºåÂè™ÊîπÈÄèÊòéÂ∫¶ÂíåÁÇπÂáªÁ©øÈÄè */
        visibility: hidden; 
      }

      .text-search-drag-handle {
        cursor: move;
        color: var(--ts-text);
        opacity: 0.5;
        padding: 0 4px;
        user-select: none;
      }

      .text-search-input {
        background: transparent;
        border: none;
        color: var(--ts-text);
        outline: none;
        flex-grow: 1;
        width: 120px;
        font-size: 14px;
      }

      .text-search-count {
        font-size: 12px;
        color: var(--ts-text);
        opacity: 0.7;
        white-space: nowrap;
        min-width: 40px;
        text-align: center;
        user-select: none;
      }

      .text-search-divider {
        width: 1px;
        height: 16px;
        background: var(--ts-border);
        margin: 0 4px;
      }

      .text-search-btn {
        background: transparent;
        border: none;
        color: var(--ts-text);
        cursor: pointer;
        padding: 4px;
        border-radius: 4px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background 0.1s;
      }

      .text-search-btn:hover {
        background: var(--ts-hover);
      }

      .text-search-btn:disabled {
        opacity: 0.3;
        cursor: not-allowed;
      }

      mark.search-highlight {
        background-color: var(--ts-highlight);
        color: var(--ts-highlight-text);
        border-radius: 2px;
        padding: 0 1px;
      }

      mark.search-highlight.current {
        background-color: var(--ts-highlight-current);
        color: var(--ts-highlight-text);
        outline: 2px solid rgba(255, 255, 255, 0.3);
      }
    `,M=document.createElement("style");M.id=B,M.textContent=i,document.head.appendChild(M)}_createUI(){this.container=document.createElement("div"),this.container.className="text-search-container hidden",this.container.innerHTML=`
      <div class="text-search-drag-handle">‚ãÆ‚ãÆ</div>
      <input type="text" class="text-search-input" placeholder="Êü•ÊâæÊ∂àÊÅØ..." />
      <span class="text-search-count">0/0</span>
      <div class="text-search-divider"></div>
      <button class="text-search-btn btn-prev" title="‰∏ä‰∏Ä‰∏™ (Shift+Enter)">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 15l-6-6-6 6"/></svg>
      </button>
      <button class="text-search-btn btn-next" title="‰∏ã‰∏Ä‰∏™ (Enter)">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9l6 6 6-6"/></svg>
      </button>
      <button class="text-search-btn btn-close" title="ÂÖ≥Èó≠ (Esc)">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg>
      </button>
    `,document.body.appendChild(this.container),this.input=this.container.querySelector(".text-search-input"),this.countSpan=this.container.querySelector(".text-search-count"),this.btnPrev=this.container.querySelector(".btn-prev"),this.btnNext=this.container.querySelector(".btn-next"),this.btnClose=this.container.querySelector(".btn-close")}_bindEvents(){this.input.addEventListener("input",_=>{this.search(_.target.value)}),this.input.addEventListener("keydown",_=>{_.key==="Enter"&&(_.preventDefault(),_.shiftKey?this.findPrevious():this.findNext())}),this.btnPrev.addEventListener("click",()=>this.findPrevious()),this.btnNext.addEventListener("click",()=>this.findNext()),this.btnClose.addEventListener("click",()=>this.hide()),document.addEventListener("keydown",_=>{(_.ctrlKey||_.metaKey)&&_.key==="f"&&(_.preventDefault(),this.show()),_.key==="Escape"&&this.isOpen&&(_.preventDefault(),this.hide())}),window.addEventListener("resize",this._handleResize);const B=this.container.querySelector(".text-search-drag-handle");let i=!1,M,z,O,I;B.addEventListener("mousedown",_=>{i=!0,M=_.clientX,z=_.clientY;const N=this.container.getBoundingClientRect();O=N.left,I=N.top,this.container.style.right="auto",this.container.style.width=N.width+"px"}),document.addEventListener("mousemove",_=>{if(!i)return;_.preventDefault();const N=_.clientX-M,j=_.clientY-z;let J=O+N,q=I+j;const y=window.innerWidth,P=window.innerHeight,F=this.container.getBoundingClientRect();J<0?J=0:J+F.width>y&&(J=y-F.width),q<0?q=0:q+F.height>P&&(q=P-F.height),this.container.style.left=`${J}px`,this.container.style.top=`${q}px`}),document.addEventListener("mouseup",()=>{i=!1})}_constrainToWindow(){if(!this.container)return;const B=this.container.getBoundingClientRect(),i=window.innerWidth,M=window.innerHeight;let z=B.left,O=B.top,I=!1;B.right>i&&(z=i-B.width,z<0&&(z=0),I=!0),B.bottom>M&&(O=M-B.height,O<0&&(O=0),I=!0),I&&(this.container.style.left=`${z}px`,this.container.style.top=`${O}px`,this.container.style.right="auto")}setScope(B){typeof B=="string"?this.searchScope=document.querySelector(B):B instanceof HTMLElement?this.searchScope=B:this.searchScope=document.body}setTheme(B){if(B==="auto"){const i=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches;document.body.setAttribute("data-search-theme",i?"dark":"light")}else document.body.setAttribute("data-search-theme",B)}show(){this.options.beforeShow&&this.options.beforeShow(),this.container.classList.remove("hidden"),this.isOpen=!0,this._constrainToWindow(),setTimeout(()=>this.input.focus(),50),this.input.value&&this.search(this.input.value)}hide(){this.container.classList.add("hidden"),this.isOpen=!1,this.clear(),document.activeElement.blur()}clear(){this.searchScope.querySelectorAll("mark.search-highlight").forEach(i=>{const M=i.parentNode;M.replaceChild(document.createTextNode(i.textContent),i),M.normalize()}),this.matches=[],this.currentIndex=-1,this.updateCount()}search(B){if(this.clear(),!B)return;const i=new RegExp(B.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"gi"),M=document.createTreeWalker(this.searchScope,NodeFilter.SHOW_TEXT,{acceptNode:I=>I.parentElement.closest(".text-search-container, script, style, .no-search")?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}),z=[];let O;for(;O=M.nextNode();)z.push(O);for(const I of z){const _=I.nodeValue;let N,j=0;const J=[];let q=!1;for(i.lastIndex=0;(N=i.exec(_))!==null;){q=!0,N.index>j&&J.push(document.createTextNode(_.substring(j,N.index)));const y=document.createElement("mark");y.className="search-highlight",y.textContent=N[0],J.push(y),this.matches.push(y),j=i.lastIndex}if(q){j<_.length&&J.push(document.createTextNode(_.substring(j)));const y=I.parentNode;J.forEach(P=>y.insertBefore(P,I)),y.removeChild(I)}}this.matches.length>0&&this.jumpTo(0),this.updateCount()}jumpTo(B){if(this.matches.length===0)return;this.currentIndex>=0&&this.matches[this.currentIndex]&&this.matches[this.currentIndex].classList.remove("current"),this.currentIndex=(B+this.matches.length)%this.matches.length;const i=this.matches[this.currentIndex];i.classList.add("current"),i.scrollIntoView({behavior:"smooth",block:"center"}),this.updateCount()}findNext(){this.jumpTo(this.currentIndex+1)}findPrevious(){this.jumpTo(this.currentIndex-1)}updateCount(){const B=this.matches.length,i=B===0?0:this.currentIndex+1;this.countSpan.textContent=`${i}/${B}`,this.btnPrev.disabled=B===0,this.btnNext.disabled=B===0}destroy(){window.removeEventListener("resize",this._handleResize),this.container&&this.container.remove()}}const Dt=S=>{if(!S)return"";try{const B=new Date(S),i=B.toLocaleDateString("sv-SE"),M=B.toLocaleTimeString("sv-SE",{hour:"2-digit",minute:"2-digit"});return`${i} ${M}`}catch{return""}},Zl=S=>{if(!S)return"";if(!Array.isArray(S))return String(S);let B="";return S.forEach(i=>{i.type==="text"&&i.text&&!(i.text.toLowerCase().startsWith("file name:")&&i.text.toLowerCase().endsWith("file end"))&&(B+=i.text)}),B.trim()},hl=S=>{if(!S)return"{}";try{return JSON.parse(S),S}catch{let i=S.indexOf("{");if(i===-1)return"{}";let M=0;for(let z=i;z<S.length;z++)if(S[z]==="{"?M++:S[z]==="}"&&M--,M===0){const O=S.substring(i,z+1);try{return JSON.parse(O),O}catch{return"{}"}}return"{}"}},wl={key:0,class:"window-bg-base"},yl={class:"main-area-wrapper"},bl={key:0,class:"scroll-to-bottom-wrapper"},xl={key:1,class:"custom-viewer-actions"},Cl={class:"mcp-dialog-content"},kl={class:"mcp-dialog-toolbar"},Sl={class:"mcp-server-list custom-scrollbar"},$l=["onClick"],Ml={class:"mcp-server-content"},_l={class:"mcp-server-header-row"},Ll={class:"mcp-server-name"},Tl={key:0,class:"mcp-tool-count"},El={class:"mcp-header-right-group"},Al={class:"mcp-server-tags"},Bl={class:"mcp-server-body-row"},Il=["onClick"],zl=["onClick"],Dl={class:"mcp-tool-info"},Pl={class:"mcp-tool-name"},Vl=["title"],Rl={key:1,class:"mcp-tools-empty"},Ol={class:"mcp-dialog-footer-search"},Fl={class:"mcp-dialog-footer"},Nl={class:"footer-left-controls"},Hl={__name:"App",setup(S){const B=Za(()=>Mt(()=>import("./ChatMessage-CXUcsiEn.js").then(e=>e.a5),__vite__mapDeps([3,1,4,2,5]),import.meta.url)),i=e=>{const t=typeof e=="string"?{message:e}:e,o=t.duration!==void 0?t.duration:1e3;let n=null;const r={...t,duration:o,showClose:!1,grouping:!0,offset:40,onClick:()=>{n&&n.close()}};n=$t(r)};i.success=e=>i({message:e,type:"success"}),i.error=e=>i({message:e,type:"error"}),i.info=e=>i({message:e,type:"info"}),i.warning=e=>i({message:e,type:"warning"});const M=()=>window.api.windowControl("minimize-window"),z=()=>window.api.windowControl("maximize-window"),O=()=>Ct(),I=w(null),_=w(null),N=w(null),j=w(null),J=w(!0),q=w(!1),y=w(!1),P=new Map,F=w(null),re=w(!0);let Ie=null,Oe=null,Fe=null;const wt=(e,t)=>{e?P.set(t,e):P.delete(t)},je=e=>{const t=L.value[e];if(t)return P.get(t.id)},ct=new URLSearchParams(window.location.search).get("dark")==="1";ct&&document.documentElement.classList.add("dark");const Ke=window.api.defaultConfig,ye=w("user.png"),Le=w("ai.svg"),me=w("favicon.png"),D=w(""),Ue=w(!1),ze=w(!1),We=w({os:"macos",code:"AI",type:"over",payload:"ËØ∑ÁÆÄÊ¥ÅÂú∞‰ªãÁªç‰∏Ä‰∏ã‰Ω†Ëá™Â∑±"}),De=JSON.parse(JSON.stringify(Ke.config));ct&&(De.isDarkMode=!0);const g=w(De),ae=w(!1),Pe=w([]),ke=w({}),Y=w(""),yt=w(!0),bt=w("win"),_e=w(Ke.config.providerOrder[0]),Ye=w(""),Xe=w(""),H=w([]),L=w([]),ge=w(!1),lt=w(""),Te=w(null),Ee=w([]),ie=w(1),Ae=w(new Set),G=w(""),be=w(null),qe=w("default"),Se=w(0),ut=w(null),Be=w(""),Ge=ve(()=>Be.value?Be.value:!D.value||!g.value?.prompts?"":g.value.prompts[D.value]?.backgroundImage||""),Tt=ve(()=>!D.value||!g.value?.prompts?.5:g.value.prompts[D.value]?.backgroundOpacity??.5),Ne=ve(()=>!D.value||!g.value?.prompts?0:g.value.prompts[D.value]?.backgroundBlur??0),Et=async e=>{if(!e){Be.value&&(Be.value.startsWith("blob:")&&URL.revokeObjectURL(Be.value),Be.value="");return}if(!(e.startsWith("data:")||e.startsWith("file:")))try{const t=await window.api.getCachedBackgroundImage(e);if(t){const o=new Blob([t]),n=URL.createObjectURL(o);Be.value&&Be.value.startsWith("blob:")&&URL.revokeObjectURL(Be.value),Be.value=n}else console.log(`[Background] Cache miss, downloading in background: ${e}`),window.api.cacheBackgroundImage(e)}catch(t){console.error("Failed to load cached background:",t)}};ht(()=>!D.value||!g.value?.prompts?null:g.value.prompts[D.value]?.backgroundImage,async e=>{await Et(e)},{immediate:!1});const Rt=ve(()=>g.value.inputLayout||"horizontal"),ce=w(""),Ze=w(!1),Qe=w(!1),f=w(""),u=w(!1),b=w([]),K=w(0),de=w(new Map),Z=w([]),he=w(!0),He=w(new Map),dt=(e,t)=>{const o=He.value.get(e);o&&(o(t),He.value.delete(e))},Bo=e=>{he.value=e,e&&(He.value.forEach((t,o)=>{t(!0)}),He.value.clear(),L.value.forEach(t=>{t.tool_calls&&t.tool_calls.forEach(o=>{o.approvalStatus==="waiting"&&(o.approvalStatus="approved")})}))},pt=w(!1),xe=w([]),ft=w([]),At=w(""),Bt=w(!1),et=w("all"),st=w({}),vt=w(new Set),to=e=>{vt.value.has(e)?vt.value.delete(e):vt.value.add(e)},Io=async(e,t,o)=>{if(!st.value[e])return;const n=st.value[e],r=n.findIndex(p=>p.name===t);if(r!==-1){n[r].enabled=o;const p=JSON.parse(JSON.stringify(n));try{await window.api.saveMcpToolCache(e,p)}catch(h){console.error("Failed to save tool status:",h),i.error("‰øùÂ≠òÂ∑•ÂÖ∑Áä∂ÊÄÅÂ§±Ë¥•"),n[r].enabled=!o}}},Ot=e=>{const t=st.value[e];if(!t||!Array.isArray(t))return null;const o=t.length;return{enabled:t.filter(r=>r.enabled!==!1).length,total:o}},zo=ve(()=>xe.value.length>0),oo=ve(()=>{if(!g.value||!g.value.mcpServers)return 0;const e=Z.value.filter(o=>{const n=g.value.mcpServers[o];return n&&n.isPersistent&&n.type?.toLowerCase()!=="builtin"}).length,t=Z.value.some(o=>{const n=g.value.mcpServers[o];return n&&!n.isPersistent&&n.type?.toLowerCase()!=="builtin"});return e+(t?1:0)}),ao=ve(()=>!g.value||!g.value.mcpServers?[]:Object.entries(g.value.mcpServers).filter(([,e])=>e.isActive).map(([e,t])=>({id:e,...t})).sort((e,t)=>e.name.localeCompare(t.name))),no=ve(()=>{let e=ao.value;if(et.value==="selected"?e=e.filter(t=>Z.value.includes(t.id)):et.value==="unselected"&&(e=e.filter(t=>!Z.value.includes(t.id))),At.value){const t=At.value.toLowerCase();e=e.filter(o=>o.name&&o.name.toLowerCase().includes(t)||o.description&&o.description.toLowerCase().includes(t)||o.tags&&Array.isArray(o.tags)&&o.tags.some(n=>n.toLowerCase().includes(t))||o.type&&o.type.toLowerCase().includes(t)||o.type&&bo(o.type).toLowerCase().includes(t))}return e}),Do=ve(()=>F.value===null?!1:F.value===L.value.length-1),Po=ve(()=>Do.value?"ÊªöÂä®Âà∞Â∫ïÈÉ®":"Êü•Áúã‰∏ã‰∏ÄÊù°Ê∂àÊÅØ"),xt=async(e="auto")=>{await fe();const t=j.value?.$el;t&&(re.value=!0,t.scrollTo({top:t.scrollHeight,behavior:e}))},Vo=()=>{const e=j.value?.$el;e&&e.scrollTo({top:0,behavior:"smooth"})},lo=()=>{y.value=!0,re.value=!0,J.value=!0,q.value=!1,F.value=null,xt("smooth"),setTimeout(()=>{y.value=!1},500)},Ft=()=>{const e=j.value?.$el;if(!e)return;const t=e.scrollTop;let o=-1,n=1/0;for(let r=L.value.length-1;r>=0;r--){const p=je(r);if(p){const h=p.$el,v=h.offsetTop,m=v+h.clientHeight;if(v<t+e.clientHeight&&m>t){const C=Math.abs(v-t);C<n&&(n=C,o=r)}}}o!==-1&&(F.value=o)},Ro=e=>{if(y.value)return;const t=e.target;if(!t)return;t.scrollHeight-t.scrollTop-t.clientHeight<=20?(re.value||(re.value=!0),J.value||(J.value=!0),q.value=!1,F.value=null):(re.value&&(re.value=!1),J.value&&(J.value=!1),q.value=!0,Ft())},Oo=()=>{Ft();const e=F.value;if(e===null)return;const t=je(e),o=j.value?.$el;if(!t||!o)return;const n=t.$el;if(o.scrollTop-n.offsetTop>5)n.scrollIntoView({behavior:"smooth",block:"start"});else if(e>0){const p=e-1;F.value=p;const h=je(p);h&&h.$el.scrollIntoView({behavior:"smooth",block:"start"})}},Fo=()=>{if(Ft(),F.value!==null&&F.value<L.value.length-1){F.value++;const e=je(F.value);e&&e.$el.scrollIntoView({behavior:"smooth",block:"start"})}else lo()},so=e=>Ae.value.has(e),io=async()=>{await fe(),document.querySelectorAll(".markdown-body pre.hljs").forEach(e=>{if(e.querySelector(".code-block-copy-button"))return;const t=e.querySelector("code");if(!t)return;const o=document.createElement("div");o.className="code-block-wrapper",e.parentNode.insertBefore(o,e),o.appendChild(e);const n=t.textContent||"",p=n.trimEnd().split(`
`).length,h='<svg width="14" height="14" fill="currentColor" viewBox="0 0 16 16"><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/><path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/></svg>',v=m=>{const C=document.createElement("button");C.className=`code-block-copy-button ${m}`,C.innerHTML=h,C.title="Copy code",C.addEventListener("click",async d=>{d.stopPropagation();try{await navigator.clipboard.writeText(n.trimEnd()),i.success("Code copied to clipboard!")}catch($){console.error("Failed to copy code:",$),i.error("Failed to copy code.")}}),o.appendChild(C)};v("code-block-copy-button-bottom"),p>3&&v("code-block-copy-button-top")})},Nt=e=>{if(e.target.tagName!=="IMG"||!e.target.closest(".markdown-wrapper"))return;const t=e.target;t&&t.src&&(b.value=[t.src],K.value=0,u.value=!0)},ro=e=>{if(e.ctrlKey){e.preventDefault();const t=.05;let o=e.deltaY<0?ie.value+t:ie.value-t;ie.value=Math.max(.5,Math.min(2,o)),g.value&&(g.value.zoom=ie.value)}},No=()=>ua(),Ho=async()=>{try{const e=await window.api.getConfig();if(e&&e.config){g.value.providers=e.config.providers,g.value.providerOrder=e.config.providerOrder;const t=[],o={};if(g.value.providerOrder.forEach(n=>{const r=g.value.providers[n];r?.enable&&r.modelList.forEach(p=>{const h=`${n}|${p}`;t.push({key:h,value:h,label:`${r.name}|${p}`}),o[h]=`${r.name}|${p}`})}),Pe.value=t,ke.value=o,_e.value&&g.value.providers[_e.value]){const n=g.value.providers[_e.value];Ye.value=n.url,Xe.value=n.api_key}}}catch(e){console.warn("Ëá™Âä®Âà∑Êñ∞Ê®°ÂûãÂàóË°®Â§±Ë¥•ÔºåÂ∞Ü‰ΩøÁî®ÁºìÂ≠òÊï∞ÊçÆ",e)}Ze.value=!0},Uo=e=>{Y.value=e,_e.value=e.split("|")[0];const t=g.value.providers[_e.value];Ye.value=t.url,Xe.value=t.api_key,I.value?.focus({cursor:"end"})},Ht=()=>{ae.value=!ae.value,ae.value?window.addEventListener("blur",Ct):window.removeEventListener("blur",Ct)},Wo=()=>{window.api.toggleAlwaysOnTop()},qo=()=>mo(),jo=e=>Ma(e),Ko=(e,t)=>$a(e,t),Zo=()=>wo(),co=()=>{f.value=ce.value,Qe.value=!0},Jo=async(e,t)=>{const o=j.value?.$el,n=t.currentTarget,r=n.closest(".chat-message");if(!o||!n||!r)return;const p=o.scrollTop;if(so(e)){const m=r.offsetTop-p;Ae.value.delete(e),await fe();const C=r.offsetTop;o.style.scrollBehavior="auto",o.scrollTop=C-m,o.style.scrollBehavior="smooth"}else{const v=n.getBoundingClientRect().top;Ae.value.add(e),await fe();const m=n.getBoundingClientRect().top;o.style.scrollBehavior="auto",o.scrollTop=p+(m-v),o.style.scrollBehavior="smooth"}},Yo=async(e,t)=>{const o=j.value?.$el,n=t.currentTarget.closest(".chat-message");if(!o||!n)return;const r=o.scrollTop,h=n.offsetTop-r,v=L.value.map((d,$)=>d.role===e?$:-1).filter(d=>d!==-1);if(v.length===0)return;v.some(d=>!Ae.value.has(d))?v.forEach(d=>Ae.value.add(d)):v.forEach(d=>Ae.value.delete(d)),await fe();const C=n.offsetTop;o.style.scrollBehavior="auto",o.scrollTop=C-h,o.style.scrollBehavior="smooth"},Xo=()=>St(!1),Go=()=>Sa(),Qo=()=>_a(),ea=e=>Ee.value.splice(e,1),ta=async({fileList:e})=>{for(const t of e)await Wt(t,Ee.value.length+1);I.value?.focus({cursor:"end"})},oa=()=>ba(),aa=async e=>{Ee.value=[],await Wt(e,0),await St(!1)},uo=()=>{const e=I.value?.senderRef?.$refs.textarea;e&&(_.value=e.selectionStart,N.value=e.selectionEnd)},po=()=>{ze.value&&(ze.value=!1),setTimeout(()=>{if(Qe.value||document.activeElement&&document.activeElement.tagName.toLowerCase()==="textarea"&&document.activeElement.closest(".editing-wrapper")||document.activeElement&&document.activeElement.closest(".text-search-container"))return;const e=I.value?.senderRef?.$refs.textarea;e&&document.activeElement!==e&&(_.value!==null&&N.value!==null?I.value?.focus({position:{start:_.value,end:N.value}}):I.value?.focus({cursor:"end"}))},50)},na=e=>{e&&(async()=>{try{const t=await fetch(e);if(!t.ok)throw new Error(`ÁΩëÁªúÈîôËØØ: ${t.statusText}`);const o=await t.blob();try{if(["image/png","image/jpeg"].includes(o.type)){const r=new ClipboardItem({[o.type]:o});await navigator.clipboard.write([r]),i.success("ÂõæÁâáÂ∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø (WebAPI)");return}}catch(r){console.warn("Web Clipboard API ÂÜôÂÖ•Â§±Ë¥•ÔºåÂ∞ùËØïÂõûÈÄÄÊñπÊ°à:",r)}const n=await new Promise((r,p)=>{const h=new FileReader;h.onloadend=()=>r(h.result),h.onerror=p,h.readAsDataURL(o)});await new Promise(r=>setTimeout(r,50)),await window.api.copyImage(n),i.success("ÂõæÁâáÂ∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø")}catch(t){console.error("Â§çÂà∂ÂõæÁâáÂ§±Ë¥•:",t),i.error(`Â§çÂà∂Â§±Ë¥•: ${t.message}`)}})()},la=async e=>{if(e)try{const o=await(await fetch(e)).blob(),n=await o.arrayBuffer(),r=`image_${Date.now()}.${o.type.split("/")[1]||"png"}`;await window.api.saveFile({title:"‰øùÂ≠òÂõæÁâá",defaultPath:r,buttonLabel:"‰øùÂ≠ò",fileContent:new Uint8Array(n)}),i.success("ÂõæÁâá‰øùÂ≠òÊàêÂäüÔºÅ")}catch(t){!t.message.includes("User cancelled")&&!t.message.includes("Áî®Êà∑ÂèñÊ∂à")&&(console.error("‰∏ãËΩΩÂõæÁâáÂ§±Ë¥•:",t),i.error(`‰∏ãËΩΩÂ§±Ë¥•: ${t.message}`))}},fo=(e,t)=>{if(e<0||e>=L.value.length)return;let o=-1,n=-1;for(let p=0;p<H.value.length;p++)if(H.value[p].role!=="tool"&&n++,n===e){o=p;break}const r=p=>{if(p){if(typeof p.content=="string"||p.content===null)p.content=t;else if(Array.isArray(p.content)){const h=p.content.find(v=>v.type==="text"&&!(v.text&&v.text.toLowerCase().startsWith("file name:")));h?h.text=t:p.content.push({type:"text",text:t})}}};L.value[e]&&r(L.value[e]),o!==-1&&H.value[o]?r(H.value[o]):console.error("ÈîôËØØÔºöÊó†Ê≥ïÂ∞Ü chat_show Á¥¢ÂºïÊò†Â∞ÑÂà∞ history Á¥¢Âºï„ÄÇ‰∏ãÊ¨°APIËØ∑Ê±ÇÂèØËÉΩ‰ºö‰ΩøÁî®ÊóßÊï∞ÊçÆ„ÄÇ")},sa=async e=>{const t=j.value?.$el,o=je(e),n=o?.$el;!t||!n||!o||(o.switchToEditMode(),await fe(),requestAnimationFrame(()=>{requestAnimationFrame(()=>{n.scrollIntoView({behavior:"auto",block:"nearest"})})}))},ia=async({id:e,action:t,content:o})=>{if(t!=="save")return;const n=L.value.findIndex(r=>r.id===e);n!==-1&&(fo(n,o),i.success("Ê∂àÊÅØÂ∑≤Êõ¥Êñ∞"),n===L.value.length-1&&L.value[n].role==="user"&&(await fe(),await wo()))},ra=e=>{e.key==="Enter"&&(e.ctrlKey||e.metaKey)&&(e.preventDefault(),vo())},vo=async()=>{const e=f.value;ce.value=e;const t=H.value.findIndex(o=>o.role==="system");if(t!==-1)H.value[t].content=e,L.value[t]&&(L.value[t].content=e);else{const o={role:"system",content:e};H.value.unshift(o),L.value.unshift({...o,id:Se.value++})}try{if(!!g.value.prompts[D.value])await window.api.saveSetting(`prompts.${D.value}.prompt`,e),g.value.prompts[D.value].prompt=e,i.success("Âø´Êç∑Âä©ÊâãÊèêÁ§∫ËØçÂ∑≤Êõ¥Êñ∞");else{const n=await window.api.getConfig(),r=ut.value||Ke.config.prompts.AI,p={...r,icon:Le.value,prompt:e,enable:!0,model:Y.value||r.model,enable:!0,stream:!0,isTemperature:!1,temperature:.7,ifTextNecessary:!1,isDirectSend_file:!0,isDirectSend_normal:!0,voice:"",isAlwaysOnTop:n.config.isAlwaysOnTop_global,autoCloseOnBlur:n.config.autoCloseOnBlur_global,window_width:540,window_height:700,position_x:0,position_y:0,reasoning_effort:"default",zoom:1};n.config.prompts[D.value]=p,await window.api.updateConfig(n),g.value=n.config,ut.value=p,i.success(`Â∑≤‰∏∫ÊÇ®ÂàõÂª∫Âπ∂‰øùÂ≠òÊñ∞ÁöÑÂø´Êç∑Âä©Êâã: "${D.value}"`)}}catch(o){console.error("‰øùÂ≠òÁ≥ªÁªüÊèêÁ§∫ËØçÂ§±Ë¥•:",o),i.error(`‰øùÂ≠òÂ§±Ë¥•: ${o.message}`)}Qe.value=!1},Ct=async()=>{if(!ze.value){if(g.value?.webdav?.localChatPath&&G.value)try{await It()}catch(e){console.error("ÂÖ≥Èó≠Êó∂Ëá™Âä®‰øùÂ≠òÂ§±Ë¥•:",e)}window.api.windowControl("close-window")}},ca=()=>{ze.value=!0};ht(ie,e=>{window.api&&typeof window.api.setZoomFactor=="function"&&window.api.setZoomFactor(e)}),ht(L,async()=>{await io()},{deep:!0,flush:"post"}),ht(()=>g.value?.isDarkMode,e=>{e?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark"),Fe&&Fe.setTheme(e?"dark":"light")},{immediate:!0}),Gt(async()=>{if(Ue.value)return;Ue.value=!0,window.api&&window.api.onAlwaysOnTopChanged&&window.api.onAlwaysOnTopChanged(o=>{yt.value=o}),Fe=new gl({scope:".chat-main",theme:g.value?.isDarkMode?"dark":"light"}),window.addEventListener("wheel",ro,{passive:!1}),window.addEventListener("focus",po),window.addEventListener("blur",uo);const e=j.value?.$el;e&&(e.addEventListener("click",Nt),Ie=new MutationObserver(()=>{re.value&&(e.scrollTop=e.scrollHeight)}),Ie.observe(e,{childList:!0,subtree:!0,characterData:!0}));const t=async(o=null)=>{try{const m=await window.api.getConfig();g.value=m.config}catch{g.value=Ke.config,i.error("Âä†ËΩΩÁî®Êà∑ÈÖçÁΩÆÂ§±Ë¥•Ôºå‰ΩøÁî®ÈªòËÆ§ÈÖçÁΩÆ„ÄÇ")}try{const m=await window.api.getUser();ye.value=m.avatar}catch{ye.value="user.png"}o?.os&&(bt.value=o.os),Pe.value=[],ke.value={},g.value.providerOrder.forEach(m=>{const C=g.value.providers[m];C?.enable&&C.modelList.forEach(d=>{const $=`${m}|${d}`;Pe.value.push({key:$,value:$,label:`${C.name}|${d}`}),ke.value[$]=`${C.name}|${d}`})});const n=o?.code||"AI",r=g.value.prompts[n]||Ke.config.prompts.AI;r.backgroundImage&&Et(r.backgroundImage),yt.value=o?.isAlwaysOnTop??r.isAlwaysOnTop??!0,ie.value=r.zoom||g.value.zoom||1,window.api&&typeof window.api.setZoomFactor=="function"&&window.api.setZoomFactor(ie.value),g.value.isDarkMode&&document.documentElement.classList.add("dark"),D.value=n,document.title=n,ut.value=r,r.icon?(Le.value=r.icon,me.value=r.icon):(Le.value="ai.svg",me.value=g.value.isDarkMode?"favicon-b.png":"favicon.png"),ae.value=r.autoCloseOnBlur??!1,qe.value=r.reasoning_effort||"default",Y.value=r.model||Pe.value[0]?.value||"",be.value=r.voice||null,Y.value&&(_e.value=Y.value.split("|")[0],Ye.value=g.value.providers[_e.value]?.url,Xe.value=g.value.providers[_e.value]?.api_key),r.prompt?(ce.value=r.prompt,H.value=[{role:"system",content:r.prompt}],L.value=[{role:"system",content:r.prompt,id:Se.value++}]):(ce.value="",H.value=[],L.value=[]);let p=!1,h=!1;if(o){if(We.value={code:o.code,type:o.type,payload:o.payload},o.filename&&(G.value=o.filename.replace(/\.json$/i,"")),o.type==="over"&&o.payload){let m=!1;try{let C=JSON.parse(o.payload);C&&C.anywhere_history===!0&&(m=!0,await go(C),ae.value=!1)}catch{}m||D.value.trim().toLowerCase().includes(o.payload.trim().toLowerCase())||(r.isDirectSend_normal?(H.value.push({role:"user",content:o.payload}),L.value.push({id:Se.value++,role:"user",content:[{type:"text",text:o.payload}]}),p=!0):lt.value=o.payload)}else if(o.type==="img"&&o.payload)r.isDirectSend_normal?(H.value.push({role:"user",content:[{type:"image_url",image_url:{url:String(o.payload)}}]}),L.value.push({id:Se.value++,role:"user",content:[{type:"image_url",image_url:{url:String(o.payload)}}]}),p=!0):Ee.value.push({uid:1,name:"Êà™Âõæ.png",size:0,type:"image/png",url:String(o.payload)});else if(o.type==="files"&&o.payload)try{let m=!1;if(o.payload.length===1&&o.payload[0].path.toLowerCase().endsWith(".json")){const C=await window.api.handleFilePath(o.payload[0].path);C&&(m=await ho(C))}if(!m){const C=o.payload.map(d=>ga(d.path));await Promise.all(C),r.isDirectSend_file&&(p=!0,h=!0)}}catch(m){console.error("Error during initial file processing:",m),i.error("Êñá‰ª∂Â§ÑÁêÜÂ§±Ë¥•: "+m.message)}}ae.value&&window.addEventListener("blur",Ct);const v=r.defaultMcpServers;Array.isArray(v)&&v.length>0&&(xe.value=[...v],Z.value=[...v],await kt(!1)),p&&(xt(),h?await St(!1):await St(!0)),await io(),setTimeout(()=>{I.value?.focus({cursor:"end"})},100)};if(window.preload&&typeof window.preload.receiveMsg=="function")window.preload.receiveMsg(async o=>{await t(o)});else{const o={os:"win",code:"Moss",config:await window.api.getConfig().config};await t(o)}Oe&&clearInterval(Oe),Oe=setInterval(It,15e3),window.addEventListener("error",xo,!0),window.addEventListener("keydown",Co),window.api&&window.api.onConfigUpdated&&window.api.onConfigUpdated(o=>{o&&(g.value=o,o.zoom!==void 0&&(ie.value=o.zoom))})});const It=async()=>{if(ge.value||!g.value?.webdav?.localChatPath)return;const t=g.value?.prompts?.[D.value]?.autoSaveChat??!0;if(!(!G.value&&!t)){if(!G.value&&L.value.length>0){const o=L.value.find(n=>n.role==="user");if(o){let n="";const r=o.content;if(Array.isArray(r)){const p=r.some(m=>m.type==="image_url"),h=r.some(m=>m.type==="file"),v=r.find(m=>m.type==="text");p?n="ÂõæÁâá":h?n="Êñá‰ª∂":v?.text&&(n=v.text.slice(0,20).replace(/[\\/:*?"<>|\n\r]/g,"").trim())}else typeof r=="string"&&(n=r.slice(0,20).replace(/[\\/:*?"<>|\n\r]/g,"").trim());if(n){const p=D.value.replace(/[\\/:*?"<>|]/g,"_"),h=new Date,v=`${h.getFullYear()}${String(h.getMonth()+1).padStart(2,"0")}${String(h.getDate()).padStart(2,"0")}-${String(h.getHours()).padStart(2,"0")}${String(h.getMinutes()).padStart(2,"0")}${String(h.getSeconds()).padStart(2,"0")}`;G.value=`${n}-${p}-${v}`}}}if(G.value)try{const o=Ut(),n=JSON.stringify(o,null,2),r=`${g.value.webdav.localChatPath}/${G.value}.json`;await window.api.writeLocalFile(r,n)}catch(o){console.error("Auto-save failed:",o)}}};Qt(async()=>{window.removeEventListener("wheel",ro),window.removeEventListener("focus",po),window.removeEventListener("blur",uo),Fe&&Fe.destroy(),ae.value||window.removeEventListener("blur",Ct);const e=j.value?.$el;e&&e.removeEventListener("click",Nt),await window.api.closeMcpClient(),window.removeEventListener("error",xo,!0),window.removeEventListener("keydown",Co),Ie&&(Ie.disconnect(),Ie=null)});const ua=async()=>{if(!D.value||!g.value.prompts[D.value]){i.warning("Êó†Ê≥ï‰øùÂ≠òÁ™óÂè£ËÆæÁΩÆÔºåÂõ†‰∏∫ÂΩìÂâç‰∏çÊòØ‰∏Ä‰∏™Â∑≤ÂÆö‰πâÁöÑÂø´Êç∑Âä©Êâã„ÄÇ");return}if(window.fullScreen){i.warning("Êó†Ê≥ïÂú®ÂÖ®Â±èÊ®°Âºè‰∏ã‰øùÂ≠òÁ™óÂè£‰ΩçÁΩÆÂíåÂ§ßÂ∞è„ÄÇ");return}const e={window_height:window.outerHeight,window_width:window.outerWidth,zoom:ie.value,position_x:window.screenX,position_y:window.screenY};try{const t=await window.api.savePromptWindowSettings(D.value,e);t.success?(i.success("ÂΩìÂâçÂø´Êç∑Âä©ÊâãÁöÑÁ™óÂè£Â§ßÂ∞è„ÄÅ‰ΩçÁΩÆ‰∏éÁº©ÊîæÂ∑≤‰øùÂ≠ò"),g.value.prompts[D.value]&&Object.assign(g.value.prompts[D.value],e)):i.error(`‰øùÂ≠òÂ§±Ë¥•: ${t.message}`)}catch(t){console.error("Error saving window settings:",t),i.error("‰øùÂ≠òÁ™óÂè£ËÆæÁΩÆÊó∂Âá∫Èîô")}},Ut=()=>{const e=g.value.prompts[D.value]||{};return{anywhere_history:!0,CODE:D.value,basic_msg:We.value,isInit:Ue.value,autoCloseOnBlur:ae.value,model:Y.value,currentPromptConfig:e,history:H.value,chat_show:L.value,selectedVoice:be.value,activeMcpServerIds:xe.value||[],isAutoApproveTools:he.value}},da=async()=>{const e=new Date,t=String(e.getFullYear()).slice(-2),o=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).toString().padStart(2,"0"),r=String(e.getHours()).toString().padStart(2,"0"),p=String(e.getMinutes()).toString().padStart(2,"0"),h=G.value||`${D.value||"AI"}-${t}${o}${n}-${r}${p}`,v=w(h);try{await tt({title:"‰øùÂ≠òÂà∞‰∫ëÁ´Ø",message:()=>se("div",null,[se("p",{style:"margin-bottom: 15px; font-size: 14px; color: var(--el-text-color-regular);"},"ËØ∑ËæìÂÖ•Ë¶Å‰øùÂ≠òÂà∞‰∫ëÁ´ØÁöÑ‰ºöËØùÂêçÁß∞„ÄÇ"),se(ot,{modelValue:v.value,"onUpdate:modelValue":m=>{v.value=m},placeholder:"Êñá‰ª∂Âêç",ref:m=>{m&&setTimeout(()=>m.focus(),100)},onKeydown:m=>{m.key==="Enter"&&(m.preventDefault(),document.querySelector(".filename-prompt-dialog .el-message-box__btns .el-button--primary")?.click())}},{append:()=>se("div",{class:"input-suffix-display"},".json")})]),showCancelButton:!0,confirmButtonText:"Á°ÆËÆ§",cancelButtonText:"ÂèñÊ∂à",customClass:"filename-prompt-dialog",beforeClose:async(m,C,d)=>{if(m==="confirm"){let $=v.value.trim();if(!$){i.error("Êñá‰ª∂Âêç‰∏çËÉΩ‰∏∫Á©∫");return}$.toLowerCase().endsWith(".json")&&($=$.slice(0,-5));const T=$+".json";C.confirmButtonLoading=!0,i.info("Ê≠£Âú®‰øùÂ≠òÂà∞‰∫ëÁ´Ø...");try{const k=Ut(),A=JSON.stringify(k,null,2),{url:x,username:V,password:oe,data_path:pe}=g.value.webdav,Q=Lo(x,{username:V,password:oe}),$e=pe.endsWith("/")?pe.slice(0,-1):pe,ne=`${$e}/${T}`;await Q.exists($e)||await Q.createDirectory($e,{recursive:!0}),await Q.putFileContents(ne,A,{overwrite:!0}),G.value=$,i.success("‰ºöËØùÂ∑≤ÊàêÂäü‰øùÂ≠òÂà∞‰∫ëÁ´ØÔºÅ"),d()}catch(k){console.error("WebDAV save failed:",k),i.error(`‰øùÂ≠òÂà∞‰∫ëÁ´ØÂ§±Ë¥•: ${k.message}`)}finally{C.confirmButtonLoading=!1}}else d()}})}catch(m){m!=="cancel"&&m!=="close"&&console.error("MessageBox error:",m)}},pa=async()=>{let e="";const t=new Date,o=`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")} ${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}`,n=`${String(t.getFullYear()).slice(-2)}${String(t.getMonth()+1).padStart(2,"0")}${String(t.getDate()).padStart(2,"0")}-${String(t.getHours()).padStart(2,"0")}${String(t.getMinutes()).padStart(2,"0")}`,r=G.value||`${D.value||"AI"}-${n}`,p=d=>Array.isArray(d)?d.map($=>$.type==="text"?$.text.trim():"").join(" "):String(d).trim(),h=d=>Array.isArray(d)?d.filter($=>$.type!=="text").map($=>$.type==="file"?$.file.filename:"Image"):[],v=d=>d?d.split(`
`).map($=>`> ${$}`).join(`
`):"",m=(d,$=50)=>{if(!d)return"";const T=String(d);return T.length>$?T.substring(0,$)+"...":T};e+=`# ËÅäÂ§©ËÆ∞ÂΩï: ${D.value} (${o})

### ÂΩìÂâçÊ®°Âûã: ${ke.value[Y.value]||"N/A"}

`,ce.value&&ce.value.trim()&&(e+=`### Á≥ªÁªüÊèêÁ§∫ËØç

${v(ce.value.trim())}

`),e+=`---

`;for(const d of L.value)if(d.role!=="system"){if(d.role==="user"){let $="### üë§ Áî®Êà∑";d.timestamp&&($+=` - *${Dt(d.timestamp)}*`),e+=`${$}

`;const T=p(d.content),k=h(d.content);T&&(e+=`${v(T)}

`),k.length>0&&(e+=`> **ÈôÑ‰ª∂ÂàóË°®:**
`,k.forEach(A=>{e+=`> - \`${A}\`
`}),e+=`
`)}else if(d.role==="assistant"){let $=`### ü§ñ ${d.aiName||"AI"}`;d.voiceName&&($+=` (${d.voiceName})`),d.completedTimestamp&&($+=` - *${Dt(d.completedTimestamp)}*`),e+=`${$}

`,d.reasoning_content&&(e+=`> *ÊÄùËÄÉËøáÁ®ã:*
${v(d.reasoning_content)}

`),d.tool_calls&&d.tool_calls.length>0&&(e+=`> **Â∑•ÂÖ∑Ë∞ÉÁî®:**
`,d.tool_calls.forEach(k=>{e+=`> - üõ†Ô∏è \`${k.name}\`: ${m(k.result)}
`}),e+=`
`);const T=p(d.content);T?e+=`${v(T)}

`:d.status&&(e+=`> *(AIÊ≠£Âú®ÊÄùËÄÉ...)*

`)}e+=`---

`}const C=w(r);try{await tt({title:"‰øùÂ≠ò‰∏∫ Markdown",message:()=>se("div",null,[se("p",{style:"margin-bottom: 15px; font-size: 14px; color: var(--el-text-color-regular);"},"ËØ∑ËæìÂÖ•‰ºöËØùÂêçÁß∞„ÄÇ"),se(ot,{modelValue:C.value,"onUpdate:modelValue":d=>{C.value=d},placeholder:"Êñá‰ª∂Âêç",ref:d=>{d&&setTimeout(()=>d.focus(),100)},onKeydown:d=>{d.key==="Enter"&&(d.preventDefault(),document.querySelector(".filename-prompt-dialog .el-message-box__btns .el-button--primary")?.click())}},{append:()=>se("div",{class:"input-suffix-display"},".md")})]),showCancelButton:!0,confirmButtonText:"‰øùÂ≠ò",cancelButtonText:"ÂèñÊ∂à",customClass:"filename-prompt-dialog",beforeClose:async(d,$,T)=>{if(d==="confirm"){let k=C.value.trim();if(!k){i.error("Êñá‰ª∂Âêç‰∏çËÉΩ‰∏∫Á©∫");return}k.toLowerCase().endsWith(".md")&&(k=k.slice(0,-3));const A=k+".md";$.confirmButtonLoading=!0;try{await window.api.saveFile({title:"‰øùÂ≠ò‰∏∫ Markdown",defaultPath:A,buttonLabel:"‰øùÂ≠ò",filters:[{name:"Markdown Êñá‰ª∂",extensions:["md"]},{name:"ÊâÄÊúâÊñá‰ª∂",extensions:["*"]}],fileContent:e}),G.value=k,i.success("‰ºöËØùÂ∑≤ÊàêÂäü‰øùÂ≠ò‰∏∫ MarkdownÔºÅ"),T()}catch(x){x.message.includes("canceled by the user")||(console.error("‰øùÂ≠ò Markdown Â§±Ë¥•:",x),i.error(`‰øùÂ≠òÂ§±Ë¥•: ${x.message}`)),T()}finally{$.confirmButtonLoading=!1}}else T()}})}catch(d){d!=="cancel"&&d!=="close"&&console.error("MessageBox error:",d)}},fa=async()=>{const e=new Date,t=`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")} ${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`,o=`${String(e.getFullYear()).slice(-2)}${String(e.getMonth()+1).padStart(2,"0")}${String(e.getDate()).padStart(2,"0")}-${String(e.getHours()).padStart(2,"0")}${String(e.getMinutes()).padStart(2,"0")}`,n=G.value||`${D.value||"AI"}-${o}`,r=w(n),p='<svg width="200" height="200" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><circle cx="50" cy="50" r="50" fill="#FDA5A5" /><g stroke="white" stroke-width="3.5" stroke-linecap="round" stroke-linejoin="round" fill="none"><rect x="25" y="32" width="50" height="42" rx="8" /><line x1="40" y1="63" x2="60" y2="63" /><line x1="35" y1="32" x2="32" y2="22" /><line x1="65" y1="32" x2="68" y2="22" /></g><g fill="white" stroke="none"><circle cx="40" cy="48" r="3.5" /><circle cx="60" cy="48" r="3.5" /><circle cx="32" cy="20" r="3" /><circle cx="68" cy="20" r="3" /></g></svg>',h=()=>{let v="",m="";const C=(k,A=50)=>{if(!k)return"";const x=String(k);return x.length>A?x.substring(0,A)+"...":x},d=k=>{if(!k)return"";if(typeof k=="string")return k;if(!Array.isArray(k))return String(k);let A="";return k.forEach(x=>{x.type==="text"&&x.text&&!(x.text.toLowerCase().startsWith("file name:")&&x.text.toLowerCase().endsWith("file end"))&&(A+=x.text)}),A.trim()},$=k=>{if(!k)return"";let A="";return typeof k=="string"?A=k:Array.isArray(k)?A=k.map(x=>x.type==="text"?x.text||"":x.type==="image_url"&&x.image_url?.url?`![Image](${x.image_url.url})`:x.type==="input_audio"&&x.input_audio?.data?`<audio controls src="data:audio/${x.input_audio.format};base64,${x.input_audio.data}"></audio>`:x.type==="file"&&x.file?.filename?`*üìé ÈôÑ‰ª∂: ${x.file.filename}*`:"").join(" "):A=String(k),Eo.parse(A)};if(ce.value&&ce.value.trim()){const k="Á≥ªÁªüÊèêÁ§∫ËØç",A="system-dot",x="msg-system";m+=`
        <li class="timeline-item">
            <a href="#${x}" class="timeline-dot ${A}" aria-label="${k}">
                <span class="timeline-tooltip">${k}</span>
            </a>
        </li>`,v+=`
            <div id="${x}" class="message-wrapper align-left">
              <div class="header system-header"><strong>Á≥ªÁªüÊèêÁ§∫ËØç</strong></div>
              <div class="message-body system-body">${To.sanitize(Eo.parse(ce.value))}</div>
            </div>
          `}return L.value.forEach((k,A)=>{if(k.role==="system")return;const x=k.role==="user",V=`msg-${A}`;let oe="";x?oe=C(d(k.content),30)||"Áî®Êà∑ÂèëÈÄÅÂõæÁâá/Êñá‰ª∂":oe=C(d(k.content),30)||"AI ÂõûÂ§ç",m+=`
        <li class="timeline-item">
            <a href="#${V}" class="timeline-dot ${x?"user-dot":"ai-dot"}" aria-label="${oe}">
                <span class="timeline-tooltip">${oe}</span>
            </a>
        </li>`;let Q=x?ye.value:Le.value;x||(Q==="ai.svg"||!Q.startsWith("http")&&!Q.startsWith("data:"))&&(Q=`data:image/svg+xml;base64,${btoa(p)}`);let $e=x?"Áî®Êà∑":k.aiName||"AI",ne=k.timestamp||k.completedTimestamp,le=x?"align-right":"align-left";const Je=$(k.content);let Ve="";Je&&Je.trim()!==""&&(Ve=To.sanitize(Je,{ADD_TAGS:["video","audio","source","blockquote"],USE_PROFILES:{html:!0,svg:!0},ADD_ATTR:["style"]}));let it="";if(k.tool_calls&&k.tool_calls.length>0&&(it='<div class="tool-calls-wrapper">',k.tool_calls.forEach(rt=>{const Ia=C(rt.result,100).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");it+=`
                <div class="tool-call-box">
                    <span class="tool-icon">üõ†Ô∏è</span>
                    <span class="tool-name">${rt.name}</span>
                    <span class="tool-result">${Ia}</span>
                </div>`}),it+="</div>"),Ve||it){let rt="";x?rt=`
               <div class="header user-header">
                 <span class="timestamp">${ne?Dt(ne):""}</span>
                 <img src="${Q}" class="avatar" alt="avatar">
               </div>`:rt=`
               <div class="header ai-header">
                 <img src="${Q}" class="avatar" alt="avatar">
                 <div class="ai-meta">
                    <div class="ai-name-row">
                        <strong>${$e}</strong>
                        ${k.voiceName?`<span class="voice-tag">(${k.voiceName})</span>`:""}
                    </div>
                    <span class="timestamp">${ne?Dt(ne):""}</span>
                 </div>
               </div>`;const mt=Ve?`<div class="message-body ${x?"user-body":"ai-body"}">${Ve}</div>`:"";v+=`
            <div id="${V}" class="message-wrapper ${le}">
              ${rt}
              ${it}
              ${mt}
            </div>
          `}}),`
      <!DOCTYPE html>
      <html lang="zh-CN">
      <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ËÅäÂ§©ËÆ∞ÂΩï: ${D.value} (${t})</title>
        
      <style>
        :root { 
            --bg-color: #f7f7f7; 
            --text-color: #333; 
            --card-bg: #fff; 
            --user-bg: #e1f5fe; 
            --ai-bg: #fff; 
            --border-color: #eee; 
            --accent-color: #1F2937; 
            --timeline-line: #e0e0e0;
            --timeline-dot-default: #bdbdbd;
            --timeline-dot-active: #1F2937;
        }
        @media (prefers-color-scheme: dark) {
          :root { 
              --bg-color: #1a1a1a; 
              --text-color: #e0e0e0; 
              --card-bg: #2a2a2a; 
              --user-bg: #0d47a1; 
              --ai-bg: #3a3a3a; 
              --border-color: #444; 
              --accent-color: #64b5f6; 
              --timeline-line: #444;
              --timeline-dot-default: #666;
              --timeline-dot-active: #64b5f6;
          }
        }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; margin: 0; padding: 20px; background-color: var(--bg-color); color: var(--text-color); line-height: 1.6; }
        .main-container { max-width: 900px; margin: 0 auto; background-color: var(--card-bg); border-radius: 12px; padding: 40px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); position: relative; }
        .page-header { margin-bottom: 40px; border-bottom: 1px solid var(--border-color); padding-bottom: 20px; }
        .page-header h1 { margin: 0 0 10px 0; font-size: 24px; }
        .page-header p { margin: 0; color: #888; font-size: 13px; }
        .timeline-toc {
            position: fixed;
            top: 50%;
            right: 20px;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            z-index: 100;
            max-height: 80vh;
            overflow-y: auto;
            scrollbar-width: none; 
            padding: 10px;
        }
        .timeline-toc::-webkit-scrollbar { display: none; }
        .timeline-list {
            list-style: none;
            padding: 0;
            margin: 0;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px; 
        }
        .timeline-list::before {
            content: '';
            position: absolute;
            top: 0;
            bottom: 0;
            left: 50%;
            width: 2px;
            background-color: var(--timeline-line);
            transform: translateX(-50%);
            z-index: -1;
            border-radius: 2px;
        }
        .timeline-item { position: relative; }
        .timeline-dot {
            display: block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: var(--card-bg);
            border: 2px solid var(--timeline-dot-default);
            transition: all 0.2s ease;
            position: relative;
        }
        .timeline-dot.user-dot {
            background-color: var(--timeline-dot-active);
            border-color: var(--timeline-dot-active);
            width: 12px; 
            height: 12px;
        }
        .timeline-dot.ai-dot {
            border-color: var(--timeline-dot-default);
        }
        .timeline-dot.system-dot {
            border-color: #795548;
            background-color: #795548;
        }
        .timeline-dot:hover {
            transform: scale(1.4);
            border-color: var(--accent-color);
            background-color: var(--accent-color);
        }
        .timeline-tooltip {
            position: absolute;
            right: 25px;
            top: 50%;
            transform: translateY(-50%);
            background-color: var(--accent-color);
            color: #fff;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s, transform 0.2s;
            max-width: 200px;
            overflow: hidden;
            text-overflow: ellipsis;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }
        .timeline-dot:hover .timeline-tooltip {
            opacity: 1;
            transform: translateY(-50%) translateX(-5px);
        }
        .message-wrapper { display: flex; flex-direction: column; margin-bottom: 30px; scroll-margin-top: 60px; max-width: 100%; }
        .align-right { align-items: flex-end; }
        .align-left { align-items: flex-start; }
        .header { display: flex; align-items: center; gap: 10px; margin-bottom: 6px; font-size: 12px; color: #888; }
        .user-header { flex-direction: row; }
        .ai-header { flex-direction: row; align-items: flex-start; }
        .avatar { width: 32px; height: 32px; border-radius: 6px; object-fit: cover; background-color: #eee; flex-shrink: 0; }
        .ai-meta { display: flex; flex-direction: column; line-height: 1.3; }
        .ai-name-row { display: flex; align-items: center; gap: 5px; }
        .voice-tag { opacity: 0.8; font-size: 11px; }
        .message-body { padding: 12px 16px; border-radius: 12px; word-break: break-word; overflow-wrap: break-word; max-width: 100%; }
        .user-body { background-color: var(--user-bg); border-bottom-right-radius: 2px; color: var(--text-color); max-width: 90%; }
        .ai-body { background-color: var(--ai-bg); border: 1px solid var(--border-color); border-top-left-radius: 2px; width: 100%; box-sizing: border-box; }
        .system-body { background-color: #fff3e0; color: #5d4037; border: 1px dashed #d7ccc8; width: 100%; text-align: center; }
        .tool-calls-wrapper { width: 100%; margin-bottom: 8px; display: flex; flex-direction: column; gap: 4px; }
        .tool-call-box { background-color: var(--bg-color); border: 1px solid var(--border-color); border-radius: 6px; padding: 6px 10px; font-size: 12px; color: #666; display: flex; align-items: center; gap: 8px; }
        .tool-name { font-weight: bold; }
        .tool-result { opacity: 0.7; font-family: monospace; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        img { max-width: 100%; border-radius: 8px; margin: 5px 0; }
        pre { background-color: #2d2d2d; color: #f8f8f2; padding: 1em; border-radius: 8px; overflow-x: auto; font-family: monospace; }
        blockquote { border-left: 4px solid #ccc; padding-left: 1em; margin: 1em 0; color: #666; background: rgba(0,0,0,0.03); }
        @media (max-width: 768px) {
          .timeline-toc { display: none; }
          .main-container { padding: 20px; width: 100%; box-sizing: border-box; border-radius: 0; box-shadow: none; background-color: transparent; }
          .message-body { max-width: 100%; }
          .user-body { max-width: 95%; }
          body { padding: 0; }
        }
      </style>
    
      </head>
      <body>
        <nav class="timeline-toc">
            <ul class="timeline-list">
                ${m}
            </ul>
        </nav>
        <div class="main-container">
            <header class="page-header">
                <h1>${D.value}</h1>
                <p>Ê®°Âûã: ${ke.value[Y.value]||"N/A"} &bull; ÂØºÂá∫Êó∂Èó¥: ${t}</p>
            </header>
            <div class="chat-container">
                ${v}
            </div>
        </div>
      </body>
      </html>
    `};try{await tt({title:"‰øùÂ≠ò‰∏∫ HTML",message:()=>se("div",null,[se("p",{style:"margin-bottom: 15px; font-size: 14px; color: var(--el-text-color-regular);"},"ËØ∑ËæìÂÖ•‰ºöËØùÂêçÁß∞„ÄÇ"),se(ot,{modelValue:r.value,"onUpdate:modelValue":v=>{r.value=v},placeholder:"Êñá‰ª∂Âêç",ref:v=>{v&&setTimeout(()=>v.focus(),100)},onKeydown:v=>{v.key==="Enter"&&(v.preventDefault(),document.querySelector(".filename-prompt-dialog .el-message-box__btns .el-button--primary")?.click())}},{append:()=>se("div",{class:"input-suffix-display"},".html")})]),showCancelButton:!0,confirmButtonText:"‰øùÂ≠ò",cancelButtonText:"ÂèñÊ∂à",customClass:"filename-prompt-dialog",beforeClose:async(v,m,C)=>{if(v==="confirm"){let d=r.value.trim();if(!d){i.error("Êñá‰ª∂Âêç‰∏çËÉΩ‰∏∫Á©∫");return}d.toLowerCase().endsWith(".html")&&(d=d.slice(0,-5));const $=d+".html";m.confirmButtonLoading=!0;try{const T=h();await window.api.saveFile({title:"‰øùÂ≠ò‰∏∫ HTML",defaultPath:$,buttonLabel:"‰øùÂ≠ò",filters:[{name:"HTML Êñá‰ª∂",extensions:["html"]},{name:"ÊâÄÊúâÊñá‰ª∂",extensions:["*"]}],fileContent:T}),G.value=d,i.success("‰ºöËØùÂ∑≤ÊàêÂäü‰øùÂ≠ò‰∏∫ HTMLÔºÅ"),C()}catch(T){!T.message.includes("User cancelled")&&!T.message.includes("Áî®Êà∑ÂèñÊ∂à")&&(console.error("‰øùÂ≠ò HTML Â§±Ë¥•:",T),i.error(`‰øùÂ≠òÂ§±Ë¥•: ${T.message}`)),C()}finally{m.confirmButtonLoading=!1}}else C()}})}catch(v){v!=="cancel"&&v!=="close"&&console.error("MessageBox error:",v)}},va=async()=>{const e=Ut(),t=JSON.stringify(e,null,2),o=new Date,n=`${String(o.getFullYear()).slice(-2)}${String(o.getMonth()+1).padStart(2,"0")}${String(o.getDate()).padStart(2,"0")}-${String(o.getHours()).padStart(2,"0")}${String(o.getMinutes()).padStart(2,"0")}${String(o.getSeconds()).padStart(2,"0")}`,r=G.value||`${D.value||"AI"}-${n}`,p=w(r);try{await tt({title:"‰øùÂ≠ò‰∏∫ JSON",message:()=>se("div",null,[se("p",{style:"margin-bottom: 15px; font-size: 14px; color: var(--el-text-color-regular);"},"ËØ∑ËæìÂÖ•‰ºöËØùÂêçÁß∞„ÄÇ"),se(ot,{modelValue:p.value,"onUpdate:modelValue":h=>{p.value=h},placeholder:"Êñá‰ª∂Âêç",ref:h=>{h&&setTimeout(()=>h.focus(),100)},onKeydown:h=>{h.key==="Enter"&&(h.preventDefault(),document.querySelector(".filename-prompt-dialog .el-message-box__btns .el-button--primary")?.click())}},{append:()=>se("div",{class:"input-suffix-display"},".json")})]),showCancelButton:!0,confirmButtonText:"‰øùÂ≠ò",cancelButtonText:"ÂèñÊ∂à",customClass:"filename-prompt-dialog",beforeClose:async(h,v,m)=>{if(h==="confirm"){let C=p.value.trim();if(!C){i.error("Êñá‰ª∂Âêç‰∏çËÉΩ‰∏∫Á©∫");return}C.toLowerCase().endsWith(".json")&&(C=C.slice(0,-5));const d=C+".json";v.confirmButtonLoading=!0;try{let $=d;const T=g.value.webdav?.localChatPath;if(T){const k=We.value.os==="win"?"\\":"/";$=`${T}${k}${d}`}await window.api.saveFile({title:"‰øùÂ≠òËÅäÂ§©‰ºöËØù",defaultPath:$,buttonLabel:"‰øùÂ≠ò",filters:[{name:"JSON Êñá‰ª∂",extensions:["json"]},{name:"ÊâÄÊúâÊñá‰ª∂",extensions:["*"]}],fileContent:t}),G.value=C,i.success("‰ºöËØùÂ∑≤ÊàêÂäü‰øùÂ≠òÔºÅ"),m()}catch($){!$.message.includes("canceled by the user")&&!$.message.includes("Áî®Êà∑ÂèñÊ∂à")&&(console.error("‰øùÂ≠ò‰ºöËØùÂ§±Ë¥•:",$),i.error(`‰øùÂ≠òÂ§±Ë¥•: ${$.message}`)),m()}finally{v.confirmButtonLoading=!1}}else m()}})}catch(h){h!=="cancel"&&h!=="close"&&console.error("MessageBox error:",h)}},ma=async()=>{ae.value&&Ht();const e=g.value.webdav?.localChatPath;if(!e){i.error("ËØ∑ÂÖàÂú®ËÆæÁΩÆ‰∏≠ÈÖçÁΩÆÊú¨Âú∞ÂØπËØùË∑ØÂæÑ");return}if(!G.value){i.warning("ÂΩìÂâçÂØπËØùÂ∞öÊú™‰øùÂ≠òÔºåÊó†Ê≥ïÈáçÂëΩÂêç");return}const t=G.value,o=`${t}.json`,n=`${e}/${o}`;try{const{value:r}=await tt.prompt("ËØ∑ËæìÂÖ•Êñ∞ÁöÑ‰ºöËØùÂêçÁß∞","ÈáçÂëΩÂêçÂØπËØù",{inputValue:t,confirmButtonText:"Á°ÆËÆ§",cancelButtonText:"ÂèñÊ∂à",inputValidator:k=>!k||!k.trim()?"ÂêçÁß∞‰∏çËÉΩ‰∏∫Á©∫":/[\\/:*?"<>|]/.test(k)?"Êñá‰ª∂ÂêçÂåÖÂê´ÈùûÊ≥ïÂ≠óÁ¨¶":!0,customClass:"filename-prompt-dialog"});let p=(r||"").trim();if(p.toLowerCase().endsWith(".json")&&(p=p.slice(0,-5)),p===t)return;const h=`${p}.json`,v=`${e}/${h}`;if((await window.api.listJsonFiles(e)).some(k=>k.basename===h)){i.error(`Êñá‰ª∂Âêç "${h}" Â∑≤Â≠òÂú®ÔºåÊìç‰ΩúÂèñÊ∂à`);return}await window.api.renameLocalFile(n,v),G.value=p,i.success("Êú¨Âú∞ÈáçÂëΩÂêçÊàêÂäü");const{url:C,username:d,password:$,data_path:T}=g.value.webdav||{};if(C&&T)try{const k=Lo(C,{username:d,password:$}),A=T.endsWith("/")?T.slice(0,-1):T,x=`${A}/${o}`,V=`${A}/${h}`;await k.exists(x)&&(await tt.confirm("‰∫ëÁ´Ø‰πüÂ≠òÂú®ÂêåÂêçÊñá‰ª∂ÔºåÊòØÂê¶ÂêåÊ≠•ÈáçÂëΩÂêçÔºü","ÂêåÊ≠•Êìç‰ΩúÊèêÁ§∫",{confirmButtonText:"ÊòØ",cancelButtonText:"Âê¶",type:"info"}),await k.moveFile(x,V),i.success("‰∫ëÁ´ØÂêåÊ≠•ÈáçÂëΩÂêçÊàêÂäü"))}catch(k){k!=="cancel"&&k!=="close"&&console.warn("Cloud rename skipped:",k)}}catch(r){r!=="cancel"&&r!=="close"&&i.error(`Êìç‰ΩúÂ§±Ë¥•: ${r.message}`)}},mo=async()=>{ae.value&&Ht();const e=g.value.webdav?.url&&g.value.webdav?.data_path,t=[];g.value.webdav?.localChatPath&&G.value&&t.push({title:"ÈáçÂëΩÂêçÂØπËØù",description:"‰øÆÊîπÂΩìÂâçÂØπËØùÂêçÁß∞ÔºåÂπ∂ÂêåÊ≠•‰øÆÊîπÊú¨Âú∞Êñá‰ª∂Ôºà‰ª•Âèä‰∫ëÁ´ØÊñá‰ª∂Ôºâ„ÄÇ",buttonType:"warning",action:ma}),e&&t.push({title:"‰øùÂ≠òÂà∞‰∫ëÁ´Ø",description:"ÂêåÊ≠•Âà∞ WebDAV ÊúçÂä°Âô®ÔºåÊîØÊåÅË∑®ËÆæÂ§áËÆøÈóÆ„ÄÇ",buttonType:"success",action:da}),t.push({title:"‰øùÂ≠ò‰∏∫ JSON",description:"‰øùÂ≠ò‰∏∫ÂèØÊÅ¢Â§çÁöÑ‰ºöË©±Êñá‰ª∂Ôºå‰æø‰∫é‰∏ãÊ¨°ÁªßÁª≠„ÄÇ",buttonType:"primary",action:va,isDefault:!0}),t.push({title:"‰øùÂ≠ò‰∏∫ Markdown",description:"ÂØºÂá∫‰∏∫ÂèØËØªÊÄßÊõ¥Âº∫ÁöÑ .md Êñá‰ª∂ÔºåÈÄÇÂêàÂàÜ‰∫´„ÄÇ",buttonType:"",action:pa}),t.push({title:"‰øùÂ≠ò‰∏∫ HTML",description:"ÂØºÂá∫‰∏∫Â∏¶Ê†∑ÂºèÁöÑÁΩëÈ°µÊñá‰ª∂Ôºå‰øùÁïôÊ†ºÂºèÂíåÂõæÁâá„ÄÇ",buttonType:"",action:fa});const o=se("div",{class:"save-options-list"},t.map(n=>{const r=()=>{tt.close(),n.action()};return se("div",{class:"save-option-item",onClick:r},[se("div",{class:"save-option-text"},[se("h4",null,n.title),se("p",null,n.description)]),se(U,{type:n.buttonType,plain:!0,class:n.isDefault?"default-save-target":"",onClick:p=>{p.stopPropagation(),r()}},{default:()=>"ÈÄâÊã©"})])}));tt({title:"",message:o,showConfirmButton:!1,showCancelButton:!1,customClass:"save-options-dialog no-header-msgbox",width:"450px",showClose:!1}).catch(()=>{}),setTimeout(()=>{const n=document.querySelector(".default-save-target");n&&n.focus()},100)},go=async e=>{ge.value=!0,Ae.value.clear(),P.clear(),F.value=null;try{D.value=e.CODE,document.title=D.value,We.value=e.basic_msg,Ue.value=e.isInit,ae.value=e.autoCloseOnBlur,H.value=e.history,L.value=e.chat_show,be.value=e.selectedVoice||"",qe.value=e.currentPromptConfig?.reasoning_effort||"default",he.value=e.isAutoApproveTools||!0;const t=await window.api.getConfig();g.value=t.config,ie.value=g.value.zoom||1,window.api&&typeof window.api.setZoomFactor=="function"&&window.api.setZoomFactor(ie.value),g.value.isDarkMode?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark");const o=e.currentPromptConfig||g.value.prompts[D.value];o&&o.icon?(Le.value=o.icon,me.value=o.icon):(Le.value="ai.svg",me.value=g.value.isDarkMode?"favicon-b.png":"favicon.png"),Pe.value=[],ke.value={},g.value.providerOrder.forEach(v=>{const m=g.value.providers[v];m?.enable&&m.modelList.forEach(C=>{const d=`${v}|${C}`;Pe.value.push({key:d,value:d,label:`${m.name}|${C}`}),ke.value[d]=`${m.name}|${C}`})});let n="";if(e.model&&ke.value[e.model])n=e.model;else if(e.currentPromptConfig?.model&&ke.value[e.currentPromptConfig.model])n=e.currentPromptConfig.model;else{const v=g.value.prompts[D.value];n=v?.model&&ke.value[v.model]?v.model:Pe.value[0]?.value||""}if(Y.value=n,L.value&&L.value.length>0){L.value.forEach(m=>{m.id===void 0&&(m.id=Se.value++)});const v=Math.max(...L.value.map(m=>m.id||0));Se.value=v+1}const r=H.value.findIndex(v=>v.role==="system");if(r!==-1?(ce.value=H.value[r].content,(!L.value[r]||L.value[r].role!=="system")&&L.value.unshift({role:"system",content:ce.value,id:Se.value++})):g.value.prompts[D.value]?.prompt?(ce.value=g.value.prompts[D.value].prompt,H.value.unshift({role:"system",content:ce.value}),L.value.unshift({role:"system",content:ce.value,id:Se.value++})):ce.value="",Y.value){_e.value=Y.value.split("|")[0];const v=g.value.providers[_e.value];Ye.value=v?.url,Xe.value=v?.api_key}else{i.error("Ê≤°ÊúâÂèØÁî®ÁöÑÊ®°Âûã„ÄÇËØ∑Ê£ÄÊü•ÊÇ®ÁöÑÊúçÂä°ÂïÜÈÖçÁΩÆ„ÄÇ"),ge.value=!1;return}ge.value=!1,await fe(),xt();let p=[];e.activeMcpServerIds&&Array.isArray(e.activeMcpServerIds)?p=e.activeMcpServerIds:p=e.currentPromptConfig?.defaultMcpServers||[];const h=p.filter(v=>g.value.mcpServers&&g.value.mcpServers[v]);h.length>0?(xe.value=[...h],Z.value=[...h],kt(!1)):(xe.value=[],Z.value=[],kt(!1))}catch(t){console.error("Âä†ËΩΩ‰ºöËØùÂ§±Ë¥•:",t),i.error(`Âä†ËΩΩ‰ºöËØùÂ§±Ë¥•: ${t.message}`),ge.value=!1}},ho=async e=>{if(e&&e.name.toLowerCase().endsWith(".json"))try{const t=await e.text(),o=JSON.parse(t);if(o&&o.anywhere_history===!0)return G.value=e.name.replace(/\.json$/i,""),await go(o),!0}catch(t){console.warn("‰∏Ä‰∏™JSONÊñá‰ª∂Ë¢´Ê£ÄÊµãÂà∞Ôºå‰ΩÜÂÆÉ‰∏çÊòØ‰∏Ä‰∏™ÊúâÊïàÁöÑ‰ºöËØùÊñá‰ª∂:",t.message)}return!1},Wt=async(e,t)=>{if(await ho(e)){I.value?.focus({cursor:"end"});return}return new Promise((n,r)=>{if(!window.api.isFileTypeSupported(e.name)){const h=`‰∏çÊîØÊåÅÁöÑÊñá‰ª∂Á±ªÂûã: ${e.name}`;i.warning(h),r(new Error(h));return}const p=new FileReader;p.onload=h=>{Ee.value.push({uid:t,name:e.name,size:e.size,type:e.type,url:h.target.result}),n()},p.onerror=()=>{const h=`ËØªÂèñÊñá‰ª∂ ${e.name} Â§±Ë¥•`;i.error(h),r(new Error(h))},p.readAsDataURL(e)})},ga=async e=>{if(!e||typeof e!="string"){i.error("Êó†ÊïàÁöÑÊñá‰ª∂Ë∑ØÂæÑ");return}try{const t=await window.api.handleFilePath(e);t?await Wt(t,Ee.value.length+1):i.error("Êó†Ê≥ïËØªÂèñÊàñËÆøÈóÆËØ•Êñá‰ª∂ÔºåËØ∑Ê£ÄÊü•Ë∑ØÂæÑÂíåÊùÉÈôê")}catch(t){console.error("Ë∞ÉÁî® handleFilePath Êó∂ÂèëÁîüÊÑèÂ§ñÈîôËØØ:",t),i.error("Â§ÑÁêÜÊñá‰ª∂Ë∑ØÂæÑÊó∂ÂèëÁîüÊú™Áü•ÈîôËØØ")}},ha=async()=>{let e=[];if(Ee.value.length===0)return e;for(const t of Ee.value)try{const o=await window.api.parseFileObject({name:t.name,url:t.url});o&&e.push(o)}catch(o){o.message.includes("‰∏çÊîØÊåÅÁöÑÊñá‰ª∂Á±ªÂûã")?i.warning(o.message):i.error(`Â§ÑÁêÜÊñá‰ª∂ ${t.name} Â§±Ë¥•: ${o.message}`)}return Ee.value=[],e};async function kt(e=!0){pt.value=!1,Bt.value=!0,await fe();const t={},o=[...xe.value];for(const n of o)if(g.value.mcpServers[n]){const r=g.value.mcpServers[n];t[n]={transport:r.type,command:r.command,args:r.args,url:r.baseUrl,env:r.env,headers:r.headers,isPersistent:r.isPersistent}}try{const{openaiFormattedTools:n,successfulServerIds:r,failedServerIds:p}=await window.api.initializeMcpClient(t);if(ft.value=n,xe.value=r,p&&p.length>0){const h=p.map(v=>g.value.mcpServers[v]?.name||v).join("„ÄÅ");i.error({message:`‰ª•‰∏ã MCP ÊúçÂä°Âä†ËΩΩÂ§±Ë¥•ÔºåÂ∑≤Ëá™Âä®ÂèñÊ∂àÂãæÈÄâ: ${h}`,duration:5e3})}n.length>0?i.success(`Â∑≤ÊàêÂäüÂêØÁî® ${n.length} ‰∏™ MCP Â∑•ÂÖ∑`):o.length>0&&p.length===o.length?i.info("ÊâÄÊúâÈÄâ‰∏≠ÁöÑ MCP Â∑•ÂÖ∑ÂùáÂä†ËΩΩÂ§±Ë¥•"):o.length===0&&e&&i.info("Â∑≤Ê∏ÖÈô§ÊâÄÊúâ MCP Â∑•ÂÖ∑")}catch(n){console.error("Failed to initialize MCP tools:",n),i.error(`Âä†ËΩΩMCPÂ∑•ÂÖ∑Â§±Ë¥•: ${n.message}`),ft.value=[],xe.value=[]}finally{Bt.value=!1}}function wa(){Z.value=[]}function ya(){const e=no.value.map(o=>o.id),t=new Set(Z.value);e.forEach(o=>t.add(o)),Z.value=Array.from(t)}async function ba(){if(!pt.value){try{const e=await window.api.getConfig();if(e&&e.config&&e.config.mcpServers){const t=e.config.mcpServers,o=g.value.mcpServers||{};xe.value.forEach(n=>{!t[n]&&o[n]&&(t[n]=o[n])}),g.value.mcpServers=t}st.value=await window.api.getMcpToolCache()||{}}catch(e){console.error("Auto refresh MCP config failed:",e)}Z.value=[...xe.value]}pt.value=!pt.value}async function xa(e,t){if(!g.value.mcpServers[e])return;const o=`mcpServers.${e}.isPersistent`;try{const n=await window.api.saveSetting(o,t);if(n&&n.success)g.value.mcpServers[e].isPersistent=t,i.success(`'${g.value.mcpServers[e].name}' ÁöÑÊåÅ‰πÖÂåñËÆæÁΩÆÂ∑≤Êõ¥Êñ∞`);else throw new Error(n?.message||"‰øùÂ≠òËÆæÁΩÆÂà∞Êï∞ÊçÆÂ∫ìÂ§±Ë¥•")}catch(n){console.error("Failed to save MCP persistence setting:",n),i.error("‰øùÂ≠òÊåÅ‰πÖÂåñËÆæÁΩÆÂ§±Ë¥•")}}const Ca=()=>{const e=new Date,t=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],o=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");String(e.getHours()).padStart(2,"0"),String(e.getMinutes()).padStart(2,"0");const p=t[e.getDay()];return`${o}-${n}-${r} (${p})`},ka=()=>`
## SYSTEM CONTEXT
Current Time: **${Ca()}**
PlatformÔºö**${bt.value}**

Always use this timestamp as your reference for "today", "now", "current", or relative dates (e.g., "yesterday", "next week").

## Tool Use Rules
Here are the rules you should always follow to solve your task:
1. Always use the right arguments for the tools. Never use variable names as the action arguments, use the value instead.
2. Call a tool only when needed. If no tool call is needed, just answer the question directly.
3. Never re-do a tool call that you previously did with the exact same parameters.
4. **Synthesis**: Must always synthesize the tool output into valuable, easily understandable information from the user's perspective.
5.  **Strict Multimedia Formatting Norms**: In all circumstances, the display format for multimedia content (images, videos, audio) must comply with the following specifications, and **must not** be contained within code blocks (\`\`\`):
    *   **Image (Markdown)**: \`![Content Description](Image Link)\`
    *   **Video (HTML)**:
        \`\`\`html
        <video controls="" style="max-width: 80%; max-height: 400px; height: auto; width: auto; display: block;"><source src="Video Link URL" type="video/mp4">Your browser does not support video playback.</video>
        \`\`\`
    *   **Audio (HTML)**:
        \`\`\`html
        <audio class="chat-audio-player" controls="" preload="none">
          <source id="Audio Format" src="Audio Link URL">
        </audio>
        \`\`\`
6. **Language**: All Respond must be in the user's language
7. **Security & Safety**: Tools must be executed securely, and the invocation of any commands that could lead to system damage, data loss, or sensitive privacy disclosure is strictly prohibited.
    1.  **Comprehensive Risk Assessment**: Identify whether the operation involves sensitive data or irreversible data modification.
    2.  **Mandatory Warning Prompts**: For any risky operation, clear and detailed warnings must be issued to the user before execution, explaining potential consequences (e.g., exposure of sensitive information, data loss).
    3.  **Seek Explicit Confirmation**: Before executing irreversible or high-risk operations (e.g., deleting files, reading sensitive files), explicit secondary confirmation from the user must be required.
`,St=async(e=!1)=>{if(ge.value)return;if(Bt.value){i.info("Ê≠£Âú®Âä†ËΩΩÂ∑•ÂÖ∑ÔºåËØ∑Á®çÂêéÂÜçËØï...");return}if(!e){let h=await ha();const v=lt.value.trim();if(h&&h.length>0||v){const m=[];v&&m.push({type:"text",text:v}),h&&h.length>0&&m.push(...h);const C=new Date().toLocaleString("sv-SE");if(m.length>0){const d=m.length===1&&m[0].type==="text"?m[0].text:m;H.value.push({role:"user",content:d}),L.value.push({id:Se.value++,role:"user",content:m,timestamp:C}),It()}else return}else return;lt.value=""}ge.value=!0,Te.value=new AbortController,await fe(),re.value=!0,xt("auto");const t=g.value.prompts[D.value],o=!!be.value;let n=t?.stream&&!o,r=0,p=-1;try{const{OpenAI:h}=await Mt(async()=>{const{OpenAI:m}=await import("./index-CRSldtV4.js");return{OpenAI:m}},[],import.meta.url),v=new h({apiKey:()=>window.api.getRandomItem(Xe.value),baseURL:Ye.value,dangerouslyAllowBrowser:!0,maxRetries:3});for(;!Te.value.signal.aborted;){I.value?.focus({cursor:"end"});let m=JSON.parse(JSON.stringify(H.value));if(m=m.filter(A=>!(A.role==="system"&&(!A.content||A.content.trim()===""))),m.forEach(A=>{Array.isArray(A.content)&&(A.content=A.content.filter(x=>!x.isTranscript),A.content.length===0&&(A.content=null)),["content","reasoning_content","extra_content"].forEach(x=>{A[x]===null&&delete A[x]})}),t&&t.ifTextNecessary){const A=new Date,x=`current time: ${A.getFullYear()}-${String(A.getMonth()+1).padStart(2,"0")}-${String(A.getDate()).padStart(2,"0")} ${String(A.getHours()).padStart(2,"0")}:${String(A.getMinutes()).padStart(2,"0")}`;m.forEach(V=>{V.role==="user"&&(V.content===void 0||V.content===null?V.content=x:typeof V.content=="string"?V.content.trim()===""&&(V.content=x):Array.isArray(V.content)&&(V.content.length===0?V.content=x:V.content.some(pe=>pe.type==="text"&&pe.text&&pe.text.trim()!=="")||V.content.push({type:"text",text:x})))})}let C="";if(ft.value.length>0){C=ka();const A=m.findIndex(x=>x.role==="system");A!==-1?m[A].content.includes("## Tool Use Rules")||(m[A].content+=C):m.unshift({role:"system",content:C})}const d={model:Y.value.split("|")[1],messages:m,stream:n};t?.isTemperature&&(d.temperature=t.temperature),qe.value&&qe.value!=="default"&&(d.reasoning_effort=qe.value),ft.value.length>0&&(d.tools=ft.value,d.tool_choice="auto"),o&&(d.stream=!1,n=!1,d.modalities=["text","audio"],d.audio={voice:be.value.split("-")[0].trim(),format:"wav"});const $=Se.value++;L.value.push({id:$,role:"assistant",content:[],reasoning_content:"",status:"",aiName:ke.value[Y.value]||Y.value.split("|")[1],voiceName:be.value,tool_calls:[]}),p=L.value.length-1,J.value&&xt("auto");let T;if(n){const A=await v.chat.completions.create(d,{signal:Te.value.signal});let x="",V="",oe=[],pe=null,Q=Date.now();for await(const $e of A){const ne=$e.choices?.[0]?.delta;if(ne&&(ne.extra_content&&(pe={...pe,...ne.extra_content}),ne.thought_signature&&(pe=pe||{},pe.google=pe.google||{},pe.google.thought_signature=ne.thought_signature),ne.reasoning_content&&(x+=ne.reasoning_content,L.value[p].status!=="thinking"&&(L.value[p].status="thinking"),Date.now()-Q>100&&(L.value[p].reasoning_content=x,Q=Date.now())),ne.content&&(V+=ne.content,L.value[p].status=="thinking"&&(L.value[p].status="end"),Date.now()-Q>100&&(L.value[p].content=[{type:"text",text:V}],Q=Date.now())),ne.tool_calls))for(const le of ne.tool_calls){const Je=le.index??oe.length;oe[Je]||(oe[Je]={id:"",type:"function",function:{name:"",arguments:""}});const Ve=oe[Je];le.id&&(Ve.id=le.id),le.function?.name&&(Ve.function.name=le.function.name),le.function?.arguments&&(Ve.function.arguments+=le.function.arguments),le.extra_content&&(Ve.extra_content={...Ve.extra_content,...le.extra_content})}}T={role:"assistant",content:V||null,reasoning_content:x||null,extra_content:pe},oe.length>0&&(T.tool_calls=oe.filter($e=>$e.id&&$e.function.name))}else T=(await v.chat.completions.create(d,{signal:Te.value.signal})).choices[0].message;T.tool_calls&&T.tool_calls.length>0&&T.tool_calls.forEach(A=>{A.function&&A.function.arguments&&(A.function.arguments=hl(A.function.arguments))}),H.value.push(T);const k=L.value[p];if(T.content&&(k.content=[{type:"text",text:T.content}]),T.reasoning_content&&(k.reasoning_content=T.reasoning_content,k.status="end"),T.tool_calls&&T.tool_calls.length>0){r++,k.tool_calls=T.tool_calls.map(x=>({id:x.id,name:x.function.name,args:x.function.arguments,result:"Á≠âÂæÖÊâπÂáÜ...",approvalStatus:he.value?"approved":"waiting"})),await fe();const A=await Promise.all(T.tool_calls.map(async x=>{const V=k.tool_calls.find(Q=>Q.id===x.id);let oe;if(!he.value)try{if(!await new Promise($e=>{He.value.set(x.id,$e)}))return V&&(V.approvalStatus="rejected",V.result="Áî®Êà∑Â∑≤ÂèñÊ∂àÊâßË°å"),{tool_call_id:x.id,role:"tool",name:x.function.name,content:"User denied this tool execution."}}catch{}V&&(V.approvalStatus="executing",V.result="ÊâßË°å‰∏≠...");const pe=new AbortController;de.value.set(x.id,pe);try{const Q=JSON.parse(x.function.arguments);let $e=null;if(x.function.name==="sub_agent"){const le=Xe.value,Je=Ye.value,Ve=Y.value.split("|")[1]||Y.value,it=ft.value.filter(mt=>mt.function.name!=="sub_agent");$e={apiKey:le,baseUrl:Je,model:Ve,tools:it,mcpSystemPrompt:C,onUpdate:mt=>{V&&(V.result=mt+`

[Sub-Agent ÊâßË°å‰∏≠...]`)}}}const ne=await window.api.invokeMcpTool(x.function.name,Q,de.value.get(x.id)?.signal||Te.value.signal,$e);if(oe=Array.isArray(ne)?ne.filter(le=>le?.type==="text"&&typeof le.text=="string").map(le=>le.text).join(`

`):String(ne),V){if(x.function.name==="sub_agent"){const le=V.result?V.result.replace(`

[Sub-Agent ÊâßË°å‰∏≠...]`,""):"";le.includes(oe)?V.result=le:V.result=`${le}

=== ÊúÄÁªàÁªìÊûú ===
${oe}`}else V.result=oe;V.approvalStatus="finished"}}catch(Q){Q.name==="AbortError"?(oe="Error: Tool call was canceled by the user.",V&&(V.approvalStatus="rejected")):(oe=`{'result':'Â∑•ÂÖ∑ÊâßË°åÊàñÂèÇÊï∞Ëß£ÊûêÈîôËØØ: ${Q.message}'}`,V&&(V.approvalStatus="finished")),V&&(V.result=oe)}finally{de.value.delete(x.id)}return{tool_call_id:x.id,role:"tool",name:x.function.name,content:oe}}));H.value.push(...A)}else{if(o&&T.audio){if(k.content=k.content||[],T.audio.transcript){const A=T.audio.transcript;k.content.push({type:"text",text:`

${A}`,isTranscript:!0})}k.content.push({type:"input_audio",input_audio:{data:T.audio.data,format:"wav"}})}break}}}catch(h){let v=`ÂèëÁîüÈîôËØØ: ${h.message||"Êú™Áü•ÈîôËØØ"}`;h.name==="AbortError"&&(v="ËØ∑Ê±ÇÂ∑≤ÂèñÊ∂à");const m=p>-1?p:L.value.length;p===-1&&L.value.push({id:Se.value++,role:"assistant",content:[],aiName:ke.value[Y.value]||Y.value.split("|")[1],voiceName:be.value});const C=L.value[m];L.value[m].reasoning_content&&C.status==="thinking"&&(L.value[m].status="error");let d="";if(C.content&&Array.isArray(C.content)?d=C.content.filter($=>$.type==="text").map($=>$.text).join(""):typeof C.content=="string"&&(d=C.content),d&&d.trim().length>0){const $=`${d}

> **Error**: ${v}`;C.content=[{type:"text",text:$}],H.value.push({role:"assistant",content:$,reasoning_content:C.reasoning_content||null})}else C.content=[{type:"text",text:`${v}`}],H.value.push({role:"assistant",content:`${v}`,reasoning_content:C.reasoning_content||null})}finally{ge.value=!1,Te.value=null,p>-1&&(L.value[p].completedTimestamp=new Date().toLocaleString("sv-SE")),await fe(),I.value?.focus({cursor:"end"}),It()}},Sa=()=>{ge.value&&Te.value&&(Te.value.abort(),I.value?.focus())},$a=async(e,t)=>{ge.value&&t===L.value.length-1||await window.api.copyText(e)},wo=async()=>{if(ge.value)return;const e=H.value.findLastIndex(o=>o.role!=="tool");if(e===-1){i.warning("Ê≤°ÊúâÂèØ‰ª•ÈáçÊñ∞ÊèêÈóÆÁöÑÁî®Êà∑Ê∂àÊÅØ");return}const t=H.value[e];if(t.role==="assistant"){const o=H.value.length-e,n=H.value.slice(e).filter(r=>r.role!=="tool").length;H.value.splice(e,o),n>0&&L.value.splice(L.value.length-n)}else if(t.role!=="user"){i.warning("Êó†Ê≥ï‰ªéÊ≠§Ê∂àÊÅØÁ±ªÂûãÈáçÊñ∞ÊèêÈóÆ„ÄÇ");return}Ae.value.clear(),await fe(),await St(!0)},Ma=e=>{if(ge.value){i.warning("ËØ∑Á≠âÂæÖÂΩìÂâçÂõûÂ§çÂÆåÊàêÂêéÂÜçÊìç‰Ωú");return}if(e<0||e>=L.value.length)return;if(L.value[e]?.role==="system"){i.info("Á≥ªÁªüÊèêÁ§∫ËØç‰∏çËÉΩË¢´Âà†Èô§");return}let o=-1,n=-1;for(let T=0;T<H.value.length;T++)if(H.value[T].role!=="tool"&&n++,n===e){o=T;break}if(o===-1){console.error("ÂÖ≥ÈîÆÈîôËØØ: Êó†Ê≥ïÂ∞Ü chat_show Á¥¢ÂºïÊò†Â∞ÑÂà∞ history Á¥¢Âºï„ÄÇ‰∏≠Ê≠¢Âà†Èô§„ÄÇ"),i.error("Âà†Èô§Â§±Ë¥•ÔºöÊ∂àÊÅØÁä∂ÊÄÅ‰∏ç‰∏ÄËá¥„ÄÇ");return}const r=H.value[o];let p=o,h=o;if(r.role==="assistant"&&r.tool_calls&&r.tool_calls.length>0)for(;H.value[h+1]?.role==="tool";)h++;const v=h-p+1,m=1,C=e;v>0&&H.value.splice(p,v),L.value.splice(C,m);const d=e,$=new Set;for(const T of Ae.value)T<d?$.add(T):T>d&&$.add(T-1);Ae.value=$,F.value=null},_a=()=>{if(ge.value)return;const e=g.value.prompts[D.value]?.prompt,t=H.value.length>0?H.value[0]:null,o=t&&t.role==="system"?t:null,n=e?{role:"system",content:e}:o;n?(H.value=[n],L.value=[{...n,id:Se.value++}]):(H.value=[],L.value=[]),Ae.value.clear(),P.clear(),F.value=null,G.value="",I.value?.focus({cursor:"end"}),i.success("ÂéÜÂè≤ËÆ∞ÂΩïÂ∑≤Ê∏ÖÈô§")};function yo(e){const t=Z.value.indexOf(e);t===-1?Z.value.push(e):Z.value.splice(t,1)}async function La(e){const t=xe.value.indexOf(e);t===-1?xe.value.push(e):xe.value.splice(t,1),Z.value=[...xe.value],await kt(!1)}const Ta=()=>{setTimeout(()=>{I.value?.focus({cursor:"end"})},100)},Ea=e=>{const t=de.value.get(e);t&&(t.abort(),i.info("Ê≠£Âú®ÂèñÊ∂àÂ∑•ÂÖ∑Ë∞ÉÁî®..."))};function bo(e){if(!e)return"";const t=/^streamable[\s_-]?http$/i,o=e.toLowerCase();return o==="builtin"?"ÂÜÖÁΩÆ":t.test(o)||o==="http"?"ÂèØÊµÅÂºè HTTP":e}const Aa=async e=>{if(!D.value||!g.value.prompts[D.value]){i.warning("Êó†Ê≥ï‰øùÂ≠òÊ®°ÂûãÔºåÂõ†‰∏∫ÂΩìÂâç‰∏çÊòØ‰∏Ä‰∏™Â∑≤ÂÆö‰πâÁöÑÂø´Êç∑Âä©Êâã„ÄÇ");return}try{const t=await window.api.saveSetting(`prompts.${D.value}.model`,e);if(Ze.value=!1,t&&t.success)g.value.prompts[D.value].model=e,i.success(`Ê®°ÂûãÂ∑≤‰∏∫Âø´Êç∑Âä©Êâã "${D.value}" ‰øùÂ≠òÊàêÂäüÔºÅ`);else throw new Error(t?.message||"‰øùÂ≠òÂ§±Ë¥•")}catch(t){console.error("‰øùÂ≠òÊ®°ÂûãÂ§±Ë¥•:",t),i.error(`‰øùÂ≠òÊ®°ÂûãÂ§±Ë¥•: ${t.message}`)}Ze.value=!1},xo=e=>{const t=e.target;if(!(t instanceof HTMLImageElement)||!t.closest(".markdown-wrapper"))return;e.preventDefault();const o=t.src;if(t.parentNode&&t.parentNode.classList.contains("image-error-container"))return;const n=document.createElement("div");n.className="image-error-container",n.title="ÂõæÁâáÂä†ËΩΩÂ§±Ë¥•ÔºåÁÇπÂáªÈáçËØï";const r=document.createElementNS("http://www.w3.org/2000/svg","svg");r.setAttribute("viewBox","0 0 24 24"),r.innerHTML='<path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z" fill="currentColor"></path>';const p=document.createElement("span");p.textContent="Image",n.appendChild(r),n.appendChild(p),t.parentNode&&t.parentNode.replaceChild(n,t),n.onclick=h=>{h.stopPropagation();const v=document.createElement("img");v.src=`${o}?t=${new Date().getTime()}`,n.parentNode&&n.parentNode.replaceChild(v,n)}},Co=e=>{const t=e.ctrlKey||e.metaKey;if(t&&e.key.toLowerCase()==="s"){if(e.preventDefault(),ge.value){i.warning("ËØ∑Á≠âÂæÖ AI ÂõûÂ§çÂÆåÊàêÂêéÂÜç‰øùÂ≠ò");return}if(document.querySelector(".el-dialog, .el-message-box"))return;mo();return}if(t){if(e.key==="0"){e.preventDefault(),ie.value=1,i.info("Áº©ÊîæÂ∑≤ÈáçÁΩÆ (100%)");return}if(e.key==="="||e.key==="+"){e.preventDefault();const o=ie.value+.1;ie.value=Math.min(2,o),i.info(`Áº©Êîæ: ${Math.round(ie.value*100)}%`);return}if(e.key==="-"){e.preventDefault();const o=ie.value-.1;ie.value=Math.max(.5,o),i.info(`Áº©Êîæ: ${Math.round(ie.value*100)}%`);return}}},Ba=()=>{Fe&&Fe.show()};return(e,t)=>(E(),R(Re,null,[s("main",null,[Ge.value?(E(),R("div",wl)):te("",!0),s("div",{class:Me(["window-bg-layer",{"is-visible":!!Ge.value}]),style:Ao({backgroundImage:Ge.value?`url('${Ge.value}')`:"none",opacity:Ge.value?Tt.value:0,filter:`blur(${Ne.value}px)`})},null,6),l(a(Ja),{class:Me(["app-container",{"has-bg":!!Ge.value}])},{default:c(()=>[l(Tn,{favicon:me.value,promptName:D.value,conversationName:G.value,isAlwaysOnTop:yt.value,autoCloseOnBlur:ae.value,isDarkMode:g.value.isDarkMode,os:bt.value,onSaveWindowSize:No,onSaveSession:qo,onTogglePin:Ht,onToggleAlwaysOnTop:Wo,onMinimize:M,onMaximize:z,onClose:O},null,8,["favicon","promptName","conversationName","isAlwaysOnTop","autoCloseOnBlur","isDarkMode","os"]),l(Vn,{modelMap:ke.value,model:Y.value,"is-mcp-loading":Bt.value,systemPrompt:ce.value,onOpenModelDialog:Ho,onShowSystemPrompt:co,onOpenSearch:Ba},null,8,["modelMap","model","is-mcp-loading","systemPrompt"]),s("div",yl,[l(a(Ka),{ref_key:"chatContainerRef",ref:j,class:"chat-main custom-scrollbar",onClick:Nt,onScroll:Ro},{default:c(()=>[(E(!0),R(Re,null,nt(L.value,(o,n)=>(E(),Ce(a(B),{key:o.id,"is-auto-approve":he.value,onUpdateAutoApprove:Bo,onConfirmTool:dt,onRejectTool:dt,ref_for:!0,ref:r=>wt(r,o.id),message:o,index:n,"is-last-message":n===L.value.length-1,"is-loading":ge.value,"user-avatar":ye.value,"ai-avatar":Le.value,"is-collapsed":so(n),"is-dark-mode":g.value.isDarkMode,onDeleteMessage:jo,onCopyText:Ko,onReAsk:Zo,onToggleCollapse:Jo,onShowSystemPrompt:co,onAvatarClick:Yo,onEditMessageRequested:sa,onEditFinished:ia,onEditMessage:fo,onCancelToolCall:Ea},null,8,["is-auto-approve","message","index","is-last-message","is-loading","user-avatar","ai-avatar","is-collapsed","is-dark-mode"]))),128))]),_:1},512),q.value?(E(),R("div",bl,[l(a(ue),{content:"ÂõûÂà∞È°∂ÈÉ®",placement:"left","show-after":500},{default:c(()=>[l(a(U),{class:"scroll-nav-btn",onClick:Vo},{default:c(()=>[l(a(W),{size:14},{default:c(()=>t[20]||(t[20]=[s("svg",{viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},[s("path",{d:"M492.367 74.709h46.406L960 503.076l-46.406 46.406-403.379-403.378-399.809 403.378L64 503.076 492.367 74.709z m0 399.809h46.406L960 902.884l-46.406 46.406-403.379-399.808-399.809 399.809L64 902.884l428.367-428.366z"})],-1)])),_:1})]),_:1})]),_:1}),l(a(ue),{content:"‰∏ä‰∏ÄÊù°Ê∂àÊÅØ",placement:"left","show-after":500},{default:c(()=>[l(a(U),{class:"scroll-nav-btn",onClick:Oo},{default:c(()=>[l(a(W),{size:14},{default:c(()=>t[21]||(t[21]=[s("svg",{viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},[s("path",{d:"M902.5 749.2l57.5-57.5-421.6-416.9h-52.7L64 691.7l57.5 57.5 388.1-392.9 392.9 392.9z"})],-1)])),_:1})]),_:1})]),_:1}),l(a(ue),{content:Po.value,placement:"left","show-after":500},{default:c(()=>[l(a(U),{class:"scroll-nav-btn",onClick:Fo},{default:c(()=>[l(a(W),{size:14},{default:c(()=>t[22]||(t[22]=[s("svg",{viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},[s("path",{d:"M121.5 274.8L64 332.3l421.6 416.9h52.7l421.6-416.9-57.5-57.5-388.1 392.9-392.8-392.9z"})],-1)])),_:1})]),_:1})]),_:1},8,["content"]),l(a(ue),{content:"Ë∑≥Âà∞Â∫ïÈÉ®",placement:"left","show-after":500},{default:c(()=>[l(a(U),{class:"scroll-nav-btn",onClick:lo},{default:c(()=>[l(a(W),{size:14},{default:c(()=>t[23]||(t[23]=[s("svg",{viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},[s("path",{d:"M535.203 545.912h-46.406L64 121.116l46.406-46.406 403.378 399.809 399.81-399.81L960 121.116 535.203 545.912z m0 403.379h-46.406L64 524.494l46.406-49.976 403.378 403.379 399.809-403.379L960 524.494 535.203 949.291z"})],-1)])),_:1})]),_:1})]),_:1})])):te("",!0),l(pl,{ref_key:"chatInputRef",ref:I,prompt:lt.value,"onUpdate:prompt":t[0]||(t[0]=o=>lt.value=o),fileList:Ee.value,"onUpdate:fileList":t[1]||(t[1]=o=>Ee.value=o),selectedVoice:be.value,"onUpdate:selectedVoice":t[2]||(t[2]=o=>be.value=o),tempReasoningEffort:qe.value,"onUpdate:tempReasoningEffort":t[3]||(t[3]=o=>qe.value=o),loading:ge.value,ctrlEnterToSend:g.value.CtrlEnterToSend,layout:Rt.value,voiceList:g.value.voiceList,"is-mcp-active":zo.value,"all-mcp-servers":ao.value,"active-mcp-ids":xe.value,onSubmit:Xo,onCancel:Go,onClearHistory:Qo,onRemoveFile:ea,onUpload:ta,onSendAudio:aa,onOpenMcpDialog:oa,onPickFileStart:ca,onToggleMcp:La},null,8,["prompt","fileList","selectedVoice","tempReasoningEffort","loading","ctrlEnterToSend","layout","voiceList","is-mcp-active","all-mcp-servers","active-mcp-ids"])])]),_:1},8,["class"])]),l(ml,{modelValue:Ze.value,"onUpdate:modelValue":t[4]||(t[4]=o=>Ze.value=o),modelList:Pe.value,currentModel:Y.value,onSelect:Uo,onSaveModel:Aa},null,8,["modelValue","modelList","currentModel"]),l(a(Xt),{modelValue:Qe.value,"onUpdate:modelValue":t[7]||(t[7]=o=>Qe.value=o),title:"","custom-class":"system-prompt-dialog",width:"60%","show-close":!1,"lock-scroll":!1,"append-to-body":!0,center:"","close-on-click-modal":!0,"close-on-press-escape":!0},{header:c(({close:o,titleId:n,titleClass:r})=>t[24]||(t[24]=[s("div",{style:{display:"none"}},null,-1)])),footer:c(()=>[l(a(U),{onClick:t[6]||(t[6]=o=>Qe.value=!1)},{default:c(()=>t[25]||(t[25]=[X("ÂèñÊ∂à")])),_:1}),l(a(U),{type:"primary",onClick:vo},{default:c(()=>t[26]||(t[26]=[X("‰øùÂ≠ò")])),_:1})]),default:c(()=>[l(a(ot),{modelValue:f.value,"onUpdate:modelValue":t[5]||(t[5]=o=>f.value=o),type:"textarea",autosize:{minRows:4,maxRows:15},class:"system-prompt-full-content",resize:"none",onKeydown:ra},null,8,["modelValue"])]),_:1},8,["modelValue"]),u.value?(E(),Ce(a(Ya),{key:0,"url-list":b.value,"initial-index":K.value,onClose:t[8]||(t[8]=o=>u.value=!1),"hide-on-click-modal":!0,teleported:""},null,8,["url-list","initial-index"])):te("",!0),u.value?(E(),R("div",xl,[l(a(U),{type:"primary",icon:a(Xa),circle:"",onClick:t[9]||(t[9]=o=>na(b.value[0])),title:"Â§çÂà∂ÂõæÁâá"},null,8,["icon"]),l(a(U),{type:"primary",icon:a(Yt),circle:"",onClick:t[10]||(t[10]=o=>la(b.value[0])),title:"‰∏ãËΩΩÂõæÁâá"},null,8,["icon"])])):te("",!0),l(a(Xt),{modelValue:pt.value,"onUpdate:modelValue":t[19]||(t[19]=o=>pt.value=o),width:"80%","custom-class":"mcp-dialog no-header-dialog",onClose:Ta,"show-close":!1},{header:c(()=>t[27]||(t[27]=[s("div",{style:{display:"none"}},null,-1)])),footer:c(()=>[s("div",Fl,[s("div",Nl,[s("span",{class:Me(["mcp-limit-hint",{warning:oo.value>5}])},[X(" ËøûÊé•Êï∞Ôºö"+ee(5-oo.value)+"/5 ",1),l(a(ue),{placement:"top"},{content:c(()=>t[34]||(t[34]=[X(" ÊåÅ‰πÖËøûÊé•ÂêÑÂç†1‰∏™ÂêçÈ¢ù"),s("br",null,null,-1),X(" ÊâÄÊúâ‰∏¥Êó∂ËøûÊé•ÂÖ±Âç†1‰∏™ÂêçÈ¢ù ")])),default:c(()=>[l(a(W),{style:{"vertical-align":"middle","margin-left":"4px",cursor:"help"}},{default:c(()=>[l(a(on))]),_:1})]),_:1})],2),l(a(Mo),{modelValue:he.value,"onUpdate:modelValue":t[17]||(t[17]=o=>he.value=o),label:"Ëá™Âä®ÊâπÂáÜÂ∑•ÂÖ∑Ë∞ÉÁî®",style:{"margin-left":"40px","margin-right":"0"}},null,8,["modelValue"])]),s("div",null,[l(a(U),{type:"primary",onClick:t[18]||(t[18]=o=>{xe.value=[...Z.value],kt()})},{default:c(()=>t[35]||(t[35]=[X("Â∫îÁî®")])),_:1})])])]),default:c(()=>[s("div",Cl,[s("div",kl,[l(a($o),null,{default:c(()=>[l(a(U),{type:et.value==="all"?"primary":"",onClick:t[11]||(t[11]=o=>et.value="all")},{default:c(()=>t[28]||(t[28]=[X("ÂÖ®ÈÉ®")])),_:1},8,["type"]),l(a(U),{type:et.value==="selected"?"primary":"",onClick:t[12]||(t[12]=o=>et.value="selected")},{default:c(()=>t[29]||(t[29]=[X("Â∑≤ÈÄâ ")])),_:1},8,["type"]),l(a(U),{type:et.value==="unselected"?"primary":"",onClick:t[13]||(t[13]=o=>et.value="unselected")},{default:c(()=>t[30]||(t[30]=[X("Êú™ÈÄâ ")])),_:1},8,["type"])]),_:1}),l(a($o),null,{default:c(()=>[l(a(U),{onClick:ya},{default:c(()=>t[31]||(t[31]=[X("ÂÖ®ÈÄâ")])),_:1}),l(a(U),{onClick:wa},{default:c(()=>t[32]||(t[32]=[X("Ê∏ÖÁ©∫")])),_:1})]),_:1})]),s("div",Sl,[(E(!0),R(Re,null,nt(no.value,o=>(E(),R("div",{key:o.id,class:"mcp-server-item-wrapper"},[s("div",{class:Me(["mcp-server-item",{"is-checked":Z.value.includes(o.id)}]),onClick:n=>yo(o.id)},[s("div",Ml,[s("div",_l,[l(a(Mo),{"model-value":Z.value.includes(o.id),size:"large",onChange:()=>yo(o.id),onClick:t[14]||(t[14]=at(()=>{},["stop"])),class:"header-checkbox"},null,8,["model-value","onChange"]),l(a(Ga),{src:o.logoUrl,shape:"square",size:20,class:"mcp-server-icon"},{default:c(()=>[l(a(W),{size:12},{default:c(()=>[l(a(Qa))]),_:1})]),_:2},1032,["src"]),s("span",Ll,[X(ee(o.name)+" ",1),Ot(o.id)?(E(),R("span",Tl," ("+ee(Ot(o.id).enabled)+"/"+ee(Ot(o.id).total)+") ",1)):te("",!0)]),s("div",El,[l(a(ue),{content:o.isPersistent?"ÊåÅ‰πÖËøûÊé•Â∑≤ÂºÄÂêØ":"ÊåÅ‰πÖËøûÊé•Â∑≤ÂÖ≥Èó≠",placement:"top"},{default:c(()=>[l(a(U),{text:"",circle:"",class:Me([{"is-persistent-active":o.isPersistent},"persistent-btn"]),onClick:at(n=>xa(o.id,!o.isPersistent),["stop"])},{default:c(()=>[l(a(W),{size:16},{default:c(()=>t[33]||(t[33]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[s("polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2"})],-1)])),_:1})]),_:2},1032,["class","onClick"])]),_:2},1032,["content"]),s("div",Al,[o.type?(E(),Ce(a(_o),{key:0,type:"info",size:"small",effect:"plain",round:""},{default:c(()=>[X(ee(bo(o.type)),1)]),_:2},1024)):te("",!0),(E(!0),R(Re,null,nt((o.tags||[]).slice(0,2),n=>(E(),Ce(a(_o),{key:n,size:"small",effect:"plain",round:""},{default:c(()=>[X(ee(n),1)]),_:2},1024))),128))])])]),s("div",Bl,[s("div",{class:"mcp-tools-toggle",onClick:at(n=>to(o.id),["stop"])},[l(a(W),{class:Me({"is-expanded":vt.value.has(o.id)})},{default:c(()=>[l(a(en))]),_:2},1032,["class"]),s("span",null,ee(vt.value.has(o.id)?"Êî∂Ëµ∑":"Â∑•ÂÖ∑"),1)],8,Il),o.description?(E(),R("span",{key:0,class:"mcp-server-description",onClick:at(n=>to(o.id),["stop"])},ee(o.description),9,zl)):te("",!0)])])],10,$l),vt.value.has(o.id)?(E(),R("div",{key:0,class:"mcp-tools-panel",onClick:t[15]||(t[15]=at(()=>{},["stop"]))},[st.value[o.id]&&st.value[o.id].length>0?(E(!0),R(Re,{key:0},nt(st.value[o.id],n=>(E(),R("div",{key:n.name,class:"mcp-tool-row"},[l(a(tn),{"model-value":n.enabled!==!1,size:"small",onChange:r=>Io(o.id,n.name,r)},null,8,["model-value","onChange"]),s("div",Dl,[s("span",Pl,ee(n.name),1),s("span",{class:"mcp-tool-desc",title:n.description},ee(n.description||"ÊöÇÊó†ÊèèËø∞"),9,Vl)])]))),128)):(E(),R("div",Rl," Â∑•ÂÖ∑Êú™ÁºìÂ≠òÔºå‰ΩøÁî®/ÊµãËØïÂêéÂç≥ÂèØÊü•ÁúãÂÖ∑‰ΩìÂ∑•ÂÖ∑ "))])):te("",!0)]))),128))]),s("div",Ol,[l(a(ot),{modelValue:At.value,"onUpdate:modelValue":t[16]||(t[16]=o=>At.value=o),placeholder:"ÊêúÁ¥¢Â∑•ÂÖ∑ÂêçÁß∞ÊàñÊèèËø∞...","prefix-icon":a(eo),clearable:""},null,8,["modelValue","prefix-icon"])])])]),_:1},8,["modelValue"])],64))}},Ul=_t(Hl,[["__scopeId","data-v-ccdf2699"]]),Wl=an(Ul);Wl.mount("#app");export{_t as _,Zl as a,Dt as f,hl as s};
