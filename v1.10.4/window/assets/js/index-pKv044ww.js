const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./recorder-core-Dc2vK-2E.js","./element-plus-BXislPqv.js","./vendor-utils-Biw9DGem.js","./ChatMessage-CO3pEFSS.js","./mermaid-PPVm8Dsz.js","../css/ChatMessage-CqOrmxZ1.css"])))=>i.map(i=>d[i]);
import{c as ve,r as g,o as ro,a as co,b as D,d as _,e as s,f as ae,h as n,w as i,u as a,i as Ja,E as H,m as to,j as oo,k as Xe,t as Q,l as ce,n as io,p as Ce,q as Ya,s as Xa,v as ao,x as _e,y as Ut,z as Ga,A as Wt,B as No,C as Qa,D as qt,F as en,G as zo,H as Ot,I as xt,J as tn,K as bt,L as xe,M as Re,N as lt,O as on,P as R,Q as an,R as nn,S as no,T as q,U as lo,V as ln,W as nt,X as Ho,Y as sn,Z as he,_ as ut,$ as Do,a0 as rn,a1 as Ht,a2 as re,a3 as ct,a4 as cn,a5 as un,a6 as dn,a7 as pn,a8 as fn,a9 as Ft,aa as so,ab as Po,ac as vn,ad as Vo,ae as mn,af as gn,ag as hn,ah as wn,ai as yn,aj as bn}from"./element-plus-BXislPqv.js";import{_ as Et}from"./mermaid-PPVm8Dsz.js";import{a as Ro,p as Oo,d as Fo}from"./vendor-utils-Biw9DGem.js";(function(){const E=document.createElement("link").relList;if(E&&E.supports&&E.supports("modulepreload"))return;for(const B of document.querySelectorAll('link[rel="modulepreload"]'))M(B);new MutationObserver(B=>{for(const F of B)if(F.type==="childList")for(const I of F.addedNodes)I.tagName==="LINK"&&I.rel==="modulepreload"&&M(I)}).observe(document,{childList:!0,subtree:!0});function r(B){const F={};return B.integrity&&(F.integrity=B.integrity),B.referrerPolicy&&(F.referrerPolicy=B.referrerPolicy),B.crossOrigin==="use-credentials"?F.credentials="include":B.crossOrigin==="anonymous"?F.credentials="omit":F.credentials="same-origin",F}function M(B){if(B.ep)return;B.ep=!0;const F=r(B);fetch(B.href,F)}})();const At=($,E)=>{const r=$.__vccOpts||$;for(const[M,B]of E)r[M]=B;return r},xn={class:"left-container"},Cn={key:0,class:"window-controls mac-traffic-lights no-drag"},kn={class:"app-info-inner"},Sn=["src"],$n={class:"app-title"},_n={key:1,class:"divider-vertical"},Mn={class:"conversation-inner"},Ln={class:"conversation-title"},Tn={class:"right-container"},En={key:0,class:"function-group no-drag"},An={key:0,viewBox:"0 0 24 24",width:"16",height:"16"},In={key:1,viewBox:"0 0 24 24",width:"16",height:"16"},Bn={key:0,viewBox:"0 0 24 24",width:"16",height:"16",fill:"none",stroke:"currentColor","stroke-width":"2"},zn={key:1,viewBox:"0 0 24 24",width:"16",height:"16"},Dn={key:1,class:"function-group no-drag"},Pn={class:"func-btn",title:"Êõ¥Â§öÈÄâÈ°π"},Vn={class:"dropdown-text-col"},Rn={class:"dropdown-subtext"},On={class:"dropdown-check-row"},Fn={class:"dropdown-check-row"},Nn={key:2,class:"divider-vertical"},Hn={key:3,class:"window-controls win-controls no-drag"},Un={key:4,class:"window-controls linux-controls no-drag"},Wn={__name:"TitleBar",props:{favicon:String,promptName:String,conversationName:String,isAlwaysOnTop:Boolean,autoCloseOnBlur:Boolean,isDarkMode:Boolean,os:{type:String,default:"win"}},emits:["save-window-size","save-session","toggle-pin","toggle-always-on-top","minimize","maximize","close"],setup($,{emit:E}){const r=$,M=E,B=ve(()=>r.conversationName||"‰∏¥Êó∂ÂØπËØù"),F=ve(()=>r.os==="macos"||r.os==="darwin"),I=ve(()=>r.os==="win"),L=ve(()=>!F.value&&!I.value),U=g(window.innerWidth),Y=ve(()=>U.value<400),X=()=>{U.value=window.innerWidth};return ro(()=>{window.addEventListener("resize",X)}),co(()=>{window.removeEventListener("resize",X)}),(K,C)=>(_(),D("div",{class:Ce(["title-bar",[`os-${$.os}`,{"dark-mode":$.isDarkMode}]])},[s("div",xn,[F.value?(_(),D("div",Cn,[s("div",{class:"traffic-btn close",onClick:C[0]||(C[0]=P=>M("close"))},[n(a(H),{class:"traffic-icon"},{default:i(()=>[n(a(Ja))]),_:1})]),s("div",{class:"traffic-btn minimize",onClick:C[1]||(C[1]=P=>M("minimize"))},[n(a(H),{class:"traffic-icon icon-minus"},{default:i(()=>[n(a(to))]),_:1})]),s("div",{class:"traffic-btn maximize",onClick:C[2]||(C[2]=P=>M("maximize"))},[n(a(H),{class:"traffic-icon icon-fullscreen"},{default:i(()=>[n(a(oo))]),_:1})])])):ae("",!0),s("div",{class:"app-info no-drag",onClick:C[3]||(C[3]=P=>M("save-window-size")),onDblclick:C[4]||(C[4]=Xe(P=>M("maximize"),["stop"]))},[n(a(ce),{content:"ÁÇπÂáª‰øùÂ≠òÂΩìÂâçÁ™óÂè£Â§ßÂ∞è‰∏é‰ΩçÁΩÆ / ÂèåÂáªÂÖ®Â±è",placement:"bottom","show-after":500},{default:i(()=>[s("div",kn,[s("img",{src:$.favicon,class:"app-logo",alt:"Logo"},null,8,Sn),s("span",$n,Q($.promptName||"Anywhere"),1)])]),_:1})],32),Y.value?ae("",!0):(_(),D("div",_n)),Y.value?ae("",!0):(_(),D("div",{key:2,class:"conversation-info no-drag",onClick:C[5]||(C[5]=P=>M("save-session")),onDblclick:C[6]||(C[6]=Xe(P=>M("maximize"),["stop"]))},[n(a(ce),{content:"ÁÇπÂáª‰øùÂ≠ò‰ºöËØù",placement:"bottom","show-after":500},{default:i(()=>[s("div",Mn,[s("span",Ln,Q(B.value),1),n(a(H),{class:"download-icon"},{default:i(()=>[n(a(io))]),_:1})])]),_:1})],32))]),s("div",Tn,[Y.value?(_(),D("div",Dn,[n(a(Ga),{trigger:"click",placement:"bottom-end","popper-class":"title-bar-dropdown"},{dropdown:i(()=>[n(a(Xa),null,{default:i(()=>[n(a(ao),{onClick:C[9]||(C[9]=P=>M("save-session"))},{default:i(()=>[n(a(H),null,{default:i(()=>[n(a(io))]),_:1}),s("div",Vn,[C[22]||(C[22]=s("span",null,"‰øùÂ≠ò/ÈáçÂëΩÂêç",-1)),s("span",Rn,Q(B.value),1)])]),_:1}),n(a(ao),{onClick:C[10]||(C[10]=P=>M("toggle-pin"))},{default:i(()=>[s("div",On,[C[23]||(C[23]=s("div",{class:"dropdown-text-col"},[s("span",null,"Â§±ÁÑ¶Ëá™Âä®ÂÖ≥Èó≠")],-1)),$.autoCloseOnBlur?(_(),_e(a(H),{key:0,class:"check-icon"},{default:i(()=>[n(a(Ut))]),_:1})):ae("",!0)])]),_:1}),n(a(ao),{onClick:C[11]||(C[11]=P=>M("toggle-always-on-top"))},{default:i(()=>[s("div",Fn,[C[24]||(C[24]=s("div",{class:"dropdown-text-col"},[s("span",null,"Á™óÂè£ÁΩÆÈ°∂")],-1)),$.isAlwaysOnTop?(_(),_e(a(H),{key:0,class:"check-icon"},{default:i(()=>[n(a(Ut))]),_:1})):ae("",!0)])]),_:1})]),_:1})]),default:i(()=>[s("div",Pn,[n(a(H),null,{default:i(()=>[n(a(Ya))]),_:1})])]),_:1})])):(_(),D("div",En,[n(a(ce),{content:$.autoCloseOnBlur?"Â§±ÁÑ¶Ëá™Âä®ÂÖ≥Èó≠: ÂºÄ":"Â§±ÁÑ¶Ëá™Âä®ÂÖ≥Èó≠: ÂÖ≥",placement:"bottom","show-after":500},{default:i(()=>[s("div",{class:Ce(["func-btn",{active:!$.autoCloseOnBlur}]),onClick:C[7]||(C[7]=P=>M("toggle-pin"))},[$.autoCloseOnBlur?(_(),D("svg",In,C[19]||(C[19]=[s("path",{fill:"currentColor",d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"},null,-1)]))):(_(),D("svg",An,C[18]||(C[18]=[s("path",{fill:"currentColor",d:"M12 17c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm6-9h-1V7c0-2.76-2.24-5-5-5S7 4.24 7 7v1H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zM8.9 7c0-1.71 1.39-3.1 3.1-3.1s3.1 1.39 3.1 3.1v1H8.9V7z"},null,-1)])))],2)]),_:1},8,["content"]),n(a(ce),{content:$.isAlwaysOnTop?"ÂèñÊ∂àÁΩÆÈ°∂":"ÁΩÆÈ°∂Á™óÂè£",placement:"bottom","show-after":500},{default:i(()=>[s("div",{class:Ce(["func-btn",{active:$.isAlwaysOnTop}]),onClick:C[8]||(C[8]=P=>M("toggle-always-on-top"))},[$.isAlwaysOnTop?(_(),D("svg",Bn,C[20]||(C[20]=[s("path",{d:"M14.6358 3.90949C15.2888 3.47412 15.6153 3.25643 15.9711 3.29166C16.3269 3.32689 16.6044 3.60439 17.1594 4.15938L19.8406 6.84062C20.3956 7.39561 20.6731 7.67311 20.7083 8.02888C20.7436 8.38465 20.5259 8.71118 20.0905 9.36424L18.4419 11.8372C17.88 12.68 17.5991 13.1013 17.3749 13.5511C17.2086 13.8845 17.0659 14.2292 16.9476 14.5825C16.7882 15.0591 16.6889 15.5557 16.4902 16.5489L16.2992 17.5038C16.2986 17.5072 16.2982 17.5089 16.298 17.5101C16.1556 18.213 15.3414 18.5419 14.7508 18.1351C14.7497 18.1344 14.7483 18.1334 14.7455 18.1315V18.1315C14.7322 18.1223 14.7255 18.1177 14.7189 18.1131C11.2692 15.7225 8.27754 12.7308 5.88691 9.28108C5.88233 9.27448 5.87772 9.26782 5.86851 9.25451V9.25451C5.86655 9.25169 5.86558 9.25028 5.86486 9.24924C5.45815 8.65858 5.78704 7.84444 6.4899 7.70202C6.49113 7.70177 6.49282 7.70144 6.49618 7.70076L7.45114 7.50977C8.44433 7.31113 8.94092 7.21182 9.4175 7.05236C9.77083 6.93415 10.1155 6.79139 10.4489 6.62514C10.8987 6.40089 11.32 6.11998 12.1628 5.55815L14.6358 3.90949Z"},null,-1),s("path",{d:"M5 19L9.5 14.5","stroke-linecap":"round"},null,-1)]))):(_(),D("svg",zn,C[21]||(C[21]=[s("path",{fill:"currentColor",d:"M20,8 L20,5.5 C20,4.67157288 19.3284271,4 18.5,4 L5.5,4 C4.67157288,4 4,4.67157288 4,5.5 L4,8 L20,8 Z M20,9 L4,9 L4,18.5 C4,19.3284271 4.67157288,20 5.5,20 L18.5,20 C19.3284271,20 20,19.3284271 20,18.5 L20,9 Z M3,5.5 C3,4.11928813 4.11928813,3 5.5,3 L18.5,3 C19.8807119,3 21,4.11928813 21,5.5 L21,18.5 C21,19.8807119 19.8807119,21 18.5,21 L5.5,21 C4.11928813,21 3,19.8807119 3,18.5 L3,5.5 Z"},null,-1)])))],2)]),_:1},8,["content"])])),I.value?(_(),D("div",Nn)):ae("",!0),I.value?(_(),D("div",Hn,[s("div",{class:"win-btn minimize",onClick:C[12]||(C[12]=P=>M("minimize")),title:"ÊúÄÂ∞èÂåñ"},[n(a(H),null,{default:i(()=>[n(a(to))]),_:1})]),s("div",{class:"win-btn maximize",onClick:C[13]||(C[13]=P=>M("maximize")),title:"ÊúÄÂ§ßÂåñ"},[n(a(H),null,{default:i(()=>[n(a(oo))]),_:1})]),s("div",{class:"win-btn close",onClick:C[14]||(C[14]=P=>M("close")),title:"ÂÖ≥Èó≠"},[n(a(H),null,{default:i(()=>[n(a(Wt))]),_:1})])])):ae("",!0),L.value?(_(),D("div",Un,[s("div",{class:"linux-btn minimize",onClick:C[15]||(C[15]=P=>M("minimize"))},[n(a(H),null,{default:i(()=>[n(a(to))]),_:1})]),s("div",{class:"linux-btn maximize",onClick:C[16]||(C[16]=P=>M("maximize"))},[n(a(H),null,{default:i(()=>[n(a(oo))]),_:1})]),s("div",{class:"linux-btn close",onClick:C[17]||(C[17]=P=>M("close"))},[n(a(H),null,{default:i(()=>[n(a(Wt))]),_:1})])])):ae("",!0)])],2))}},qn=At(Wn,[["__scopeId","data-v-550c05bf"]]),jn={class:"model-header-wrapper"},Kn={class:"header-content-group"},Zn={class:"expandable-content"},Jn={class:"model-text"},Yn={key:0,class:"model-text prompt-text"},Xn={key:1,class:"model-text prompt-text placeholder"},Gn={__name:"ChatHeader",props:{modelMap:Object,model:String,isMcpLoading:Boolean,systemPrompt:String},emits:["open-model-dialog","show-system-prompt","open-search"],setup($,{emit:E}){const r=$,M=E,B=I=>{let L=0;for(let K=0;K<I.length;K++)L=I.charCodeAt(K)+((L<<5)-L);const U=Math.abs(L)%360,Y=60+Math.abs(L)%20,X=50+Math.abs(L)%10;return`hsl(${U}, ${Y}%, ${X}%)`},F=ve(()=>{const I=r.model&&r.model.split("|")[1]||"default";return B(I)});return(I,L)=>(_(),_e(a(en),{class:"model-header"},{default:i(()=>[s("div",jn,[s("div",Kn,[s("div",{class:Ce(["model-pill expandable-pill",{"is-disabled":$.isMcpLoading,"is-loading":$.isMcpLoading}]),onClick:L[0]||(L[0]=U=>!$.isMcpLoading&&M("open-model-dialog"))},[s("div",{class:"model-logo-container",style:No({color:$.isMcpLoading?"#F59E0B":F.value})},L[3]||(L[3]=[s("svg",{class:"model-logo",width:"18",height:"18",viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[s("g",{"clip-path":"url(#clip0_11482_204655)"},[s("path",{d:"M24.9439 24.7319C25.824 27.2847 25.4279 29.2944 23.7589 30.7231C22.2911 31.9822 19.8552 32.4878 18.3842 31.2946C16.8252 30.0291 15.9012 30.1076 14.3202 31.2914C12.7769 32.4438 10.8062 32.1141 9.19691 30.8926C7.59392 29.6743 7.04073 28.0069 7.33304 26.0413C7.39276 25.6425 7.7165 25.2908 7.5562 24.7633C6.48126 25.0396 5.45346 25.564 4.29051 25.3599C2.38579 25.0239 1.01225 24.0128 0.333338 22.1948C-0.370719 20.3076 0.0724596 18.6088 1.38942 17.1142C1.75717 16.6966 2.3795 16.4642 1.64087 15.6698C-0.226136 13.6602 -0.465012 11.5218 0.732513 9.54359C1.93004 7.56224 4.08621 6.84317 6.77043 7.53084C6.91815 7.62504 7.06588 7.71924 7.21046 7.8103C7.34562 7.55596 7.30161 7.34244 7.05645 7.17915C5.67662 3.03432 8.04024 -0.356908 12.0414 0.0324552C13.2515 0.148636 14.2196 0.732681 15.0462 1.57107C15.4266 1.95729 15.7126 2.19907 16.1683 1.65585C17.9442 -0.454249 20.9679 -0.259567 22.4577 0.713841C24.4316 2.00125 25.0162 3.81305 24.353 6.92167C24.3467 6.95307 24.4158 7.00017 24.5039 7.11007C25.3902 6.85259 26.286 6.41299 27.2824 6.49463C29.2782 6.65477 30.7649 7.58422 31.5664 9.43683C32.3899 11.3491 32.0159 13.0981 30.6958 14.6932C30.3815 15.0732 29.426 15.3401 30.3092 16.1157C32.4622 17.9965 32.2642 20.7849 31.2427 22.3769C29.9949 24.3206 28.1404 24.9674 25.3179 24.3928C25.1105 24.2107 24.8873 24.1541 24.639 24.3017C24.7427 24.4462 24.8465 24.5906 24.9502 24.7319H24.9439ZM2.46122 12.2315C2.45179 12.9694 2.87297 13.5974 3.44816 14.1657C4.96942 15.6666 6.46555 17.1896 7.98995 18.6873C8.91717 19.5948 9.87582 21.1554 10.8219 21.1585C11.7491 21.1585 12.6763 19.554 13.6067 18.6559C13.6821 18.5837 13.7513 18.5052 13.833 18.4393C14.295 18.0813 14.1504 17.783 13.7921 17.4282C11.3845 15.0481 9.01146 12.6334 6.58498 10.2721C5.80864 9.51533 4.8217 9.38031 3.83476 9.86702C2.91383 10.316 2.44236 11.0853 2.46122 12.2346V12.2315ZM12.1609 29.5267C12.9781 29.4671 13.5784 29.0997 14.1127 28.5596C15.6529 27.0053 17.2118 25.4667 18.7645 23.9249C20.6986 22.0011 20.6755 20.1213 18.6954 18.2854C18.62 18.2163 18.5477 18.1378 18.4817 18.0593C18.1925 17.7139 17.9316 17.7014 17.5984 18.0405C15.1468 20.5243 12.6606 22.9766 10.2341 25.4855C9.51436 26.2297 9.53322 27.2094 9.94811 28.1231C10.3787 29.0683 11.2022 29.4671 12.164 29.5299L12.1609 29.5267ZM21.0999 10.2156C20.1224 11.2926 19.2454 12.3257 18.2962 13.2865C17.8185 13.7701 17.8216 14.0715 18.3056 14.5457C20.6504 16.8442 22.9354 19.2023 25.2959 21.482C26.4589 22.6061 27.9204 22.5496 28.9168 21.4883C29.8377 20.5054 29.8283 19.0453 28.7879 17.9777C26.3174 15.4406 23.8092 12.9411 21.0999 10.2124V10.2156ZM22.3445 4.88066C22.3445 3.83189 21.8165 3.06258 20.927 2.62612C19.8866 2.11743 18.8934 2.35293 18.0668 3.1662C16.4355 4.77703 14.8105 6.39101 13.1949 8.01754C10.2907 10.9378 10.3127 10.9252 13.3741 13.6853C13.8927 14.1532 14.1284 14.1155 14.5905 13.6445C16.8504 11.3397 19.1511 9.07259 21.4393 6.79607C21.9737 6.26541 22.3382 5.65938 22.3445 4.88066ZM8.91717 4.83983C8.99575 5.81952 9.4075 6.66733 10.2058 7.07239C10.9979 7.47432 11.2399 6.46323 11.7083 6.08328C12.3494 5.56204 12.8932 4.92148 13.4904 4.34371C13.723 4.11763 13.9744 3.91667 13.6601 3.58382C12.8806 2.76114 12.0383 2.11429 10.7936 2.4754C9.58351 2.82708 9.05547 3.70001 8.91717 4.83983ZM27.1535 8.87791C26.0691 8.91873 25.2645 9.41799 24.859 10.1873C24.5039 10.8624 25.4374 11.1387 25.802 11.5752C26.33 12.2095 26.9523 12.7684 27.5558 13.3367C27.779 13.5471 27.9456 14.0181 28.4076 13.5754C29.2374 12.7778 29.8629 11.8986 29.4763 10.696C29.1054 9.54987 28.2693 8.92187 27.1535 8.88105V8.87791ZM4.46338 22.9766C5.9155 22.9986 6.72642 22.4962 7.13188 21.7332C7.53735 20.9701 6.51269 20.7127 6.13238 20.2354C5.62005 19.5885 4.97257 19.0516 4.40052 18.455C4.11136 18.1535 3.87248 18.0531 3.50788 18.3828C2.61209 19.1866 2.20034 20.1569 2.58066 21.3061C2.93898 22.3926 3.7719 22.9546 4.46338 22.9766ZM23.036 27.0649C23.0989 26.0036 22.5331 25.1778 21.7128 24.7633C21.1062 24.4556 20.7856 25.3725 20.3487 25.743C19.7169 26.2768 19.1731 26.9079 18.5822 27.492C18.3151 27.7557 18.0322 27.9881 18.4188 28.3869C19.1763 29.1656 20.0124 29.7528 21.1627 29.4325C22.3445 29.1028 22.9669 28.2895 23.0392 27.0681L23.036 27.0649Z",fill:"currentColor"})]),s("defs",null,[s("clipPath",{id:"clip0_11482_204655"},[s("rect",{width:"32",height:"32",fill:"white"})])])],-1)]),4),s("div",Zn,[s("span",Jn,Q($.isMcpLoading?"MCPÂ∑•ÂÖ∑Âä†ËΩΩ‰∏≠...":$.modelMap[$.model]||$.model||"ÈÄâÊã©Ê®°Âûã"),1),n(a(H),{class:"arrow-icon",size:12},{default:i(()=>L[4]||(L[4]=[s("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[s("path",{d:"M7 10L12 5L17 10",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"}),s("path",{d:"M7 14L12 19L17 14",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])),_:1})])],2),L[5]||(L[5]=s("div",{class:"header-divider"},null,-1)),s("div",{class:"model-pill prompt-pill",onClick:L[1]||(L[1]=U=>M("show-system-prompt"))},[n(a(H),{size:14,class:"prompt-icon"},{default:i(()=>[n(a(Qa))]),_:1}),$.systemPrompt?(_(),D("span",Yn,Q($.systemPrompt),1)):(_(),D("span",Xn,"Á≥ªÁªüÊèêÁ§∫ËØç"))]),n(a(ce),{content:"ÊêúÁ¥¢ÂÜÖÂÆπ (Ctrl/Cmd+F)",placement:"bottom","show-after":500},{default:i(()=>[s("div",{class:"model-pill icon-pill",onClick:L[2]||(L[2]=U=>M("open-search"))},[n(a(H),{size:14,class:"header-icon"},{default:i(()=>[n(a(qt))]),_:1})])]),_:1})])])]),_:1}))}},Qn=At(Gn,[["__scopeId","data-v-42168140"]]),el={key:0,class:"drag-overlay"},tl={class:"file-card-container"},ol={class:"file-icon"},al={class:"file-info"},nl=["title"],ll={class:"file-size"},sl={class:"file-actions"},il={class:"waveform-display-area"},rl={key:1,class:"recording-status-text"},cl={class:"option-selector-content"},ul={class:"option-selector-content"},dl={class:"option-selector-content"},pl={class:"chat-input-area-vertical"},fl={key:0,class:"mcp-quick-select"},vl={class:"mcp-quick-list-scroll"},ml=["onMousedown"],gl={class:"mcp-item-left"},hl={class:"mcp-index-badge"},wl={class:"mcp-name"},yl={class:"mcp-tags"},bl={key:0,class:"mcp-tag type-tag"},xl={class:"mcp-item-right"},Cl={class:"input-wrapper"},kl={class:"input-actions-bar"},Sl={class:"action-buttons-left"},$l={xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",class:"icon",style:{"margin-top":"-2px"}},_l={class:"action-buttons-right"},Ml={__name:"ChatInput",props:zo({loading:Boolean,ctrlEnterToSend:Boolean,voiceList:{type:Array,default:()=>[]},layout:{type:String,default:"horizontal"},isMcpActive:Boolean,allMcpServers:{type:Array,default:()=>[]},activeMcpIds:{type:Array,default:()=>[]},activeSkillIds:{type:Array,default:()=>[]}},{prompt:{},promptModifiers:{},fileList:{},fileListModifiers:{},selectedVoice:{},selectedVoiceModifiers:{},tempReasoningEffort:{},tempReasoningEffortModifiers:{}}),emits:zo(["submit","cancel","clear-history","remove-file","upload","send-audio","open-mcp-dialog","pick-file-start","toggle-mcp","open-skill-dialog"],["update:prompt","update:fileList","update:selectedVoice","update:tempReasoningEffort"]),setup($,{expose:E,emit:r}){const M=Ot($,"prompt"),B=Ot($,"fileList"),F=Ot($,"selectedVoice"),I=Ot($,"tempReasoningEffort"),L=$,U=r,Y=g(null),X=g(null),K=g(null),C=g(!1),P=g(0),N=g(!1),de=g(!1),Oe=g(""),qe=g(0),je=g(null),Ct=g(null),Ge=g(null),It=g(null),ft=g(null),Qe=g(null);let ke=null,Be=null,we=null,z=[],Fe=null;const Ne=g(null),Ze=g(!1),He=g(!1),p=g(!1),se=g(!1),Ue=g(L.voiceList||[]);xt(()=>L.voiceList,v=>{Ue.value=v||[]},{immediate:!0});const Me=ve(()=>`ÊÄùËÄÉÈ¢ÑÁÆó: ${{default:"ÈªòËÆ§",low:"‰Ωé",medium:"‰∏≠",high:"È´ò"}[I.value]||"ÈªòËÆ§"}`),J=ve(()=>{if(!de.value)return[];const v=Oe.value.toLowerCase();return L.allMcpServers.filter(k=>{const G=k.name&&k.name.toLowerCase().includes(v),le=k.tags&&k.tags.some(mt=>mt.toLowerCase().includes(v)),j=(k.type||"").toLowerCase();let fe="";j==="builtin"?fe="ÂÜÖÁΩÆ":j==="stdio"?fe="stdio":j==="sse"?fe="sse":j.includes("http")&&(fe="ÂèØÊµÅÂºè http");const Ve=j.includes(v)||fe.includes(v);return G||le||Ve}).slice(0,10)});xt(M,v=>{if(v.startsWith("@")){const d=v.match(/^@([^ \n\r]*)$/);d?(Oe.value=d[1],de.value=!0,qe.value=0):de.value=!1}else de.value=!1});const kt=()=>{const v=Y.value?.$refs.textarea;if(!v)return;const d=v.selectionStart,k=v.selectionEnd,G=M.value;M.value=G.substring(0,d)+`
`+G.substring(k),he(()=>{v.selectionStart=v.selectionEnd=d+1,v.focus()})},St=v=>{if(v.isComposing)return;if(de.value&&J.value.length>0){if(v.key==="Escape"){v.preventDefault(),v.stopPropagation(),de.value=!1;return}if(v.key==="ArrowUp"){v.preventDefault(),qe.value=(qe.value-1+J.value.length)%J.value.length,he(()=>{const k=document.querySelector(".mcp-quick-item.highlighted");k&&k.scrollIntoView({block:"nearest"})});return}if(v.key==="ArrowDown"){v.preventDefault(),qe.value=(qe.value+1)%J.value.length,he(()=>{const k=document.querySelector(".mcp-quick-item.highlighted");k&&k.scrollIntoView({block:"nearest"})});return}if(v.key==="Enter"){v.preventDefault();const k=J.value[qe.value];k&&Ee(k.id);return}if(/^[0-9]$/.test(v.key)){v.preventDefault();const k=parseInt(v.key);k<J.value.length&&Ee(J.value[k].id);return}}if(N.value){(v.ctrlKey||v.metaKey)&&v.key.toLowerCase()==="c"||v.preventDefault();return}if(v.key!=="Enter")return;const d=v.ctrlKey||v.metaKey;L.ctrlEnterToSend?d&&(v.preventDefault(),L.loading||U("submit")):d?(v.preventDefault(),kt()):v.shiftKey||(v.preventDefault(),L.loading||U("submit"))},Ee=v=>{U("toggle-mcp",v),de.value=!1,M.value=""},et=v=>{Ee(v.id)},tt=()=>{L.loading||U("submit")},W=()=>U("cancel"),T=()=>U("clear-history"),ye=v=>U("remove-file",v),dt=()=>{N.value||(p.value=!p.value,p.value&&(se.value=!1,He.value=!1))},Ae=v=>{I.value=v,p.value=!1},ze=async()=>{if(!N.value){if(!se.value){try{const v=await window.api.getConfig();v?.config?.voiceList&&(Ue.value=v.config.voiceList)}catch(v){console.error("Âà∑Êñ∞ËØ≠Èü≥ÂàóË°®Â§±Ë¥•",v)}p.value=!1,He.value=!1}se.value=!se.value}},ue=v=>{F.value=v,se.value=!1},De=()=>{U("pick-file-start"),he(()=>{X.value?.click()})},ne=v=>{const d=v.target.files;d.length&&U("upload",{file:d[0],fileList:Array.from(d)}),X.value&&(X.value.value="")},Se=v=>v.preventDefault(),Je=v=>{Se(v),P.value++,C.value=!0},Le=v=>{Se(v),P.value--,P.value<=0&&(C.value=!1,P.value=0)},vt=v=>{Se(v),C.value=!1,P.value=0;const d=v.dataTransfer.files;d&&d.length>0&&(U("upload",{file:d[0],fileList:Array.from(d)}),ot())},Pe=v=>{const d=v.clipboardData||window.clipboardData;if(!d)return;const k=Array.from(d.items).filter(G=>G.kind==="file");if(k.length>0){Se(v);const G=k.map(le=>le.getAsFile());U("upload",{file:G[0],fileList:G}),ot()}},st=()=>{N.value||(He.value=!He.value,He.value&&(se.value=!1,p.value=!1))},Bt=async v=>{if(He.value=!1,!N.value){N.value=!0,Ne.value=v,Ze.value=!1;try{if(v==="microphone"){const k=(await Et(()=>import("./recorder-core-Dc2vK-2E.js").then(G=>G.r),__vite__mapDeps([0,1,2]),import.meta.url)).default;await Et(()=>import("./waveview-BCcBXsEP.js"),[],import.meta.url),await Et(()=>import("./wav-Cwu-lTX3.js"),[],import.meta.url),await new Promise((G,le)=>{k.TrafficFree=!0,ke=k({type:"wav",sampleRate:16e3,bitRate:16,onProcess:(j,fe,Ve,mt)=>{Be&&Be.input(j[j.length-1],fe,mt)}}),ke.open(()=>{he(()=>{K.value&&(Be=k.WaveView({elem:K.value,lineWidth:3})),ke.start(),G()})},(j,fe)=>{const Ve=(fe?"Áî®Êà∑ÊãíÁªù‰∫ÜÊùÉÈôê, ":"")+"Êó†Ê≥ïÂΩïÈü≥: "+j;ut.error(Ve),ke=null,le(new Error(Ve))})})}else if(v==="system"){const d=await window.api.desktopCaptureSources({types:["screen","window"]});if(!d||d.length===0)throw new Error("Êú™ÊâæÂà∞ÂèØÁî®ÁöÑÁ≥ªÁªüÈü≥È¢ëÊ∫ê");Fe=await navigator.mediaDevices.getUserMedia({audio:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:d[0].id}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:d[0].id}}});const k=Fe.getAudioTracks()[0];if(!k)throw Fe.getTracks().forEach(le=>le.stop()),Fe=null,new Error("Êú™Ê£ÄÊµãÂà∞Á≥ªÁªüÈü≥È¢ëÔºåËØ∑Âä°ÂøÖÂú®Â±èÂπïÂàÜ‰∫´Á™óÂè£‰∏≠ÂãæÈÄâ‚ÄúÂàÜ‰∫´Èü≥È¢ë‚Äù");const G=new MediaStream([k]);z=[],we=new MediaRecorder(G),we.ondataavailable=le=>z.push(le.data),we.onstop=()=>{if(Ze.value){Ke();return}const le=new Blob(z,{type:"audio/wav"}),j=new Date,fe=`${j.getHours().toString().padStart(2,"0")}${j.getMinutes().toString().padStart(2,"0")}${j.getSeconds().toString().padStart(2,"0")}`,Ve=new File([le],`audio-${fe}.wav`,{type:"audio/wav"});U("send-audio",Ve),Ke()},we.start()}}catch(d){console.error("ÂΩïÈü≥ÂêØÂä®Â§±Ë¥•:",d),ut.error(d.message||"Êó†Ê≥ïÂºÄÂßãÂΩïÈü≥"),Ke()}}},Ke=()=>{ke&&(ke.close(),ke=null),Be&&(K.value&&(K.value.innerHTML=""),Be=null),we&&we.state==="recording"&&we.stop(),Fe&&Fe.getTracks().forEach(v=>v.stop()),we=null,Fe=null,z=[],N.value=!1,Ne.value=null},zt=()=>{Ze.value=!0,ut.info("ÂΩïÈü≥Â∑≤ÂèñÊ∂à"),Ne.value==="microphone"&&ke?ke.stop(()=>Ke(),()=>Ke()):Ne.value==="system"&&we&&we.stop()},jt=()=>{Ze.value=!1,Ne.value==="microphone"&&ke?ke.stop(v=>{if(Ze.value){Ke();return}const d=new Date,k=`${d.getHours().toString().padStart(2,"0")}${d.getMinutes().toString().padStart(2,"0")}${d.getSeconds().toString().padStart(2,"0")}`,G=new File([v],`audio-${k}.wav`,{type:"audio/wav"});U("send-audio",G),Ke()},v=>{ut.error("ÂΩïÈü≥Â§±Ë¥•: "+v),Ke()}):Ne.value==="system"&&we&&we.stop()},pe=v=>{const d=v.target;d&&(p.value&&je.value&&!je.value.contains(d)&&It.value&&!It.value.$el.contains(d)&&(p.value=!1),se.value&&Ct.value&&!Ct.value.$el.contains(d)&&ft.value&&!ft.value.$el.contains(d)&&(se.value=!1),He.value&&Ge.value&&!Ge.value.contains(d)&&Qe.value&&!Qe.value.$el.contains(d)&&(He.value=!1))};ro(()=>{window.addEventListener("dragenter",Je),window.addEventListener("dragleave",Le),window.addEventListener("dragover",Se),window.addEventListener("drop",vt),window.addEventListener("paste",Pe),document.addEventListener("click",pe)}),co(()=>{window.removeEventListener("dragenter",Je),window.removeEventListener("dragleave",Le),window.removeEventListener("dragover",Se),window.removeEventListener("drop",vt),window.removeEventListener("paste",Pe),document.removeEventListener("click",pe),Ke()});const ot=(v={})=>{const d=Y.value?.$refs.textarea;d&&(d.focus(),he(()=>{if(v.position&&typeof v.position.start=="number"){const k=M.value?.length||0,G=Math.min(v.position.start,k),le=Math.min(v.position.end,k);d.setSelectionRange(G,le)}else if(v.cursor==="end"){const k=M.value?.length||0;d.setSelectionRange(k,k)}}))},it=v=>{if(!v)return"";const d=/^streamable[\s_-]?http$/i,k=v.toLowerCase();return k==="builtin"?"ÂÜÖÁΩÆ":d.test(k)||k==="http"?"HTTP":k==="sse"?"SSE":k==="stdio"?"Stdio":v};return E({focus:ot,senderRef:Y}),(v,d)=>(_(),D(Re,null,[C.value?(_(),D("div",el,d[10]||(d[10]=[s("div",{class:"drag-overlay-content"}," ÊãñÊãΩÊñá‰ª∂Âà∞Ê≠§Â§Ñ‰ª•‰∏ä‰º† ",-1)]))):ae("",!0),n(a(sn),{class:"input-footer"},{default:i(()=>[B.value.length>0&&!N.value?(_(),_e(a(bt),{key:0},{default:i(()=>[n(a(xe),{span:0}),n(a(xe),{span:24},{default:i(()=>[s("div",tl,[(_(!0),D(Re,null,lt(B.value,(k,G)=>(_(),D("div",{key:G,class:"custom-file-card"},[s("div",ol,[n(a(H),{size:20},{default:i(()=>[n(a(on))]),_:1})]),s("div",al,[s("div",{class:"file-name",title:k.name},Q(k.name),9,nl),s("div",ll,Q((k.size/1024).toFixed(1))+" KB",1)]),s("div",sl,[n(a(R),{type:"danger",link:"",icon:a(an),size:"small",onClick:le=>ye(G)},null,8,["icon","onClick"])])]))),128))])]),_:1}),n(a(xe),{span:0})]),_:1})):ae("",!0),tn(n(a(bt),{class:"waveform-row"},{default:i(()=>[n(a(xe),{span:0}),n(a(xe),{span:24},{default:i(()=>[s("div",il,[Ne.value==="microphone"?(_(),D("div",{key:0,ref_key:"waveformCanvasContainer",ref:K,class:"waveform-canvas"},null,512)):(_(),D("span",rl,"Ê≠£Âú®ÂΩïÂà∂Á≥ªÁªüÈü≥È¢ë..."))])]),_:1}),n(a(xe),{span:0})]),_:1},512),[[nn,N.value]]),He.value?(_(),_e(a(bt),{key:1,class:"option-selector-row"},{default:i(()=>[n(a(xe),{span:0}),n(a(xe),{span:24},{default:i(()=>[s("div",{class:"option-selector-wrapper",ref_key:"audioSourceSelectorRef",ref:Ge},[s("div",cl,[n(a(no),{tag:"b",class:"selector-label"},{default:i(()=>d[11]||(d[11]=[q("ÈÄâÊã©Èü≥Ê∫ê")])),_:1}),n(a(lo),{direction:"vertical"}),n(a(R),{onClick:d[0]||(d[0]=k=>Bt("microphone")),round:""},{default:i(()=>d[12]||(d[12]=[q("üéôÔ∏è È∫¶ÂÖãÈ£é")])),_:1}),n(a(R),{onClick:d[1]||(d[1]=k=>Bt("system")),round:""},{default:i(()=>d[13]||(d[13]=[q("üíª Á≥ªÁªüÈü≥È¢ë")])),_:1})])],512)]),_:1}),n(a(xe),{span:0})]),_:1})):ae("",!0),p.value?(_(),_e(a(bt),{key:2,class:"option-selector-row"},{default:i(()=>[n(a(xe),{span:0}),n(a(xe),{span:24},{default:i(()=>[s("div",{class:"option-selector-wrapper",ref_key:"reasoningSelectorRef",ref:je},[s("div",ul,[n(a(no),{tag:"b",class:"selector-label"},{default:i(()=>d[14]||(d[14]=[q("ÊÄùËÄÉÈ¢ÑÁÆó")])),_:1}),n(a(lo),{direction:"vertical"}),n(a(R),{onClick:d[2]||(d[2]=k=>Ae("default")),type:I.value==="default"?"primary":"default",round:""},{default:i(()=>d[15]||(d[15]=[q("ÈªòËÆ§")])),_:1},8,["type"]),n(a(R),{onClick:d[3]||(d[3]=k=>Ae("low")),type:I.value==="low"?"primary":"default",round:""},{default:i(()=>d[16]||(d[16]=[q("Âø´ÈÄü")])),_:1},8,["type"]),n(a(R),{onClick:d[4]||(d[4]=k=>Ae("medium")),type:I.value==="medium"?"primary":"default",round:""},{default:i(()=>d[17]||(d[17]=[q("ÂùáË°°")])),_:1},8,["type"]),n(a(R),{onClick:d[5]||(d[5]=k=>Ae("high")),type:I.value==="high"?"primary":"default",round:""},{default:i(()=>d[18]||(d[18]=[q("Ê∑±ÂÖ•")])),_:1},8,["type"])])],512)]),_:1}),n(a(xe),{span:0})]),_:1})):ae("",!0),se.value?(_(),_e(a(bt),{key:3,class:"option-selector-row"},{default:i(()=>[n(a(xe),{span:0}),n(a(xe),{span:24},{default:i(()=>[n(a(ln),{class:"option-selector-wrapper",ref_key:"voiceSelectorRef",ref:Ct},{default:i(()=>[s("div",dl,[n(a(no),{tag:"b",class:"selector-label"},{default:i(()=>d[19]||(d[19]=[q("ÈÄâÊã©Èü≥Ëâ≤")])),_:1}),n(a(lo),{direction:"vertical"}),n(a(R),{onClick:d[6]||(d[6]=k=>ue(null)),type:F.value?"default":"primary",round:""},{default:i(()=>d[20]||(d[20]=[q(" ÂÖ≥Èó≠ËØ≠Èü≥ ")])),_:1},8,["type"]),(_(!0),D(Re,null,lt(Ue.value,k=>(_(),_e(a(R),{key:k,onClick:G=>ue(k),type:F.value===k?"primary":"default",round:""},{default:i(()=>[q(Q(k),1)]),_:2},1032,["onClick","type"]))),128))])]),_:1},512)]),_:1}),n(a(xe),{span:0})]),_:1})):ae("",!0),n(a(bt),null,{default:i(()=>[n(a(xe),{span:0}),n(a(xe),{span:24},{default:i(()=>[s("div",pl,[de.value&&J.value.length>0?(_(),D("div",fl,[d[21]||(d[21]=s("div",{class:"mcp-quick-header"},[s("span",{class:"header-title"},"MCPÂø´Êç∑ÈÄâÊã©"),s("span",{class:"header-hint"},[q("Esc ÂèñÊ∂à "),s("span",{class:"divider"},"|"),q(" ‚áÖ ÈÄâÊã© "),s("span",{class:"divider"},"|"),q(" Enter/Êï∞Â≠óÈîÆ Á°ÆËÆ§")])],-1)),s("div",vl,[(_(!0),D(Re,null,lt(J.value,(k,G)=>(_(),D("div",{key:k.id,class:Ce(["mcp-quick-item",{highlighted:G===qe.value,active:$.activeMcpIds.includes(k.id)}]),onMousedown:Xe(le=>et(k),["prevent"])},[s("div",gl,[s("span",hl,Q(G),1),s("span",wl,Q(k.name),1),s("div",yl,[k.type?(_(),D("span",bl,Q(it(k.type)),1)):ae("",!0),(_(!0),D(Re,null,lt((k.tags||[]).slice(0,2),le=>(_(),D("span",{key:le,class:"mcp-tag"},Q(le),1))),128))])]),s("div",xl,[$.activeMcpIds.includes(k.id)?(_(),_e(a(H),{key:0,class:"active-icon"},{default:i(()=>[n(a(Ut))]),_:1})):ae("",!0)])],42,ml))),128))])])):ae("",!0),s("div",Cl,[n(a(nt),{ref_key:"senderRef",ref:Y,class:"chat-textarea-vertical",modelValue:M.value,"onUpdate:modelValue":d[7]||(d[7]=k=>M.value=k),type:"textarea",placeholder:N.value?"ÂΩïÈü≥‰∏≠... ÁªìÊùüÂêéÂ∞ÜËøûÂêåÊñáÊú¨‰∏ÄËµ∑ÂèëÈÄÅ":"ËæìÂÖ•„ÄÅÁ≤òË¥¥„ÄÅÊãñÊãΩ‰ª•ÂèëÈÄÅÂÜÖÂÆπÔºå‚Äú@‚ÄùÈÄâÊã©MCP",autosize:{minRows:1,maxRows:15},resize:"none",onKeydown:St,disabled:N.value},null,8,["modelValue","placeholder","disabled"])]),s("div",kl,[s("div",Sl,[n(a(ce),{content:"Ê∏ÖÈô§ËÅäÂ§©ËÆ∞ÂΩï"},{default:i(()=>[n(a(R),{size:"default",onClick:T,circle:"",disabled:N.value},{default:i(()=>[n(a(H),{size:18},{default:i(()=>d[22]||(d[22]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"lucide lucide-paintbrush-vertical","aria-hidden":"true"},[s("path",{d:"M10 2v2"}),s("path",{d:"M14 2v4"}),s("path",{d:"M17 2a1 1 0 0 1 1 1v9H6V3a1 1 0 0 1 1-1z"}),s("path",{d:"M6 12a1 1 0 0 0-1 1v1a2 2 0 0 0 2 2h2a1 1 0 0 1 1 1v2.9a2 2 0 1 0 4 0V17a1 1 0 0 1 1-1h2a2 2 0 0 0 2-2v-1a1 1 0 0 0-1-1"})],-1)])),_:1})]),_:1},8,["disabled"])]),_:1}),n(a(ce),{content:"Ê∑ªÂä†ÈôÑ‰ª∂"},{default:i(()=>[n(a(R),{size:"default",onClick:De,circle:"",disabled:N.value},{default:i(()=>[n(a(H),{size:17},{default:i(()=>d[23]||(d[23]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"lucide lucide-paperclip","aria-hidden":"true"},[s("path",{d:"m16 6-8.414 8.586a2 2 0 0 0 2.829 2.829l8.414-8.586a4 4 0 1 0-5.657-5.657l-8.379 8.551a6 6 0 1 0 8.485 8.485l8.379-8.551"})],-1)])),_:1})]),_:1},8,["disabled"])]),_:1}),n(a(ce),{content:Me.value},{default:i(()=>[n(a(R),{ref_key:"reasoningButtonRef",ref:It,class:Ce({"is-active-special":I.value&&I.value!=="default"}),size:"default",circle:"",disabled:N.value,onClick:dt},{default:i(()=>[n(a(H),{size:18},{default:i(()=>[(_(),D("svg",$l,d[24]||(d[24]=[s("path",{fill:"currentColor",d:"M1 11h3v2H1zm9 11c0 .6.4 1 1 1h2c.6 0 1-.4 1-1v-1h-4zm3-21h-2v3h2zM4.9 3.5L3.5 4.9L5.6 7L7 5.6zM20 11v2h3v-2zm-.9-7.5L17 5.6L18.4 7l2.1-2.1zM18 12c0 2.2-1.2 4.2-3 5.2V19c0 .6-.4 1-1 1h-4c-.6 0-1-.4-1-1v-1.8c-1.8-1-3-3-3-5.2c0-3.3 2.7-6 6-6s6 2.7 6 6M8 12c0 .35.05.68.14 1h7.72c.09-.32.14-.65.14-1c0-2.21-1.79-4-4-4s-4 1.79-4 4"},null,-1)])))]),_:1})]),_:1},8,["class","disabled"])]),_:1},8,["content"]),n(a(ce),{content:"ËØ≠Èü≥ÂõûÂ§çËÆæÁΩÆ"},{default:i(()=>[n(a(R),{ref_key:"voiceButtonRef",ref:ft,size:"default",circle:"",disabled:N.value,class:Ce({"is-active-special":F.value}),onClick:ze},{default:i(()=>[n(a(H),{size:18},{default:i(()=>d[25]||(d[25]=[s("svg",{t:"1765028999430",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"60819",width:"200",height:"200"},[s("path",{d:"M85.333333 512C85.333333 276.352 276.352 85.333333 512 85.333333s426.666667 191.018667 426.666667 426.666667-191.018667 426.666667-426.666667 426.666667H85.333333l124.970667-124.970667A425.344 425.344 0 0 1 85.333333 512z m205.994667 341.333333H512a341.333333 341.333333 0 1 0-341.333333-341.333333c0 91.818667 36.309333 177.706667 99.968 241.365333l60.330666 60.330667-39.637333 39.637333zM469.333333 256h85.333334v512h-85.333334V256zM298.666667 384h85.333333v256H298.666667V384z m341.333333 0h85.333333v256h-85.333333V384z","p-id":"60820"})],-1)])),_:1})]),_:1},8,["disabled","class"])]),_:1}),n(a(ce),{content:"MCPÂ∑•ÂÖ∑"},{default:i(()=>[n(a(R),{size:"default",circle:"",disabled:N.value,class:Ce({"is-active-special":$.isMcpActive}),onClick:d[8]||(d[8]=k=>v.$emit("open-mcp-dialog"))},{default:i(()=>[n(a(H),{size:18},{default:i(()=>d[26]||(d[26]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"lucide lucide-hammer","aria-hidden":"true"},[s("path",{d:"m15 12-8.373 8.373a1 1 0 1 1-3-3L12 9"}),s("path",{d:"m18 15 4-4"}),s("path",{d:"m21.5 11.5-1.914-1.914A2 2 0 0 1 19 8.172V7l-2.26-2.26a6 6 0 0 0-4.202-1.756L9 2.96l.92.82A6.18 6.18 0 0 1 12 8.4V10l2 2h1.172a2 2 0 0 1 1.414.586L18.5 14.5"})],-1)])),_:1})]),_:1},8,["disabled","class"])]),_:1}),n(a(ce),{content:"Skill ÊäÄËÉΩÂ∫ì"},{default:i(()=>[n(a(R),{size:"default",circle:"",disabled:N.value,class:Ce({"is-active-special":$.activeSkillIds&&$.activeSkillIds.length>0}),onClick:d[9]||(d[9]=k=>v.$emit("open-skill-dialog"))},{default:i(()=>[n(a(H),{size:18},{default:i(()=>[n(a(Ho))]),_:1})]),_:1},8,["disabled","class"])]),_:1})]),s("div",_l,[N.value?(_(),D(Re,{key:0},[n(a(ce),{content:"ÂèñÊ∂àÂΩïÈü≥"},{default:i(()=>[n(a(R),{icon:a(Wt),size:"default",onClick:zt,circle:""},null,8,["icon"])]),_:1}),n(a(ce),{content:"ÁªìÊùüÂπ∂ÂèëÈÄÅ"},{default:i(()=>[n(a(R),{icon:a(Ut),size:"default",onClick:jt,circle:""},null,8,["icon"])]),_:1})],64)):(_(),D(Re,{key:1},[n(a(ce),{content:"ÂèëÈÄÅËØ≠Èü≥"},{default:i(()=>[n(a(R),{ref_key:"audioButtonRef",ref:Qe,size:"default",onClick:st,circle:""},{default:i(()=>[n(a(H),{size:17},{default:i(()=>d[27]||(d[27]=[s("svg",{t:"1765029327206",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"68987",width:"200",height:"200"},[s("path",{d:"M516.368 732.288c126.944 0 230.096-99.696 230.096-222.272V230.272c0-122.56-103.28-222.272-230.096-222.272S286.16 107.696 286.16 230.272v279.744c0 122.56 103.28 222.272 230.208 222.272zM377.664 230.272c0-73.808 62.256-133.984 138.704-133.984 76.448 0 138.688 60.048 138.688 133.984v279.744c0 73.808-62.256 134-138.688 134-76.448 0-138.704-60.048-138.704-134V230.272z","p-id":"68988"}),s("path",{d:"M465.088 899.296C267.52 876.656 113.776 712.928 113.776 514.928c0-24.832 20.64-44.896 46.16-44.896 25.536 0 46.16 20.064 46.16 44.896 0 163.952 137.184 297.376 305.856 297.376 168.656 0 305.968-133.424 305.968-297.376 0-24.832 20.656-44.896 46.192-44.896 25.504 0 46.128 20.064 46.128 44.896 0 196.976-152.096 359.872-348.16 384.016v68.592A48.416 48.416 0 0 1 513.6 1016a48.448 48.448 0 0 1-48.496-48.464v-68.24z","p-id":"68989"})],-1)])),_:1})]),_:1},512)]),_:1}),$.loading?(_(),_e(a(R),{key:1,onClick:W,circle:"",class:"cancel-button-animated"},{default:i(()=>[n(a(H),{class:"static-icon"},{default:i(()=>[n(a(Wt))]),_:1}),d[29]||(d[29]=s("div",{class:"cancel-spinner"},null,-1))]),_:1})):(_(),_e(a(R),{key:0,onClick:tt,circle:"",disabled:$.loading},{default:i(()=>[n(a(H),{size:18},{default:i(()=>d[28]||(d[28]=[s("svg",{t:"1765029205363",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"63447",width:"200",height:"200"},[s("path",{d:"M866.133333 298.666667l-277.333333 396.8 174.933333 64L866.133333 298.666667zM469.333333 691.2l362.666667-482.133333-652.8 332.8 230.4 72.533333c21.333333 8.533333 29.866667 29.866667 21.333333 51.2v4.266667c-12.8 21.333333-42.666667 34.133333-68.266666 21.333333L76.8 597.333333c-21.333333-8.533333-34.133333-29.866667-25.6-55.466666 4.266667-8.533333 12.8-17.066667 21.333333-25.6L913.066667 72.533333c21.333333-12.8 46.933333-4.266667 59.733333 17.066667 4.266667 8.533333 4.266667 17.066667 4.266667 29.866667l-140.8 699.733333c-4.266667 21.333333-25.6 38.4-51.2 34.133333h-4.266667l-238.933333-89.6v162.133334c0 21.333333-17.066667 38.4-38.4 42.666666-21.333333 0-38.4-17.066667-38.4-42.666666","p-id":"63448"})],-1)])),_:1})]),_:1},8,["disabled"]))],64))])])]),s("input",{ref_key:"fileInputRef",ref:X,type:"file",multiple:"",onChange:ne,style:{display:"none"}},null,544)]),_:1}),n(a(xe),{span:0})]),_:1})]),_:1})],64))}},Ll=At(Ml,[["__scopeId","data-v-61d52cc2"]]),Tl={class:"model-search-container"},El={__name:"ModelSelectionDialog",props:{modelValue:Boolean,modelList:Array,currentModel:String},emits:["update:modelValue","select","save-model"],setup($,{emit:E}){const r=$,M=E,B=g(""),F=g(null),I=()=>{F.value&&F.value.focus()},L=ve(()=>{if(!B.value)return r.modelList;const K=B.value.toLowerCase();return r.modelList.filter(C=>C.label.toLowerCase().includes(K))}),U=({row:K,column:C,rowIndex:P,columnIndex:N})=>{if(N===0){if(P>0&&L.value[P-1].label.split("|")[0]===K.label.split("|")[0])return{rowspan:0,colspan:0};let de=1;for(let Oe=P+1;Oe<L.value.length&&L.value[Oe].label.split("|")[0]===K.label.split("|")[0];Oe++)de++;return{rowspan:de,colspan:1}}},Y=K=>{K.value===r.currentModel?M("save-model",K.value):M("select",K.value)},X=()=>{B.value="",M("update:modelValue",!1)};return(K,C)=>(_(),_e(a(Ht),{"model-value":$.modelValue,"onUpdate:modelValue":X,width:"80%","custom-class":"model-dialog no-header-dialog",onOpened:I,"show-close":!1},{header:i(()=>C[1]||(C[1]=[s("div",{style:{display:"none"}},null,-1)])),footer:i(()=>[n(a(R),{onClick:X},{default:i(()=>C[2]||(C[2]=[q("ÂÖ≥Èó≠")])),_:1})]),default:i(()=>[s("div",Tl,[n(a(nt),{ref_key:"searchInputRef",ref:F,modelValue:B.value,"onUpdate:modelValue":C[0]||(C[0]=P=>B.value=P),placeholder:"ÊêúÁ¥¢ÊúçÂä°ÂïÜÊàñÊ®°ÂûãÂêçÁß∞...",clearable:"","prefix-icon":a(qt)},null,8,["modelValue","prefix-icon"])]),n(a(rn),{data:L.value,stripe:"",style:{width:"100%"},"max-height":"50vh",border:!0,"span-method":U,width:"100%"},{default:i(()=>[n(a(Do),{label:"ÊúçÂä°ÂïÜ",align:"center",prop:"provider",width:"120"},{default:i(P=>[s("strong",null,Q(P.row.label.split("|")[0]),1)]),_:1}),n(a(Do),{label:"Ê®°Âûã",align:"center",prop:"modelName"},{default:i(P=>[n(a(ce),{content:P.row.value===$.currentModel?"ÂΩìÂâçÊ®°ÂûãÔºåÂÜçÊ¨°ÁÇπÂáªÂèØ‰øùÂ≠ò‰∏∫ÈªòËÆ§":"ÈÄâÊã©Ê≠§Ê®°Âûã",placement:"top",enterable:!1},{default:i(()=>[n(a(R),{link:"",size:"large",onClick:N=>Y(P.row),class:Ce({"is-current-model":P.row.value===$.currentModel})},{default:i(()=>[q(Q(P.row.label.split("|")[1]),1)]),_:2},1032,["onClick","class"])]),_:2},1032,["content"])]),_:1})]),_:1},8,["data"])]),_:1},8,["model-value"]))}},Al=At(El,[["__scopeId","data-v-f79263e1"]]);class Il{constructor(E={}){this.options=Object.assign({theme:"auto",scope:"body",beforeShow:null},E),this.container=null,this.input=null,this.matches=[],this.currentIndex=-1,this.isOpen=!1,this.searchScope=null,this._handleResize=this._constrainToWindow.bind(this),this._init()}_init(){this._injectStyles(),this._createUI(),this._bindEvents(),this.setTheme(this.options.theme),this.setScope(this.options.scope)}_injectStyles(){const E="text-search-ui-style";if(document.getElementById(E))return;const r=`
      :root {
        --ts-bg: #ffffff;
        --ts-text: #333333;
        --ts-border: #e5e7eb;
        --ts-hover: #f3f4f6;
        --ts-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
        --ts-highlight: #ffeb3b;
        --ts-highlight-current: #ff9800;
        --ts-highlight-text: #000000;
      }
      
      [data-search-theme="dark"] {
        --ts-bg: #2a2a2a;
        --ts-text: #e5e7eb;
        --ts-border: #4b5563;
        --ts-hover: #374151;
        --ts-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.5);
        --ts-highlight: #b45309;
        --ts-highlight-current: #f59e0b;
        --ts-highlight-text: #ffffff;
      }

      .text-search-container {
        position: fixed;
        top: 20px;
        right: 40px;
        z-index: 10000;
        background: var(--ts-bg);
        color: var(--ts-text);
        padding: 8px;
        border-radius: 6px;
        box-shadow: var(--ts-shadow);
        border: 1px solid var(--ts-border);
        display: flex;
        align-items: center;
        gap: 8px;
        font-family: system-ui, -apple-system, sans-serif;
        font-size: 14px;
        transition: opacity 0.2s;
        min-width: 300px;
      }

      .text-search-container.hidden {
        opacity: 0;
        pointer-events: none;
        /* ÈöêËóèÊó∂‰∏çÊîπÂèò‰ΩçÁΩÆÔºåÈÅøÂÖçÂä®Áîª‰π±Ë∑≥ÔºåÂè™ÊîπÈÄèÊòéÂ∫¶ÂíåÁÇπÂáªÁ©øÈÄè */
        visibility: hidden; 
      }

      .text-search-drag-handle {
        cursor: move;
        color: var(--ts-text);
        opacity: 0.5;
        padding: 0 4px;
        user-select: none;
      }

      .text-search-input {
        background: transparent;
        border: none;
        color: var(--ts-text);
        outline: none;
        flex-grow: 1;
        width: 120px;
        font-size: 14px;
      }

      .text-search-count {
        font-size: 12px;
        color: var(--ts-text);
        opacity: 0.7;
        white-space: nowrap;
        min-width: 40px;
        text-align: center;
        user-select: none;
      }

      .text-search-divider {
        width: 1px;
        height: 16px;
        background: var(--ts-border);
        margin: 0 4px;
      }

      .text-search-btn {
        background: transparent;
        border: none;
        color: var(--ts-text);
        cursor: pointer;
        padding: 4px;
        border-radius: 4px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background 0.1s;
      }

      .text-search-btn:hover {
        background: var(--ts-hover);
      }

      .text-search-btn:disabled {
        opacity: 0.3;
        cursor: not-allowed;
      }

      mark.search-highlight {
        background-color: var(--ts-highlight);
        color: var(--ts-highlight-text);
        border-radius: 2px;
        padding: 0 1px;
      }

      mark.search-highlight.current {
        background-color: var(--ts-highlight-current);
        color: var(--ts-highlight-text);
        outline: 2px solid rgba(255, 255, 255, 0.3);
      }
    `,M=document.createElement("style");M.id=E,M.textContent=r,document.head.appendChild(M)}_createUI(){this.container=document.createElement("div"),this.container.className="text-search-container hidden",this.container.innerHTML=`
      <div class="text-search-drag-handle">‚ãÆ‚ãÆ</div>
      <input type="text" class="text-search-input" placeholder="Êü•ÊâæÊ∂àÊÅØ..." />
      <span class="text-search-count">0/0</span>
      <div class="text-search-divider"></div>
      <button class="text-search-btn btn-prev" title="‰∏ä‰∏Ä‰∏™ (Shift+Enter)">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 15l-6-6-6 6"/></svg>
      </button>
      <button class="text-search-btn btn-next" title="‰∏ã‰∏Ä‰∏™ (Enter)">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9l6 6 6-6"/></svg>
      </button>
      <button class="text-search-btn btn-close" title="ÂÖ≥Èó≠ (Esc)">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg>
      </button>
    `,document.body.appendChild(this.container),this.input=this.container.querySelector(".text-search-input"),this.countSpan=this.container.querySelector(".text-search-count"),this.btnPrev=this.container.querySelector(".btn-prev"),this.btnNext=this.container.querySelector(".btn-next"),this.btnClose=this.container.querySelector(".btn-close")}_bindEvents(){this.input.addEventListener("input",L=>{this.search(L.target.value)}),this.input.addEventListener("keydown",L=>{L.key==="Enter"&&(L.preventDefault(),L.shiftKey?this.findPrevious():this.findNext())}),this.btnPrev.addEventListener("click",()=>this.findPrevious()),this.btnNext.addEventListener("click",()=>this.findNext()),this.btnClose.addEventListener("click",()=>this.hide()),document.addEventListener("keydown",L=>{(L.ctrlKey||L.metaKey)&&L.key==="f"&&(L.preventDefault(),this.show()),L.key==="Escape"&&this.isOpen&&(L.preventDefault(),this.hide())}),window.addEventListener("resize",this._handleResize);const E=this.container.querySelector(".text-search-drag-handle");let r=!1,M,B,F,I;E.addEventListener("mousedown",L=>{r=!0,M=L.clientX,B=L.clientY;const U=this.container.getBoundingClientRect();F=U.left,I=U.top,this.container.style.right="auto",this.container.style.width=U.width+"px"}),document.addEventListener("mousemove",L=>{if(!r)return;L.preventDefault();const U=L.clientX-M,Y=L.clientY-B;let X=F+U,K=I+Y;const C=window.innerWidth,P=window.innerHeight,N=this.container.getBoundingClientRect();X<0?X=0:X+N.width>C&&(X=C-N.width),K<0?K=0:K+N.height>P&&(K=P-N.height),this.container.style.left=`${X}px`,this.container.style.top=`${K}px`}),document.addEventListener("mouseup",()=>{r=!1})}_constrainToWindow(){if(!this.container)return;const E=this.container.getBoundingClientRect(),r=window.innerWidth,M=window.innerHeight;let B=E.left,F=E.top,I=!1;E.right>r&&(B=r-E.width,B<0&&(B=0),I=!0),E.bottom>M&&(F=M-E.height,F<0&&(F=0),I=!0),I&&(this.container.style.left=`${B}px`,this.container.style.top=`${F}px`,this.container.style.right="auto")}setScope(E){typeof E=="string"?this.searchScope=document.querySelector(E):E instanceof HTMLElement?this.searchScope=E:this.searchScope=document.body}setTheme(E){if(E==="auto"){const r=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches;document.body.setAttribute("data-search-theme",r?"dark":"light")}else document.body.setAttribute("data-search-theme",E)}show(){this.options.beforeShow&&this.options.beforeShow(),this.container.classList.remove("hidden"),this.isOpen=!0,this._constrainToWindow(),setTimeout(()=>this.input.focus(),50),this.input.value&&this.search(this.input.value)}hide(){this.container.classList.add("hidden"),this.isOpen=!1,this.clear(),document.activeElement.blur()}clear(){this.searchScope.querySelectorAll("mark.search-highlight").forEach(r=>{const M=r.parentNode;M.replaceChild(document.createTextNode(r.textContent),r),M.normalize()}),this.matches=[],this.currentIndex=-1,this.updateCount()}search(E){if(this.clear(),!E)return;const r=new RegExp(E.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"gi"),M=document.createTreeWalker(this.searchScope,NodeFilter.SHOW_TEXT,{acceptNode:I=>I.parentElement.closest(".text-search-container, script, style, .no-search")?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}),B=[];let F;for(;F=M.nextNode();)B.push(F);for(const I of B){const L=I.nodeValue;let U,Y=0;const X=[];let K=!1;for(r.lastIndex=0;(U=r.exec(L))!==null;){K=!0,U.index>Y&&X.push(document.createTextNode(L.substring(Y,U.index)));const C=document.createElement("mark");C.className="search-highlight",C.textContent=U[0],X.push(C),this.matches.push(C),Y=r.lastIndex}if(K){Y<L.length&&X.push(document.createTextNode(L.substring(Y)));const C=I.parentNode;X.forEach(P=>C.insertBefore(P,I)),C.removeChild(I)}}this.matches.length>0&&this.jumpTo(0),this.updateCount()}jumpTo(E){if(this.matches.length===0)return;this.currentIndex>=0&&this.matches[this.currentIndex]&&this.matches[this.currentIndex].classList.remove("current"),this.currentIndex=(E+this.matches.length)%this.matches.length;const r=this.matches[this.currentIndex];r.classList.add("current"),r.scrollIntoView({behavior:"smooth",block:"center"}),this.updateCount()}findNext(){this.jumpTo(this.currentIndex+1)}findPrevious(){this.jumpTo(this.currentIndex-1)}updateCount(){const E=this.matches.length,r=E===0?0:this.currentIndex+1;this.countSpan.textContent=`${r}/${E}`,this.btnPrev.disabled=E===0,this.btnNext.disabled=E===0}destroy(){window.removeEventListener("resize",this._handleResize),this.container&&this.container.remove()}}const Nt=$=>{if(!$)return"";try{const E=new Date($),r=E.toLocaleDateString("sv-SE"),M=E.toLocaleTimeString("sv-SE",{hour:"2-digit",minute:"2-digit"});return`${r} ${M}`}catch{return""}},$s=$=>{if(!$)return"";if(!Array.isArray($))return String($);let E="";return $.forEach(r=>{r.type==="text"&&r.text&&!(r.text.toLowerCase().startsWith("file name:")&&r.text.toLowerCase().endsWith("file end"))&&(E+=r.text)}),E.trim()},Bl=$=>{if(!$)return"{}";try{return JSON.parse($),$}catch{let r=$.indexOf("{");if(r===-1)return"{}";let M=0;for(let B=r;B<$.length;B++)if($[B]==="{"?M++:$[B]==="}"&&M--,M===0){const F=$.substring(r,B+1);try{return JSON.parse(F),F}catch{return"{}"}}return"{}"}},zl={key:0,class:"window-bg-base"},Dl={class:"main-area-wrapper"},Pl={key:0,class:"scroll-to-bottom-wrapper"},Vl={key:1,class:"custom-viewer-actions"},Rl={class:"mcp-dialog-content"},Ol={class:"mcp-dialog-toolbar"},Fl={class:"mcp-server-list custom-scrollbar"},Nl=["onClick"],Hl={class:"mcp-server-content"},Ul={class:"mcp-server-header-row"},Wl={class:"mcp-server-name"},ql={key:0,class:"mcp-tool-count"},jl={class:"mcp-header-right-group"},Kl={class:"mcp-server-tags"},Zl={class:"mcp-server-body-row"},Jl=["onClick"],Yl=["onClick"],Xl={class:"mcp-tool-info"},Gl={class:"mcp-tool-name"},Ql=["title"],es={key:1,class:"mcp-tools-empty"},ts={class:"mcp-dialog-footer-search"},os={class:"mcp-dialog-footer"},as={class:"footer-left-controls"},ns={class:"mcp-dialog-content"},ls={class:"mcp-dialog-toolbar"},ss={class:"mcp-server-list custom-scrollbar"},is={key:0,style:{padding:"20px","text-align":"center",color:"var(--el-text-color-placeholder)"}},rs=["onClick"],cs={class:"skill-single-row"},us={class:"mcp-server-name skill-name-fixed"},ds=["title"],ps={class:"mcp-header-right-group"},fs=["onClick"],vs={class:"mcp-dialog-footer-search"},ms={class:"mcp-dialog-footer"},gs={class:"footer-left-controls"},hs={key:0,class:"mcp-limit-hint",style:{"margin-right":"15px","font-weight":"bold",color:"var(--el-color-primary)"}},ws={class:"mcp-limit-hint warning",style:{display:"inline-flex","align-items":"center",opacity:"0.8"}},ys={__name:"App",setup($){const E=un(()=>Et(()=>import("./ChatMessage-CO3pEFSS.js").then(e=>e.a5),__vite__mapDeps([3,1,4,2,5]),import.meta.url)),r=e=>{const t=typeof e=="string"?{message:e}:e,o=t.duration!==void 0?t.duration:1e3;let l=null;const c={...t,duration:o,showClose:!1,grouping:!0,offset:40,onClick:()=>{l&&l.close()}};l=ut(c)};r.success=e=>r({message:e,type:"success"}),r.error=e=>r({message:e,type:"error"}),r.info=e=>r({message:e,type:"info"}),r.warning=e=>r({message:e,type:"warning"});const M=()=>window.api.windowControl("minimize-window"),B=()=>window.api.windowControl("maximize-window"),F=()=>Mt(),I=g(null),L=g(null),U=g(null),Y=g(null),X=g(!0),K=g(!1),C=g(!1),P=new Map,N=g(null),de=g(!0);let Oe=null,qe=null,je=null;const Ct=(e,t)=>{e?P.set(t,e):P.delete(t)},Ge=e=>{const t=T.value[e];if(t)return P.get(t.id)},ft=new URLSearchParams(window.location.search).get("dark")==="1";ft&&document.documentElement.classList.add("dark");const Qe=window.api.defaultConfig,ke=g("user.png"),Be=g("ai.svg"),we=g("favicon.png"),z=g(""),Fe=g(!1),Ne=g(!1),Ze=g({os:"macos",code:"AI",type:"over",payload:"ËØ∑ÁÆÄÊ¥ÅÂú∞‰ªãÁªç‰∏Ä‰∏ã‰Ω†Ëá™Â∑±"}),He=JSON.parse(JSON.stringify(Qe.config));ft&&(He.isDarkMode=!0);const p=g(He),se=g(!1),Ue=g([]),Me=g({}),J=g(""),kt=g(!0),St=g("win"),Ee=g(Qe.config.providerOrder[0]),et=g(""),tt=g(""),W=g([]),T=g([]),ye=g(!1),dt=g(""),Ae=g(null),ze=g([]),ue=g(1),De=g(new Set),ne=g(""),Se=g(null),Je=g("default"),Le=g(0),vt=g(null),Pe=g(""),st=ve(()=>Pe.value?Pe.value:!z.value||!p.value?.prompts?"":p.value.prompts[z.value]?.backgroundImage||""),Bt=ve(()=>!z.value||!p.value?.prompts?.5:p.value.prompts[z.value]?.backgroundOpacity??.5),Ke=ve(()=>!z.value||!p.value?.prompts?0:p.value.prompts[z.value]?.backgroundBlur??0),zt=async e=>{if(!e){Pe.value&&(Pe.value.startsWith("blob:")&&URL.revokeObjectURL(Pe.value),Pe.value="");return}if(!(e.startsWith("data:")||e.startsWith("file:")))try{const t=await window.api.getCachedBackgroundImage(e);if(t){const o=new Blob([t]),l=URL.createObjectURL(o);Pe.value&&Pe.value.startsWith("blob:")&&URL.revokeObjectURL(Pe.value),Pe.value=l}else console.log(`[Background] Cache miss, downloading in background: ${e}`),window.api.cacheBackgroundImage(e)}catch(t){console.error("Failed to load cached background:",t)}};xt(()=>!z.value||!p.value?.prompts?null:p.value.prompts[z.value]?.backgroundImage,async e=>{await zt(e)},{immediate:!1});const jt=ve(()=>p.value.inputLayout||"horizontal"),pe=g(""),ot=g(!1),it=g(!1),v=g(""),d=g(!1),k=g([]),G=g(0),le=g(new Map),j=g([]),fe=g(!0),Ve=g(new Map),mt=(e,t)=>{const o=Ve.value.get(e);o&&(o(t),Ve.value.delete(e))},Uo=e=>{fe.value=e,e&&(Ve.value.forEach((t,o)=>{t(!0)}),Ve.value.clear(),T.value.forEach(t=>{t.tool_calls&&t.tool_calls.forEach(o=>{o.approvalStatus==="waiting"&&(o.approvalStatus="approved")})}))},gt=g(!1),be=g([]),Dt=g([]),Pt=g(""),Vt=g(!1),rt=g("all"),pt=g({}),ht=g(new Set),uo=e=>{ht.value.has(e)?ht.value.delete(e):ht.value.add(e)},Wo=async(e,t,o)=>{if(!pt.value[e])return;const l=pt.value[e],c=l.findIndex(f=>f.name===t);if(c!==-1){l[c].enabled=o;const f=JSON.parse(JSON.stringify(l));try{await window.api.saveMcpToolCache(e,f)}catch(h){console.error("Failed to save tool status:",h),r.error("‰øùÂ≠òÂ∑•ÂÖ∑Áä∂ÊÄÅÂ§±Ë¥•"),l[c].enabled=!o}}},Kt=e=>{const t=pt.value[e];if(!t||!Array.isArray(t))return null;const o=t.length;return{enabled:t.filter(c=>c.enabled!==!1).length,total:o}},qo=ve(()=>be.value.length>0),po=ve(()=>{if(!p.value||!p.value.mcpServers)return 0;const e=j.value.filter(o=>{const l=p.value.mcpServers[o];return l&&l.isPersistent&&l.type?.toLowerCase()!=="builtin"}).length,t=j.value.some(o=>{const l=p.value.mcpServers[o];return l&&!l.isPersistent&&l.type?.toLowerCase()!=="builtin"});return e+(t?1:0)}),fo=ve(()=>!p.value||!p.value.mcpServers?[]:Object.entries(p.value.mcpServers).filter(([,e])=>e.isActive).map(([e,t])=>({id:e,...t})).sort((e,t)=>e.name.localeCompare(t.name))),vo=ve(()=>{let e=fo.value;if(rt.value==="selected"?e=e.filter(t=>j.value.includes(t.id)):rt.value==="unselected"&&(e=e.filter(t=>!j.value.includes(t.id))),Pt.value){const t=Pt.value.toLowerCase();e=e.filter(o=>o.name&&o.name.toLowerCase().includes(t)||o.description&&o.description.toLowerCase().includes(t)||o.tags&&Array.isArray(o.tags)&&o.tags.some(l=>l.toLowerCase().includes(t))||o.type&&o.type.toLowerCase().includes(t)||o.type&&Ao(o.type).toLowerCase().includes(t))}return e}),wt=g(!1),Ye=g([]),Ie=g([]),mo=g([]),$t=g(""),at=g("all"),Zt=ve(()=>{let e=mo.value;if(at.value==="selected"?e=e.filter(t=>Ie.value.includes(t.name)):at.value==="unselected"&&(e=e.filter(t=>!Ie.value.includes(t.name))),$t.value){const t=$t.value.toLowerCase();e=e.filter(o=>o.name.toLowerCase().includes(t)||o.description&&o.description.toLowerCase().includes(t))}return e}),jo=()=>{const e=Zt.value.map(o=>o.name),t=new Set([...Ie.value,...e]);Ie.value=Array.from(t)},Ko=()=>{Ie.value=[]},Zo=async()=>{if(!wt.value&&(Ie.value=[...Ye.value],at.value="all",$t.value="",p.value?.skillPath||window.api?.getConfig&&(await window.api.getConfig())?.config?.skillPath)){const t=(await window.api.getConfig()).config.skillPath;if(t)try{const o=await window.api.listSkills(t);mo.value=o.filter(l=>!l.disabled).sort((l,c)=>l.name.localeCompare(c.name))}catch(o){console.error("Fetch skills failed:",o),ut.error("Âà∑Êñ∞ÊäÄËÉΩÂàóË°®Â§±Ë¥•")}}wt.value=!wt.value},Jo=async e=>{const t=e.context!=="fork";try{const l=(await window.api.getConfig()).config.skillPath;await window.api.toggleSkillForkMode(l,e.id,t),e.context=t?"fork":"normal",ut.success(t?"Â∑≤ÂºÄÂêØ Sub-Agent Ê®°Âºè":"Â∑≤ÂÖ≥Èó≠ Sub-Agent Ê®°Âºè")}catch(o){ut.error("Ê®°ÂºèÂàáÊç¢Â§±Ë¥•: "+o.message)}},go=e=>{const t=Ie.value.indexOf(e);t===-1?Ie.value.push(e):Ie.value.splice(t,1)},Yo=async()=>{if(Ye.value=[...Ie.value],wt.value=!1,Ye.value.length>0&&p.value.mcpServers){const e=Object.entries(p.value.mcpServers).filter(([,o])=>o.type==="builtin").map(([o])=>o);let t=!1;e.forEach(o=>{be.value.includes(o)||(be.value.push(o),t=!0),j.value.includes(o)||j.value.push(o)}),t&&(r.success("Â∑≤Ëá™Âä®ÂêØÁî®ÂÜÖÁΩÆ MCP ÊúçÂä°‰ª•ÊîØÊåÅ Skill"),await yt(!1))}},Xo=ve(()=>N.value===null?!1:N.value===T.value.length-1),Go=ve(()=>Xo.value?"ÊªöÂä®Âà∞Â∫ïÈÉ®":"Êü•Áúã‰∏ã‰∏ÄÊù°Ê∂àÊÅØ"),_t=async(e="auto")=>{await he();const t=Y.value?.$el;t&&(de.value=!0,t.scrollTo({top:t.scrollHeight,behavior:e}))},Qo=()=>{const e=Y.value?.$el;e&&e.scrollTo({top:0,behavior:"smooth"})},ho=()=>{C.value=!0,de.value=!0,X.value=!0,K.value=!1,N.value=null,_t("smooth"),setTimeout(()=>{C.value=!1},500)},Jt=()=>{const e=Y.value?.$el;if(!e)return;const t=e.scrollTop;let o=-1,l=1/0;for(let c=T.value.length-1;c>=0;c--){const f=Ge(c);if(f){const h=f.$el,m=h.offsetTop,w=m+h.clientHeight;if(m<t+e.clientHeight&&w>t){const b=Math.abs(m-t);b<l&&(l=b,o=c)}}}o!==-1&&(N.value=o)},ea=e=>{if(C.value)return;const t=e.target;if(!t)return;t.scrollHeight-t.scrollTop-t.clientHeight<=20?(de.value||(de.value=!0),X.value||(X.value=!0),K.value=!1,N.value=null):(de.value&&(de.value=!1),X.value&&(X.value=!1),K.value=!0,Jt())},ta=()=>{Jt();const e=N.value;if(e===null)return;const t=Ge(e),o=Y.value?.$el;if(!t||!o)return;const l=t.$el;if(o.scrollTop-l.offsetTop>5)l.scrollIntoView({behavior:"smooth",block:"start"});else if(e>0){const f=e-1;N.value=f;const h=Ge(f);h&&h.$el.scrollIntoView({behavior:"smooth",block:"start"})}},oa=()=>{if(Jt(),N.value!==null&&N.value<T.value.length-1){N.value++;const e=Ge(N.value);e&&e.$el.scrollIntoView({behavior:"smooth",block:"start"})}else ho()},wo=e=>De.value.has(e),yo=async()=>{await he(),document.querySelectorAll(".markdown-body pre.hljs").forEach(e=>{if(e.querySelector(".code-block-copy-button"))return;const t=e.querySelector("code");if(!t)return;const o=document.createElement("div");o.className="code-block-wrapper",e.parentNode.insertBefore(o,e),o.appendChild(e);const l=t.textContent||"",f=l.trimEnd().split(`
`).length,h='<svg width="14" height="14" fill="currentColor" viewBox="0 0 16 16"><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/><path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/></svg>',m=w=>{const b=document.createElement("button");b.className=`code-block-copy-button ${w}`,b.innerHTML=h,b.title="Copy code",b.addEventListener("click",async u=>{u.stopPropagation();try{await navigator.clipboard.writeText(l.trimEnd()),r.success("Code copied to clipboard!")}catch(S){console.error("Failed to copy code:",S),r.error("Failed to copy code.")}}),o.appendChild(b)};m("code-block-copy-button-bottom"),f>3&&m("code-block-copy-button-top")})},Yt=e=>{if(e.target.tagName!=="IMG"||!e.target.closest(".markdown-wrapper"))return;const t=e.target;t&&t.src&&(k.value=[t.src],G.value=0,d.value=!0)},bo=e=>{if(e.ctrlKey){e.preventDefault();const t=.05;let o=e.deltaY<0?ue.value+t:ue.value-t;ue.value=Math.max(.5,Math.min(2,o)),p.value&&(p.value.zoom=ue.value)}},aa=()=>_a(),na=async()=>{try{const e=await window.api.getConfig();if(e&&e.config){p.value.providers=e.config.providers,p.value.providerOrder=e.config.providerOrder;const t=[],o={};if(p.value.providerOrder.forEach(l=>{const c=p.value.providers[l];c?.enable&&c.modelList.forEach(f=>{const h=`${l}|${f}`;t.push({key:h,value:h,label:`${c.name}|${f}`}),o[h]=`${c.name}|${f}`})}),Ue.value=t,Me.value=o,Ee.value&&p.value.providers[Ee.value]){const l=p.value.providers[Ee.value];et.value=l.url,tt.value=l.api_key}}}catch(e){console.warn("Ëá™Âä®Âà∑Êñ∞Ê®°ÂûãÂàóË°®Â§±Ë¥•ÔºåÂ∞Ü‰ΩøÁî®ÁºìÂ≠òÊï∞ÊçÆ",e)}ot.value=!0},la=e=>{J.value=e,Ee.value=e.split("|")[0];const t=p.value.providers[Ee.value];et.value=t.url,tt.value=t.api_key,I.value?.focus({cursor:"end"})},Xt=()=>{se.value=!se.value,se.value?window.addEventListener("blur",Mt):window.removeEventListener("blur",Mt)},sa=()=>{window.api.toggleAlwaysOnTop()},ia=()=>_o(),ra=e=>Ha(e),ca=(e,t)=>Na(e,t),ua=()=>To(),xo=()=>{v.value=pe.value,it.value=!0},da=async(e,t)=>{const o=Y.value?.$el,l=t.currentTarget,c=l.closest(".chat-message");if(!o||!l||!c)return;const f=o.scrollTop;if(wo(e)){const w=c.offsetTop-f;De.value.delete(e),await he();const b=c.offsetTop;o.style.scrollBehavior="auto",o.scrollTop=b-w,o.style.scrollBehavior="smooth"}else{const m=l.getBoundingClientRect().top;De.value.add(e),await he();const w=l.getBoundingClientRect().top;o.style.scrollBehavior="auto",o.scrollTop=f+(w-m),o.style.scrollBehavior="smooth"}},pa=async(e,t)=>{const o=Y.value?.$el,l=t.currentTarget.closest(".chat-message");if(!o||!l)return;const c=o.scrollTop,h=l.offsetTop-c,m=T.value.map((u,S)=>u.role===e?S:-1).filter(u=>u!==-1);if(m.length===0)return;m.some(u=>!De.value.has(u))?m.forEach(u=>De.value.add(u)):m.forEach(u=>De.value.delete(u)),await he();const b=l.offsetTop;o.style.scrollBehavior="auto",o.scrollTop=b-h,o.style.scrollBehavior="smooth"},fa=()=>Lt(!1),va=()=>Fa(),ma=()=>Ua(),ga=e=>ze.value.splice(e,1),ha=async({fileList:e})=>{for(const t of e)await Qt(t,ze.value.length+1);I.value?.focus({cursor:"end"})},wa=()=>Pa(),ya=async e=>{ze.value=[],await Qt(e,0),await Lt(!1)},Co=()=>{const e=I.value?.senderRef?.$refs.textarea;e&&(L.value=e.selectionStart,U.value=e.selectionEnd)},ko=()=>{Ne.value&&(Ne.value=!1),setTimeout(()=>{if(it.value||document.activeElement&&document.activeElement.tagName.toLowerCase()==="textarea"&&document.activeElement.closest(".editing-wrapper")||document.activeElement&&document.activeElement.closest(".text-search-container"))return;const e=I.value?.senderRef?.$refs.textarea;e&&document.activeElement!==e&&(L.value!==null&&U.value!==null?I.value?.focus({position:{start:L.value,end:U.value}}):I.value?.focus({cursor:"end"}))},50)},ba=e=>{e&&(async()=>{try{const t=await fetch(e);if(!t.ok)throw new Error(`ÁΩëÁªúÈîôËØØ: ${t.statusText}`);const o=await t.blob();try{if(["image/png","image/jpeg"].includes(o.type)){const c=new ClipboardItem({[o.type]:o});await navigator.clipboard.write([c]),r.success("ÂõæÁâáÂ∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø (WebAPI)");return}}catch(c){console.warn("Web Clipboard API ÂÜôÂÖ•Â§±Ë¥•ÔºåÂ∞ùËØïÂõûÈÄÄÊñπÊ°à:",c)}const l=await new Promise((c,f)=>{const h=new FileReader;h.onloadend=()=>c(h.result),h.onerror=f,h.readAsDataURL(o)});await new Promise(c=>setTimeout(c,50)),await window.api.copyImage(l),r.success("ÂõæÁâáÂ∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø")}catch(t){console.error("Â§çÂà∂ÂõæÁâáÂ§±Ë¥•:",t),r.error(`Â§çÂà∂Â§±Ë¥•: ${t.message}`)}})()},xa=async e=>{if(e)try{const o=await(await fetch(e)).blob(),l=await o.arrayBuffer(),c=`image_${Date.now()}.${o.type.split("/")[1]||"png"}`;await window.api.saveFile({title:"‰øùÂ≠òÂõæÁâá",defaultPath:c,buttonLabel:"‰øùÂ≠ò",fileContent:new Uint8Array(l)}),r.success("ÂõæÁâá‰øùÂ≠òÊàêÂäüÔºÅ")}catch(t){!t.message.includes("User cancelled")&&!t.message.includes("Áî®Êà∑ÂèñÊ∂à")&&(console.error("‰∏ãËΩΩÂõæÁâáÂ§±Ë¥•:",t),r.error(`‰∏ãËΩΩÂ§±Ë¥•: ${t.message}`))}},So=(e,t)=>{if(e<0||e>=T.value.length)return;let o=-1,l=-1;for(let f=0;f<W.value.length;f++)if(W.value[f].role!=="tool"&&l++,l===e){o=f;break}const c=f=>{if(f){if(typeof f.content=="string"||f.content===null)f.content=t;else if(Array.isArray(f.content)){const h=f.content.find(m=>m.type==="text"&&!(m.text&&m.text.toLowerCase().startsWith("file name:")));h?h.text=t:f.content.push({type:"text",text:t})}}};T.value[e]&&c(T.value[e]),o!==-1&&W.value[o]?c(W.value[o]):console.error("ÈîôËØØÔºöÊó†Ê≥ïÂ∞Ü chat_show Á¥¢ÂºïÊò†Â∞ÑÂà∞ history Á¥¢Âºï„ÄÇ‰∏ãÊ¨°APIËØ∑Ê±ÇÂèØËÉΩ‰ºö‰ΩøÁî®ÊóßÊï∞ÊçÆ„ÄÇ")},Ca=async e=>{const t=Y.value?.$el,o=Ge(e),l=o?.$el;!t||!l||!o||(o.switchToEditMode(),await he(),requestAnimationFrame(()=>{requestAnimationFrame(()=>{l.scrollIntoView({behavior:"auto",block:"nearest"})})}))},ka=async({id:e,action:t,content:o})=>{if(t!=="save")return;const l=T.value.findIndex(c=>c.id===e);l!==-1&&(So(l,o),r.success("Ê∂àÊÅØÂ∑≤Êõ¥Êñ∞"),l===T.value.length-1&&T.value[l].role==="user"&&(await he(),await To()))},Sa=e=>{e.key==="Enter"&&(e.ctrlKey||e.metaKey)&&(e.preventDefault(),$o())},$o=async()=>{const e=v.value;pe.value=e;const t=W.value.findIndex(o=>o.role==="system");if(t!==-1)W.value[t].content=e,T.value[t]&&(T.value[t].content=e);else{const o={role:"system",content:e};W.value.unshift(o),T.value.unshift({...o,id:Le.value++})}try{if(!!p.value.prompts[z.value])await window.api.saveSetting(`prompts.${z.value}.prompt`,e),p.value.prompts[z.value].prompt=e,r.success("Âø´Êç∑Âä©ÊâãÊèêÁ§∫ËØçÂ∑≤Êõ¥Êñ∞");else{const l=await window.api.getConfig(),c=vt.value||Qe.config.prompts.AI,f={...c,icon:Be.value,prompt:e,enable:!0,model:J.value||c.model,enable:!0,stream:!0,isTemperature:!1,temperature:.7,ifTextNecessary:!1,isDirectSend_file:!0,isDirectSend_normal:!0,voice:"",isAlwaysOnTop:l.config.isAlwaysOnTop_global,autoCloseOnBlur:l.config.autoCloseOnBlur_global,window_width:540,window_height:700,position_x:0,position_y:0,reasoning_effort:"default",zoom:1};l.config.prompts[z.value]=f,await window.api.updateConfig(l),p.value=l.config,vt.value=f,r.success(`Â∑≤‰∏∫ÊÇ®ÂàõÂª∫Âπ∂‰øùÂ≠òÊñ∞ÁöÑÂø´Êç∑Âä©Êâã: "${z.value}"`)}}catch(o){console.error("‰øùÂ≠òÁ≥ªÁªüÊèêÁ§∫ËØçÂ§±Ë¥•:",o),r.error(`‰øùÂ≠òÂ§±Ë¥•: ${o.message}`)}it.value=!1},Mt=async()=>{if(!Ne.value){if(p.value?.webdav?.localChatPath&&ne.value)try{await Rt()}catch(e){console.error("ÂÖ≥Èó≠Êó∂Ëá™Âä®‰øùÂ≠òÂ§±Ë¥•:",e)}window.api.windowControl("close-window")}},$a=()=>{Ne.value=!0};xt(ue,e=>{window.api&&typeof window.api.setZoomFactor=="function"&&window.api.setZoomFactor(e)}),xt(T,async()=>{await yo()},{deep:!0,flush:"post"}),xt(()=>p.value?.isDarkMode,e=>{e?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark"),je&&je.setTheme(e?"dark":"light")},{immediate:!0}),ro(async()=>{if(Fe.value)return;Fe.value=!0,window.api&&window.api.onAlwaysOnTopChanged&&window.api.onAlwaysOnTopChanged(o=>{kt.value=o}),je=new Il({scope:".chat-main",theme:p.value?.isDarkMode?"dark":"light"}),window.addEventListener("wheel",bo,{passive:!1}),window.addEventListener("focus",ko),window.addEventListener("blur",Co);const e=Y.value?.$el;e&&(e.addEventListener("click",Yt),Oe=new MutationObserver(()=>{de.value&&(e.scrollTop=e.scrollHeight)}),Oe.observe(e,{childList:!0,subtree:!0,characterData:!0}));const t=async(o=null)=>{try{const b=await window.api.getConfig();p.value=b.config}catch{p.value=Qe.config,r.error("Âä†ËΩΩÁî®Êà∑ÈÖçÁΩÆÂ§±Ë¥•Ôºå‰ΩøÁî®ÈªòËÆ§ÈÖçÁΩÆ„ÄÇ")}try{const b=await window.api.getUser();ke.value=b.avatar}catch{ke.value="user.png"}o?.os&&(St.value=o.os),Ue.value=[],Me.value={},p.value.providerOrder.forEach(b=>{const u=p.value.providers[b];u?.enable&&u.modelList.forEach(S=>{const V=`${b}|${S}`;Ue.value.push({key:V,value:V,label:`${u.name}|${S}`}),Me.value[V]=`${u.name}|${S}`})});const l=o?.code||"AI",c=p.value.prompts[l]||Qe.config.prompts.AI;c.backgroundImage&&zt(c.backgroundImage),kt.value=o?.isAlwaysOnTop??c.isAlwaysOnTop??!0,ue.value=c.zoom||p.value.zoom||1,window.api&&typeof window.api.setZoomFactor=="function"&&window.api.setZoomFactor(ue.value),p.value.isDarkMode&&document.documentElement.classList.add("dark"),z.value=l,document.title=l,vt.value=c,c.icon?(Be.value=c.icon,we.value=c.icon):(Be.value="ai.svg",we.value=p.value.isDarkMode?"favicon-b.png":"favicon.png"),se.value=c.autoCloseOnBlur??!1,Je.value=c.reasoning_effort||"default",J.value=c.model||Ue.value[0]?.value||"",Se.value=c.voice||null,J.value&&(Ee.value=J.value.split("|")[0],et.value=p.value.providers[Ee.value]?.url,tt.value=p.value.providers[Ee.value]?.api_key),c.prompt?(pe.value=c.prompt,W.value=[{role:"system",content:c.prompt}],T.value=[{role:"system",content:c.prompt,id:Le.value++}]):(pe.value="",W.value=[],T.value=[]);let f=!1,h=!1;if(o){if(Ze.value={code:o.code,type:o.type,payload:o.payload},o.filename&&(ne.value=o.filename.replace(/\.json$/i,"")),o.type==="over"&&o.payload){let b=!1;try{let u=JSON.parse(o.payload);u&&u.anywhere_history===!0&&(b=!0,await Mo(u),se.value=!1)}catch{}b||z.value.trim().toLowerCase().includes(o.payload.trim().toLowerCase())||(c.isDirectSend_normal?(W.value.push({role:"user",content:o.payload}),T.value.push({id:Le.value++,role:"user",content:[{type:"text",text:o.payload}]}),f=!0):dt.value=o.payload)}else if(o.type==="img"&&o.payload)c.isDirectSend_normal?(W.value.push({role:"user",content:[{type:"image_url",image_url:{url:String(o.payload)}}]}),T.value.push({id:Le.value++,role:"user",content:[{type:"image_url",image_url:{url:String(o.payload)}}]}),f=!0):ze.value.push({uid:1,name:"Êà™Âõæ.png",size:0,type:"image/png",url:String(o.payload)});else if(o.type==="files"&&o.payload)try{let b=!1;if(o.payload.length===1&&o.payload[0].path.toLowerCase().endsWith(".json")){const u=await window.api.handleFilePath(o.payload[0].path);u&&(b=await Lo(u))}if(!b){const u=o.payload.map(S=>Ia(S.path));await Promise.all(u),c.isDirectSend_file&&(f=!0,h=!0)}}catch(b){console.error("Error during initial file processing:",b),r.error("Êñá‰ª∂Â§ÑÁêÜÂ§±Ë¥•: "+b.message)}}se.value&&window.addEventListener("blur",Mt);let w=[...c.defaultMcpServers||[]];if(Ye.value.length>0&&p.value.mcpServers){const b=Object.entries(p.value.mcpServers).filter(([,u])=>u.type==="builtin").map(([u])=>u);w=[...new Set([...w,...b])]}if(w.length>0){const b=w.filter(u=>p.value.mcpServers&&p.value.mcpServers[u]);be.value=[...b],j.value=[...b],await yt(!1)}f&&(_t(),h?await Lt(!1):await Lt(!0)),await yo(),setTimeout(()=>{I.value?.focus({cursor:"end"})},100)};if(window.preload&&typeof window.preload.receiveMsg=="function")window.preload.receiveMsg(async o=>{await t(o)});else{const o={os:"win",code:"Moss",config:await window.api.getConfig().config};await t(o)}qe&&clearInterval(qe),qe=setInterval(Rt,15e3),window.addEventListener("error",Io,!0),window.addEventListener("keydown",Bo),window.api&&window.api.onConfigUpdated&&window.api.onConfigUpdated(o=>{o&&(p.value=o,o.zoom!==void 0&&(ue.value=o.zoom))})});const Rt=async()=>{if(ye.value||!p.value?.webdav?.localChatPath)return;const t=p.value?.prompts?.[z.value]?.autoSaveChat??!0;if(!(!ne.value&&!t)){if(!ne.value&&T.value.length>0){const o=T.value.find(l=>l.role==="user");if(o){let l="";const c=o.content;if(Array.isArray(c)){const f=c.some(w=>w.type==="image_url"),h=c.some(w=>w.type==="file"),m=c.find(w=>w.type==="text");f?l="ÂõæÁâá":h?l="Êñá‰ª∂":m?.text&&(l=m.text.slice(0,20).replace(/[\\/:*?"<>|\n\r]/g,"").trim())}else typeof c=="string"&&(l=c.slice(0,20).replace(/[\\/:*?"<>|\n\r]/g,"").trim());if(l){const f=z.value.replace(/[\\/:*?"<>|]/g,"_"),h=new Date,m=`${h.getFullYear()}${String(h.getMonth()+1).padStart(2,"0")}${String(h.getDate()).padStart(2,"0")}-${String(h.getHours()).padStart(2,"0")}${String(h.getMinutes()).padStart(2,"0")}${String(h.getSeconds()).padStart(2,"0")}`;ne.value=`${l}-${f}-${m}`}}}if(ne.value)try{const o=Gt(),l=JSON.stringify(o,null,2),c=`${p.value.webdav.localChatPath}/${ne.value}.json`;await window.api.writeLocalFile(c,l)}catch(o){console.error("Auto-save failed:",o)}}};co(async()=>{window.removeEventListener("wheel",bo),window.removeEventListener("focus",ko),window.removeEventListener("blur",Co),je&&je.destroy(),se.value||window.removeEventListener("blur",Mt);const e=Y.value?.$el;e&&e.removeEventListener("click",Yt),await window.api.closeMcpClient(),window.removeEventListener("error",Io,!0),window.removeEventListener("keydown",Bo),Oe&&(Oe.disconnect(),Oe=null)});const _a=async()=>{if(!z.value||!p.value.prompts[z.value]){r.warning("Êó†Ê≥ï‰øùÂ≠òÁ™óÂè£ËÆæÁΩÆÔºåÂõ†‰∏∫ÂΩìÂâç‰∏çÊòØ‰∏Ä‰∏™Â∑≤ÂÆö‰πâÁöÑÂø´Êç∑Âä©Êâã„ÄÇ");return}if(window.fullScreen){r.warning("Êó†Ê≥ïÂú®ÂÖ®Â±èÊ®°Âºè‰∏ã‰øùÂ≠òÁ™óÂè£‰ΩçÁΩÆÂíåÂ§ßÂ∞è„ÄÇ");return}const e={window_height:window.outerHeight,window_width:window.outerWidth,zoom:ue.value,position_x:window.screenX,position_y:window.screenY};try{const t=await window.api.savePromptWindowSettings(z.value,e);t.success?(r.success("ÂΩìÂâçÂø´Êç∑Âä©ÊâãÁöÑÁ™óÂè£Â§ßÂ∞è„ÄÅ‰ΩçÁΩÆ‰∏éÁº©ÊîæÂ∑≤‰øùÂ≠ò"),p.value.prompts[z.value]&&Object.assign(p.value.prompts[z.value],e)):r.error(`‰øùÂ≠òÂ§±Ë¥•: ${t.message}`)}catch(t){console.error("Error saving window settings:",t),r.error("‰øùÂ≠òÁ™óÂè£ËÆæÁΩÆÊó∂Âá∫Èîô")}},Gt=()=>{const e=p.value.prompts[z.value]||{};return{anywhere_history:!0,CODE:z.value,basic_msg:Ze.value,isInit:Fe.value,autoCloseOnBlur:se.value,model:J.value,currentPromptConfig:e,history:W.value,chat_show:T.value,selectedVoice:Se.value,activeMcpServerIds:be.value||[],activeSkillIds:Ye.value||[],isAutoApproveTools:fe.value}},Ma=async()=>{const e=new Date,t=String(e.getFullYear()).slice(-2),o=String(e.getMonth()+1).padStart(2,"0"),l=String(e.getDate()).toString().padStart(2,"0"),c=String(e.getHours()).toString().padStart(2,"0"),f=String(e.getMinutes()).toString().padStart(2,"0"),h=ne.value||`${z.value||"AI"}-${t}${o}${l}-${c}${f}`,m=g(h);try{await ct({title:"‰øùÂ≠òÂà∞‰∫ëÁ´Ø",message:()=>re("div",null,[re("p",{style:"margin-bottom: 15px; font-size: 14px; color: var(--el-text-color-regular);"},"ËØ∑ËæìÂÖ•Ë¶Å‰øùÂ≠òÂà∞‰∫ëÁ´ØÁöÑ‰ºöËØùÂêçÁß∞„ÄÇ"),re(nt,{modelValue:m.value,"onUpdate:modelValue":w=>{m.value=w},placeholder:"Êñá‰ª∂Âêç",ref:w=>{w&&setTimeout(()=>w.focus(),100)},onKeydown:w=>{w.key==="Enter"&&(w.preventDefault(),document.querySelector(".filename-prompt-dialog .el-message-box__btns .el-button--primary")?.click())}},{append:()=>re("div",{class:"input-suffix-display"},".json")})]),showCancelButton:!0,confirmButtonText:"Á°ÆËÆ§",cancelButtonText:"ÂèñÊ∂à",customClass:"filename-prompt-dialog",beforeClose:async(w,b,u)=>{if(w==="confirm"){let S=m.value.trim();if(!S){r.error("Êñá‰ª∂Âêç‰∏çËÉΩ‰∏∫Á©∫");return}S.toLowerCase().endsWith(".json")&&(S=S.slice(0,-5));const V=S+".json";b.confirmButtonLoading=!0,r.info("Ê≠£Âú®‰øùÂ≠òÂà∞‰∫ëÁ´Ø...");try{const y=Gt(),Z=JSON.stringify(y,null,2),{url:x,username:O,password:A,data_path:ee}=p.value.webdav,oe=Ro(x,{username:O,password:A}),ie=ee.endsWith("/")?ee.slice(0,-1):ee,me=`${ie}/${V}`;await oe.exists(ie)||await oe.createDirectory(ie,{recursive:!0}),await oe.putFileContents(me,Z,{overwrite:!0}),ne.value=S,r.success("‰ºöËØùÂ∑≤ÊàêÂäü‰øùÂ≠òÂà∞‰∫ëÁ´ØÔºÅ"),u()}catch(y){console.error("WebDAV save failed:",y),r.error(`‰øùÂ≠òÂà∞‰∫ëÁ´ØÂ§±Ë¥•: ${y.message}`)}finally{b.confirmButtonLoading=!1}}else u()}})}catch(w){w!=="cancel"&&w!=="close"&&console.error("MessageBox error:",w)}},La=async()=>{let e="";const t=new Date,o=`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")} ${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}`,l=`${String(t.getFullYear()).slice(-2)}${String(t.getMonth()+1).padStart(2,"0")}${String(t.getDate()).padStart(2,"0")}-${String(t.getHours()).padStart(2,"0")}${String(t.getMinutes()).padStart(2,"0")}`,c=ne.value||`${z.value||"AI"}-${l}`,f=u=>Array.isArray(u)?u.map(S=>S.type==="text"?S.text.trim():"").join(" "):String(u).trim(),h=u=>Array.isArray(u)?u.filter(S=>S.type!=="text").map(S=>S.type==="file"?S.file.filename:"Image"):[],m=u=>u?u.split(`
`).map(S=>`> ${S}`).join(`
`):"",w=(u,S=50)=>{if(!u)return"";const V=String(u);return V.length>S?V.substring(0,S)+"...":V};e+=`# ËÅäÂ§©ËÆ∞ÂΩï: ${z.value} (${o})

### ÂΩìÂâçÊ®°Âûã: ${Me.value[J.value]||"N/A"}

`,pe.value&&pe.value.trim()&&(e+=`### Á≥ªÁªüÊèêÁ§∫ËØç

${m(pe.value.trim())}

`),e+=`---

`;for(const u of T.value)if(u.role!=="system"){if(u.role==="user"){let S="### üë§ Áî®Êà∑";u.timestamp&&(S+=` - *${Nt(u.timestamp)}*`),e+=`${S}

`;const V=f(u.content),y=h(u.content);V&&(e+=`${m(V)}

`),y.length>0&&(e+=`> **ÈôÑ‰ª∂ÂàóË°®:**
`,y.forEach(Z=>{e+=`> - \`${Z}\`
`}),e+=`
`)}else if(u.role==="assistant"){let S=`### ü§ñ ${u.aiName||"AI"}`;u.voiceName&&(S+=` (${u.voiceName})`),u.completedTimestamp&&(S+=` - *${Nt(u.completedTimestamp)}*`),e+=`${S}

`,u.reasoning_content&&(e+=`> *ÊÄùËÄÉËøáÁ®ã:*
${m(u.reasoning_content)}

`),u.tool_calls&&u.tool_calls.length>0&&(e+=`> **Â∑•ÂÖ∑Ë∞ÉÁî®:**
`,u.tool_calls.forEach(y=>{e+=`> - üõ†Ô∏è \`${y.name}\`: ${w(y.result)}
`}),e+=`
`);const V=f(u.content);V?e+=`${m(V)}

`:u.status&&(e+=`> *(AIÊ≠£Âú®ÊÄùËÄÉ...)*

`)}e+=`---

`}const b=g(c);try{await ct({title:"‰øùÂ≠ò‰∏∫ Markdown",message:()=>re("div",null,[re("p",{style:"margin-bottom: 15px; font-size: 14px; color: var(--el-text-color-regular);"},"ËØ∑ËæìÂÖ•‰ºöËØùÂêçÁß∞„ÄÇ"),re(nt,{modelValue:b.value,"onUpdate:modelValue":u=>{b.value=u},placeholder:"Êñá‰ª∂Âêç",ref:u=>{u&&setTimeout(()=>u.focus(),100)},onKeydown:u=>{u.key==="Enter"&&(u.preventDefault(),document.querySelector(".filename-prompt-dialog .el-message-box__btns .el-button--primary")?.click())}},{append:()=>re("div",{class:"input-suffix-display"},".md")})]),showCancelButton:!0,confirmButtonText:"‰øùÂ≠ò",cancelButtonText:"ÂèñÊ∂à",customClass:"filename-prompt-dialog",beforeClose:async(u,S,V)=>{if(u==="confirm"){let y=b.value.trim();if(!y){r.error("Êñá‰ª∂Âêç‰∏çËÉΩ‰∏∫Á©∫");return}y.toLowerCase().endsWith(".md")&&(y=y.slice(0,-3));const Z=y+".md";S.confirmButtonLoading=!0;try{await window.api.saveFile({title:"‰øùÂ≠ò‰∏∫ Markdown",defaultPath:Z,buttonLabel:"‰øùÂ≠ò",filters:[{name:"Markdown Êñá‰ª∂",extensions:["md"]},{name:"ÊâÄÊúâÊñá‰ª∂",extensions:["*"]}],fileContent:e}),ne.value=y,r.success("‰ºöËØùÂ∑≤ÊàêÂäü‰øùÂ≠ò‰∏∫ MarkdownÔºÅ"),V()}catch(x){x.message.includes("canceled by the user")||(console.error("‰øùÂ≠ò Markdown Â§±Ë¥•:",x),r.error(`‰øùÂ≠òÂ§±Ë¥•: ${x.message}`)),V()}finally{S.confirmButtonLoading=!1}}else V()}})}catch(u){u!=="cancel"&&u!=="close"&&console.error("MessageBox error:",u)}},Ta=async()=>{const e=new Date,t=`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")} ${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`,o=`${String(e.getFullYear()).slice(-2)}${String(e.getMonth()+1).padStart(2,"0")}${String(e.getDate()).padStart(2,"0")}-${String(e.getHours()).padStart(2,"0")}${String(e.getMinutes()).padStart(2,"0")}`,l=ne.value||`${z.value||"AI"}-${o}`,c=g(l),f='<svg width="200" height="200" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><circle cx="50" cy="50" r="50" fill="#FDA5A5" /><g stroke="white" stroke-width="3.5" stroke-linecap="round" stroke-linejoin="round" fill="none"><rect x="25" y="32" width="50" height="42" rx="8" /><line x1="40" y1="63" x2="60" y2="63" /><line x1="35" y1="32" x2="32" y2="22" /><line x1="65" y1="32" x2="68" y2="22" /></g><g fill="white" stroke="none"><circle cx="40" cy="48" r="3.5" /><circle cx="60" cy="48" r="3.5" /><circle cx="32" cy="20" r="3" /><circle cx="68" cy="20" r="3" /></g></svg>',h=()=>{let m="",w="";const b=(y,Z=50)=>{if(!y)return"";const x=String(y);return x.length>Z?x.substring(0,Z)+"...":x},u=y=>{if(!y)return"";if(typeof y=="string")return y;if(!Array.isArray(y))return String(y);let Z="";return y.forEach(x=>{x.type==="text"&&x.text&&!(x.text.toLowerCase().startsWith("file name:")&&x.text.toLowerCase().endsWith("file end"))&&(Z+=x.text)}),Z.trim()},S=y=>{if(!y)return"";let Z="";return typeof y=="string"?Z=y:Array.isArray(y)?Z=y.map(x=>x.type==="text"?x.text||"":x.type==="image_url"&&x.image_url?.url?`![Image](${x.image_url.url})`:x.type==="input_audio"&&x.input_audio?.data?`<audio controls src="data:audio/${x.input_audio.format};base64,${x.input_audio.data}"></audio>`:x.type==="file"&&x.file?.filename?`*üìé ÈôÑ‰ª∂: ${x.file.filename}*`:"").join(" "):Z=String(y),Fo.parse(Z)};if(pe.value&&pe.value.trim()){const y="Á≥ªÁªüÊèêÁ§∫ËØç",Z="system-dot",x="msg-system";w+=`
        <li class="timeline-item">
            <a href="#${x}" class="timeline-dot ${Z}" aria-label="${y}">
                <span class="timeline-tooltip">${y}</span>
            </a>
        </li>`,m+=`
            <div id="${x}" class="message-wrapper align-left">
              <div class="header system-header"><strong>Á≥ªÁªüÊèêÁ§∫ËØç</strong></div>
              <div class="message-body system-body">${Oo.sanitize(Fo.parse(pe.value))}</div>
            </div>
          `}return T.value.forEach((y,Z)=>{if(y.role==="system")return;const x=y.role==="user",O=`msg-${Z}`;let A="";x?A=b(u(y.content),30)||"Áî®Êà∑ÂèëÈÄÅÂõæÁâá/Êñá‰ª∂":A=b(u(y.content),30)||"AI ÂõûÂ§ç",w+=`
        <li class="timeline-item">
            <a href="#${O}" class="timeline-dot ${x?"user-dot":"ai-dot"}" aria-label="${A}">
                <span class="timeline-tooltip">${A}</span>
            </a>
        </li>`;let oe=x?ke.value:Be.value;x||(oe==="ai.svg"||!oe.startsWith("http")&&!oe.startsWith("data:"))&&(oe=`data:image/svg+xml;base64,${btoa(f)}`);let ie=x?"Áî®Êà∑":y.aiName||"AI",me=y.timestamp||y.completedTimestamp,ge=x?"align-right":"align-left";const te=S(y.content);let We="";te&&te.trim()!==""&&(We=Oo.sanitize(te,{ADD_TAGS:["video","audio","source","blockquote"],USE_PROFILES:{html:!0,svg:!0},ADD_ATTR:["style"]}));let Te="";if(y.tool_calls&&y.tool_calls.length>0&&(Te='<div class="tool-calls-wrapper">',y.tool_calls.forEach($e=>{const Tt=b($e.result,100).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");Te+=`
                <div class="tool-call-box">
                    <span class="tool-icon">üõ†Ô∏è</span>
                    <span class="tool-name">${$e.name}</span>
                    <span class="tool-result">${Tt}</span>
                </div>`}),Te+="</div>"),We||Te){let $e="";x?$e=`
               <div class="header user-header">
                 <span class="timestamp">${me?Nt(me):""}</span>
                 <img src="${oe}" class="avatar" alt="avatar">
               </div>`:$e=`
               <div class="header ai-header">
                 <img src="${oe}" class="avatar" alt="avatar">
                 <div class="ai-meta">
                    <div class="ai-name-row">
                        <strong>${ie}</strong>
                        ${y.voiceName?`<span class="voice-tag">(${y.voiceName})</span>`:""}
                    </div>
                    <span class="timestamp">${me?Nt(me):""}</span>
                 </div>
               </div>`;const eo=We?`<div class="message-body ${x?"user-body":"ai-body"}">${We}</div>`:"";m+=`
            <div id="${O}" class="message-wrapper ${ge}">
              ${$e}
              ${Te}
              ${eo}
            </div>
          `}}),`
      <!DOCTYPE html>
      <html lang="zh-CN">
      <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ËÅäÂ§©ËÆ∞ÂΩï: ${z.value} (${t})</title>
        
      <style>
        :root { 
            --bg-color: #f7f7f7; 
            --text-color: #333; 
            --card-bg: #fff; 
            --user-bg: #e1f5fe; 
            --ai-bg: #fff; 
            --border-color: #eee; 
            --accent-color: #1F2937; 
            --timeline-line: #e0e0e0;
            --timeline-dot-default: #bdbdbd;
            --timeline-dot-active: #1F2937;
        }
        @media (prefers-color-scheme: dark) {
          :root { 
              --bg-color: #1a1a1a; 
              --text-color: #e0e0e0; 
              --card-bg: #2a2a2a; 
              --user-bg: #0d47a1; 
              --ai-bg: #3a3a3a; 
              --border-color: #444; 
              --accent-color: #64b5f6; 
              --timeline-line: #444;
              --timeline-dot-default: #666;
              --timeline-dot-active: #64b5f6;
          }
        }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; margin: 0; padding: 20px; background-color: var(--bg-color); color: var(--text-color); line-height: 1.6; }
        .main-container { max-width: 900px; margin: 0 auto; background-color: var(--card-bg); border-radius: 12px; padding: 40px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); position: relative; }
        .page-header { margin-bottom: 40px; border-bottom: 1px solid var(--border-color); padding-bottom: 20px; }
        .page-header h1 { margin: 0 0 10px 0; font-size: 24px; }
        .page-header p { margin: 0; color: #888; font-size: 13px; }
        .timeline-toc {
            position: fixed;
            top: 50%;
            right: 20px;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            z-index: 100;
            max-height: 80vh;
            overflow-y: auto;
            scrollbar-width: none; 
            padding: 10px;
        }
        .timeline-toc::-webkit-scrollbar { display: none; }
        .timeline-list {
            list-style: none;
            padding: 0;
            margin: 0;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px; 
        }
        .timeline-list::before {
            content: '';
            position: absolute;
            top: 0;
            bottom: 0;
            left: 50%;
            width: 2px;
            background-color: var(--timeline-line);
            transform: translateX(-50%);
            z-index: -1;
            border-radius: 2px;
        }
        .timeline-item { position: relative; }
        .timeline-dot {
            display: block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: var(--card-bg);
            border: 2px solid var(--timeline-dot-default);
            transition: all 0.2s ease;
            position: relative;
        }
        .timeline-dot.user-dot {
            background-color: var(--timeline-dot-active);
            border-color: var(--timeline-dot-active);
            width: 12px; 
            height: 12px;
        }
        .timeline-dot.ai-dot {
            border-color: var(--timeline-dot-default);
        }
        .timeline-dot.system-dot {
            border-color: #795548;
            background-color: #795548;
        }
        .timeline-dot:hover {
            transform: scale(1.4);
            border-color: var(--accent-color);
            background-color: var(--accent-color);
        }
        .timeline-tooltip {
            position: absolute;
            right: 25px;
            top: 50%;
            transform: translateY(-50%);
            background-color: var(--accent-color);
            color: #fff;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s, transform 0.2s;
            max-width: 200px;
            overflow: hidden;
            text-overflow: ellipsis;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }
        .timeline-dot:hover .timeline-tooltip {
            opacity: 1;
            transform: translateY(-50%) translateX(-5px);
        }
        .message-wrapper { display: flex; flex-direction: column; margin-bottom: 30px; scroll-margin-top: 60px; max-width: 100%; }
        .align-right { align-items: flex-end; }
        .align-left { align-items: flex-start; }
        .header { display: flex; align-items: center; gap: 10px; margin-bottom: 6px; font-size: 12px; color: #888; }
        .user-header { flex-direction: row; }
        .ai-header { flex-direction: row; align-items: flex-start; }
        .avatar { width: 32px; height: 32px; border-radius: 6px; object-fit: cover; background-color: #eee; flex-shrink: 0; }
        .ai-meta { display: flex; flex-direction: column; line-height: 1.3; }
        .ai-name-row { display: flex; align-items: center; gap: 5px; }
        .voice-tag { opacity: 0.8; font-size: 11px; }
        .message-body { padding: 12px 16px; border-radius: 12px; word-break: break-word; overflow-wrap: break-word; max-width: 100%; }
        .user-body { background-color: var(--user-bg); border-bottom-right-radius: 2px; color: var(--text-color); max-width: 90%; }
        .ai-body { background-color: var(--ai-bg); border: 1px solid var(--border-color); border-top-left-radius: 2px; width: 100%; box-sizing: border-box; }
        .system-body { background-color: #fff3e0; color: #5d4037; border: 1px dashed #d7ccc8; width: 100%; text-align: center; }
        .tool-calls-wrapper { width: 100%; margin-bottom: 8px; display: flex; flex-direction: column; gap: 4px; }
        .tool-call-box { background-color: var(--bg-color); border: 1px solid var(--border-color); border-radius: 6px; padding: 6px 10px; font-size: 12px; color: #666; display: flex; align-items: center; gap: 8px; }
        .tool-name { font-weight: bold; }
        .tool-result { opacity: 0.7; font-family: monospace; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        img { max-width: 100%; border-radius: 8px; margin: 5px 0; }
        pre { background-color: #2d2d2d; color: #f8f8f2; padding: 1em; border-radius: 8px; overflow-x: auto; font-family: monospace; }
        blockquote { border-left: 4px solid #ccc; padding-left: 1em; margin: 1em 0; color: #666; background: rgba(0,0,0,0.03); }
        @media (max-width: 768px) {
          .timeline-toc { display: none; }
          .main-container { padding: 20px; width: 100%; box-sizing: border-box; border-radius: 0; box-shadow: none; background-color: transparent; }
          .message-body { max-width: 100%; }
          .user-body { max-width: 95%; }
          body { padding: 0; }
        }
      </style>
    
      </head>
      <body>
        <nav class="timeline-toc">
            <ul class="timeline-list">
                ${w}
            </ul>
        </nav>
        <div class="main-container">
            <header class="page-header">
                <h1>${z.value}</h1>
                <p>Ê®°Âûã: ${Me.value[J.value]||"N/A"} &bull; ÂØºÂá∫Êó∂Èó¥: ${t}</p>
            </header>
            <div class="chat-container">
                ${m}
            </div>
        </div>
      </body>
      </html>
    `};try{await ct({title:"‰øùÂ≠ò‰∏∫ HTML",message:()=>re("div",null,[re("p",{style:"margin-bottom: 15px; font-size: 14px; color: var(--el-text-color-regular);"},"ËØ∑ËæìÂÖ•‰ºöËØùÂêçÁß∞„ÄÇ"),re(nt,{modelValue:c.value,"onUpdate:modelValue":m=>{c.value=m},placeholder:"Êñá‰ª∂Âêç",ref:m=>{m&&setTimeout(()=>m.focus(),100)},onKeydown:m=>{m.key==="Enter"&&(m.preventDefault(),document.querySelector(".filename-prompt-dialog .el-message-box__btns .el-button--primary")?.click())}},{append:()=>re("div",{class:"input-suffix-display"},".html")})]),showCancelButton:!0,confirmButtonText:"‰øùÂ≠ò",cancelButtonText:"ÂèñÊ∂à",customClass:"filename-prompt-dialog",beforeClose:async(m,w,b)=>{if(m==="confirm"){let u=c.value.trim();if(!u){r.error("Êñá‰ª∂Âêç‰∏çËÉΩ‰∏∫Á©∫");return}u.toLowerCase().endsWith(".html")&&(u=u.slice(0,-5));const S=u+".html";w.confirmButtonLoading=!0;try{const V=h();await window.api.saveFile({title:"‰øùÂ≠ò‰∏∫ HTML",defaultPath:S,buttonLabel:"‰øùÂ≠ò",filters:[{name:"HTML Êñá‰ª∂",extensions:["html"]},{name:"ÊâÄÊúâÊñá‰ª∂",extensions:["*"]}],fileContent:V}),ne.value=u,r.success("‰ºöËØùÂ∑≤ÊàêÂäü‰øùÂ≠ò‰∏∫ HTMLÔºÅ"),b()}catch(V){!V.message.includes("User cancelled")&&!V.message.includes("Áî®Êà∑ÂèñÊ∂à")&&(console.error("‰øùÂ≠ò HTML Â§±Ë¥•:",V),r.error(`‰øùÂ≠òÂ§±Ë¥•: ${V.message}`)),b()}finally{w.confirmButtonLoading=!1}}else b()}})}catch(m){m!=="cancel"&&m!=="close"&&console.error("MessageBox error:",m)}},Ea=async()=>{const e=Gt(),t=JSON.stringify(e,null,2),o=new Date,l=`${String(o.getFullYear()).slice(-2)}${String(o.getMonth()+1).padStart(2,"0")}${String(o.getDate()).padStart(2,"0")}-${String(o.getHours()).padStart(2,"0")}${String(o.getMinutes()).padStart(2,"0")}${String(o.getSeconds()).padStart(2,"0")}`,c=ne.value||`${z.value||"AI"}-${l}`,f=g(c);try{await ct({title:"‰øùÂ≠ò‰∏∫ JSON",message:()=>re("div",null,[re("p",{style:"margin-bottom: 15px; font-size: 14px; color: var(--el-text-color-regular);"},"ËØ∑ËæìÂÖ•‰ºöËØùÂêçÁß∞„ÄÇ"),re(nt,{modelValue:f.value,"onUpdate:modelValue":h=>{f.value=h},placeholder:"Êñá‰ª∂Âêç",ref:h=>{h&&setTimeout(()=>h.focus(),100)},onKeydown:h=>{h.key==="Enter"&&(h.preventDefault(),document.querySelector(".filename-prompt-dialog .el-message-box__btns .el-button--primary")?.click())}},{append:()=>re("div",{class:"input-suffix-display"},".json")})]),showCancelButton:!0,confirmButtonText:"‰øùÂ≠ò",cancelButtonText:"ÂèñÊ∂à",customClass:"filename-prompt-dialog",beforeClose:async(h,m,w)=>{if(h==="confirm"){let b=f.value.trim();if(!b){r.error("Êñá‰ª∂Âêç‰∏çËÉΩ‰∏∫Á©∫");return}b.toLowerCase().endsWith(".json")&&(b=b.slice(0,-5));const u=b+".json";m.confirmButtonLoading=!0;try{let S=u;const V=p.value.webdav?.localChatPath;if(V){const y=Ze.value.os==="win"?"\\":"/";S=`${V}${y}${u}`}await window.api.saveFile({title:"‰øùÂ≠òËÅäÂ§©‰ºöËØù",defaultPath:S,buttonLabel:"‰øùÂ≠ò",filters:[{name:"JSON Êñá‰ª∂",extensions:["json"]},{name:"ÊâÄÊúâÊñá‰ª∂",extensions:["*"]}],fileContent:t}),ne.value=b,r.success("‰ºöËØùÂ∑≤ÊàêÂäü‰øùÂ≠òÔºÅ"),w()}catch(S){!S.message.includes("canceled by the user")&&!S.message.includes("Áî®Êà∑ÂèñÊ∂à")&&(console.error("‰øùÂ≠ò‰ºöËØùÂ§±Ë¥•:",S),r.error(`‰øùÂ≠òÂ§±Ë¥•: ${S.message}`)),w()}finally{m.confirmButtonLoading=!1}}else w()}})}catch(h){h!=="cancel"&&h!=="close"&&console.error("MessageBox error:",h)}},Aa=async()=>{se.value&&Xt();const e=p.value.webdav?.localChatPath;if(!e){r.error("ËØ∑ÂÖàÂú®ËÆæÁΩÆ‰∏≠ÈÖçÁΩÆÊú¨Âú∞ÂØπËØùË∑ØÂæÑ");return}if(!ne.value){r.warning("ÂΩìÂâçÂØπËØùÂ∞öÊú™‰øùÂ≠òÔºåÊó†Ê≥ïÈáçÂëΩÂêç");return}const t=ne.value,o=`${t}.json`,l=`${e}/${o}`;try{const{value:c}=await ct.prompt("ËØ∑ËæìÂÖ•Êñ∞ÁöÑ‰ºöËØùÂêçÁß∞","ÈáçÂëΩÂêçÂØπËØù",{inputValue:t,confirmButtonText:"Á°ÆËÆ§",cancelButtonText:"ÂèñÊ∂à",inputValidator:y=>!y||!y.trim()?"ÂêçÁß∞‰∏çËÉΩ‰∏∫Á©∫":/[\\/:*?"<>|]/.test(y)?"Êñá‰ª∂ÂêçÂåÖÂê´ÈùûÊ≥ïÂ≠óÁ¨¶":!0,customClass:"filename-prompt-dialog"});let f=(c||"").trim();if(f.toLowerCase().endsWith(".json")&&(f=f.slice(0,-5)),f===t)return;const h=`${f}.json`,m=`${e}/${h}`;if((await window.api.listJsonFiles(e)).some(y=>y.basename===h)){r.error(`Êñá‰ª∂Âêç "${h}" Â∑≤Â≠òÂú®ÔºåÊìç‰ΩúÂèñÊ∂à`);return}await window.api.renameLocalFile(l,m),ne.value=f,r.success("Êú¨Âú∞ÈáçÂëΩÂêçÊàêÂäü");const{url:b,username:u,password:S,data_path:V}=p.value.webdav||{};if(b&&V)try{const y=Ro(b,{username:u,password:S}),Z=V.endsWith("/")?V.slice(0,-1):V,x=`${Z}/${o}`,O=`${Z}/${h}`;await y.exists(x)&&(await ct.confirm("‰∫ëÁ´Ø‰πüÂ≠òÂú®ÂêåÂêçÊñá‰ª∂ÔºåÊòØÂê¶ÂêåÊ≠•ÈáçÂëΩÂêçÔºü","ÂêåÊ≠•Êìç‰ΩúÊèêÁ§∫",{confirmButtonText:"ÊòØ",cancelButtonText:"Âê¶",type:"info"}),await y.moveFile(x,O),r.success("‰∫ëÁ´ØÂêåÊ≠•ÈáçÂëΩÂêçÊàêÂäü"))}catch(y){y!=="cancel"&&y!=="close"&&console.warn("Cloud rename skipped:",y)}}catch(c){c!=="cancel"&&c!=="close"&&r.error(`Êìç‰ΩúÂ§±Ë¥•: ${c.message}`)}},_o=async()=>{se.value&&Xt();const e=p.value.webdav?.url&&p.value.webdav?.data_path,t=[];p.value.webdav?.localChatPath&&ne.value&&t.push({title:"ÈáçÂëΩÂêçÂØπËØù",description:"‰øÆÊîπÂΩìÂâçÂØπËØùÂêçÁß∞ÔºåÂπ∂ÂêåÊ≠•‰øÆÊîπÊú¨Âú∞Êñá‰ª∂Ôºà‰ª•Âèä‰∫ëÁ´ØÊñá‰ª∂Ôºâ„ÄÇ",buttonType:"warning",action:Aa}),e&&t.push({title:"‰øùÂ≠òÂà∞‰∫ëÁ´Ø",description:"ÂêåÊ≠•Âà∞ WebDAV ÊúçÂä°Âô®ÔºåÊîØÊåÅË∑®ËÆæÂ§áËÆøÈóÆ„ÄÇ",buttonType:"success",action:Ma}),t.push({title:"‰øùÂ≠ò‰∏∫ JSON",description:"‰øùÂ≠ò‰∏∫ÂèØÊÅ¢Â§çÁöÑ‰ºöË©±Êñá‰ª∂Ôºå‰æø‰∫é‰∏ãÊ¨°ÁªßÁª≠„ÄÇ",buttonType:"primary",action:Ea,isDefault:!0}),t.push({title:"‰øùÂ≠ò‰∏∫ Markdown",description:"ÂØºÂá∫‰∏∫ÂèØËØªÊÄßÊõ¥Âº∫ÁöÑ .md Êñá‰ª∂ÔºåÈÄÇÂêàÂàÜ‰∫´„ÄÇ",buttonType:"",action:La}),t.push({title:"‰øùÂ≠ò‰∏∫ HTML",description:"ÂØºÂá∫‰∏∫Â∏¶Ê†∑ÂºèÁöÑÁΩëÈ°µÊñá‰ª∂Ôºå‰øùÁïôÊ†ºÂºèÂíåÂõæÁâá„ÄÇ",buttonType:"",action:Ta});const o=re("div",{class:"save-options-list"},t.map(l=>{const c=()=>{ct.close(),l.action()};return re("div",{class:"save-option-item",onClick:c},[re("div",{class:"save-option-text"},[re("h4",null,l.title),re("p",null,l.description)]),re(R,{type:l.buttonType,plain:!0,class:l.isDefault?"default-save-target":"",onClick:f=>{f.stopPropagation(),c()}},{default:()=>"ÈÄâÊã©"})])}));ct({title:"",message:o,showConfirmButton:!1,showCancelButton:!1,customClass:"save-options-dialog no-header-msgbox",width:"450px",showClose:!1}).catch(()=>{}),setTimeout(()=>{const l=document.querySelector(".default-save-target");l&&l.focus()},100)},Mo=async e=>{ye.value=!0,De.value.clear(),P.clear(),N.value=null;try{z.value=e.CODE,document.title=z.value,Ze.value=e.basic_msg,Fe.value=e.isInit,se.value=e.autoCloseOnBlur,W.value=e.history,T.value=e.chat_show,Se.value=e.selectedVoice||"",Je.value=e.currentPromptConfig?.reasoning_effort||"default",fe.value=e.isAutoApproveTools||!0;const t=await window.api.getConfig();p.value=t.config,ue.value=p.value.zoom||1,window.api&&typeof window.api.setZoomFactor=="function"&&window.api.setZoomFactor(ue.value),p.value.isDarkMode?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark");const o=e.currentPromptConfig||p.value.prompts[z.value];o&&o.icon?(Be.value=o.icon,we.value=o.icon):(Be.value="ai.svg",we.value=p.value.isDarkMode?"favicon-b.png":"favicon.png"),Ue.value=[],Me.value={},p.value.providerOrder.forEach(m=>{const w=p.value.providers[m];w?.enable&&w.modelList.forEach(b=>{const u=`${m}|${b}`;Ue.value.push({key:u,value:u,label:`${w.name}|${b}`}),Me.value[u]=`${w.name}|${b}`})});let l="";if(e.model&&Me.value[e.model])l=e.model;else if(e.currentPromptConfig?.model&&Me.value[e.currentPromptConfig.model])l=e.currentPromptConfig.model;else{const m=p.value.prompts[z.value];l=m?.model&&Me.value[m.model]?m.model:Ue.value[0]?.value||""}if(J.value=l,T.value&&T.value.length>0){T.value.forEach(w=>{w.id===void 0&&(w.id=Le.value++)});const m=Math.max(...T.value.map(w=>w.id||0));Le.value=m+1}const c=W.value.findIndex(m=>m.role==="system");if(c!==-1?(pe.value=W.value[c].content,(!T.value[c]||T.value[c].role!=="system")&&T.value.unshift({role:"system",content:pe.value,id:Le.value++})):p.value.prompts[z.value]?.prompt?(pe.value=p.value.prompts[z.value].prompt,W.value.unshift({role:"system",content:pe.value}),T.value.unshift({role:"system",content:pe.value,id:Le.value++})):pe.value="",J.value){Ee.value=J.value.split("|")[0];const m=p.value.providers[Ee.value];et.value=m?.url,tt.value=m?.api_key}else{r.error("Ê≤°ÊúâÂèØÁî®ÁöÑÊ®°Âûã„ÄÇËØ∑Ê£ÄÊü•ÊÇ®ÁöÑÊúçÂä°ÂïÜÈÖçÁΩÆ„ÄÇ"),ye.value=!1;return}ye.value=!1,await he(),_t();let f=[];if(e.activeMcpServerIds&&Array.isArray(e.activeMcpServerIds)?f=e.activeMcpServerIds:f=e.currentPromptConfig?.defaultMcpServers||[],Ye.value.length>0&&p.value.mcpServers){const m=Object.entries(p.value.mcpServers).filter(([,w])=>w.type==="builtin").map(([w])=>w);f=[...new Set([...f,...m])]}const h=f.filter(m=>p.value.mcpServers&&p.value.mcpServers[m]);h.length>0?(be.value=[...h],j.value=[...h],yt(!1)):(be.value=[],j.value=[],yt(!1))}catch(t){console.error("Âä†ËΩΩ‰ºöËØùÂ§±Ë¥•:",t),r.error(`Âä†ËΩΩ‰ºöËØùÂ§±Ë¥•: ${t.message}`),ye.value=!1}},Lo=async e=>{if(e&&e.name.toLowerCase().endsWith(".json"))try{const t=await e.text(),o=JSON.parse(t);if(o&&o.anywhere_history===!0)return ne.value=e.name.replace(/\.json$/i,""),await Mo(o),!0}catch(t){console.warn("‰∏Ä‰∏™JSONÊñá‰ª∂Ë¢´Ê£ÄÊµãÂà∞Ôºå‰ΩÜÂÆÉ‰∏çÊòØ‰∏Ä‰∏™ÊúâÊïàÁöÑ‰ºöËØùÊñá‰ª∂:",t.message)}return!1},Qt=async(e,t)=>{if(await Lo(e)){I.value?.focus({cursor:"end"});return}return new Promise((l,c)=>{if(!window.api.isFileTypeSupported(e.name)){const h=`‰∏çÊîØÊåÅÁöÑÊñá‰ª∂Á±ªÂûã: ${e.name}`;r.warning(h),c(new Error(h));return}const f=new FileReader;f.onload=h=>{ze.value.push({uid:t,name:e.name,size:e.size,type:e.type,url:h.target.result}),l()},f.onerror=()=>{const h=`ËØªÂèñÊñá‰ª∂ ${e.name} Â§±Ë¥•`;r.error(h),c(new Error(h))},f.readAsDataURL(e)})},Ia=async e=>{if(!e||typeof e!="string"){r.error("Êó†ÊïàÁöÑÊñá‰ª∂Ë∑ØÂæÑ");return}try{const t=await window.api.handleFilePath(e);t?await Qt(t,ze.value.length+1):r.error("Êó†Ê≥ïËØªÂèñÊàñËÆøÈóÆËØ•Êñá‰ª∂ÔºåËØ∑Ê£ÄÊü•Ë∑ØÂæÑÂíåÊùÉÈôê")}catch(t){console.error("Ë∞ÉÁî® handleFilePath Êó∂ÂèëÁîüÊÑèÂ§ñÈîôËØØ:",t),r.error("Â§ÑÁêÜÊñá‰ª∂Ë∑ØÂæÑÊó∂ÂèëÁîüÊú™Áü•ÈîôËØØ")}},Ba=async()=>{let e=[];if(ze.value.length===0)return e;for(const t of ze.value)try{const o=await window.api.parseFileObject({name:t.name,url:t.url});o&&e.push(o)}catch(o){o.message.includes("‰∏çÊîØÊåÅÁöÑÊñá‰ª∂Á±ªÂûã")?r.warning(o.message):r.error(`Â§ÑÁêÜÊñá‰ª∂ ${t.name} Â§±Ë¥•: ${o.message}`)}return ze.value=[],e};async function yt(e=!0){gt.value=!1,Vt.value=!0,await he();const t={},o=[...be.value];for(const l of o)if(p.value.mcpServers[l]){const c=p.value.mcpServers[l];t[l]={transport:c.type,command:c.command,args:c.args,url:c.baseUrl,env:c.env,headers:c.headers,isPersistent:c.isPersistent}}try{const{openaiFormattedTools:l,successfulServerIds:c,failedServerIds:f}=await window.api.initializeMcpClient(t);if(Dt.value=l,be.value=c,f&&f.length>0){const h=f.map(m=>p.value.mcpServers[m]?.name||m).join("„ÄÅ");r.error({message:`‰ª•‰∏ã MCP ÊúçÂä°Âä†ËΩΩÂ§±Ë¥•ÔºåÂ∑≤Ëá™Âä®ÂèñÊ∂àÂãæÈÄâ: ${h}`,duration:5e3})}l.length>0?r.success(`Â∑≤ÊàêÂäüÂêØÁî® ${l.length} ‰∏™ MCP Â∑•ÂÖ∑`):o.length>0&&f.length===o.length?r.info("ÊâÄÊúâÈÄâ‰∏≠ÁöÑ MCP Â∑•ÂÖ∑ÂùáÂä†ËΩΩÂ§±Ë¥•"):o.length===0&&e&&r.info("Â∑≤Ê∏ÖÈô§ÊâÄÊúâ MCP Â∑•ÂÖ∑")}catch(l){console.error("Failed to initialize MCP tools:",l),r.error(`Âä†ËΩΩMCPÂ∑•ÂÖ∑Â§±Ë¥•: ${l.message}`),Dt.value=[],be.value=[]}finally{Vt.value=!1}}function za(){j.value=[]}function Da(){const e=vo.value.map(o=>o.id),t=new Set(j.value);e.forEach(o=>t.add(o)),j.value=Array.from(t)}async function Pa(){if(!gt.value){try{const e=await window.api.getConfig();if(e&&e.config&&e.config.mcpServers){const t=e.config.mcpServers,o=p.value.mcpServers||{};be.value.forEach(l=>{!t[l]&&o[l]&&(t[l]=o[l])}),p.value.mcpServers=t}pt.value=await window.api.getMcpToolCache()||{}}catch(e){console.error("Auto refresh MCP config failed:",e)}j.value=[...be.value]}gt.value=!gt.value}async function Va(e,t){if(!p.value.mcpServers[e])return;const o=`mcpServers.${e}.isPersistent`;try{const l=await window.api.saveSetting(o,t);if(l&&l.success)p.value.mcpServers[e].isPersistent=t,r.success(`'${p.value.mcpServers[e].name}' ÁöÑÊåÅ‰πÖÂåñËÆæÁΩÆÂ∑≤Êõ¥Êñ∞`);else throw new Error(l?.message||"‰øùÂ≠òËÆæÁΩÆÂà∞Êï∞ÊçÆÂ∫ìÂ§±Ë¥•")}catch(l){console.error("Failed to save MCP persistence setting:",l),r.error("‰øùÂ≠òÊåÅ‰πÖÂåñËÆæÁΩÆÂ§±Ë¥•")}}const Ra=()=>{const e=new Date,t=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],o=e.getFullYear(),l=String(e.getMonth()+1).padStart(2,"0"),c=String(e.getDate()).padStart(2,"0");String(e.getHours()).padStart(2,"0"),String(e.getMinutes()).padStart(2,"0");const f=t[e.getDay()];return`${o}-${l}-${c} (${f})`},Oa=()=>`
## SYSTEM CONTEXT
Current Time: **${Ra()}**
PlatformÔºö**${St.value}**

Always use this timestamp as your reference for "today", "now", "current", or relative dates (e.g., "yesterday", "next week").

## Tool Use Rules
Here are the rules you should always follow to solve your task:
1. Always use the right arguments for the tools. Never use variable names as the action arguments, use the value instead.
2. Call a tool only when needed. If no tool call is needed, just answer the question directly.
3. Never re-do a tool call that you previously did with the exact same parameters.
4. **Synthesis**: Must always synthesize the tool output into valuable, easily understandable information from the user's perspective.
5.  **Strict Multimedia Formatting Norms**: In all circumstances, the display format for multimedia content (images, videos, audio) must comply with the following specifications, and **must not** be contained within code blocks (\`\`\`):
    *   **Image (Markdown)**: \`![Content Description](Image Link)\`
    *   **Video (HTML)**:
        \`\`\`html
        <video controls="" style="max-width: 80%; max-height: 400px; height: auto; width: auto; display: block;"><source src="Video Link URL" type="video/mp4">Your browser does not support video playback.</video>
        \`\`\`
    *   **Audio (HTML)**:
        \`\`\`html
        <audio class="chat-audio-player" controls="" preload="none">
          <source id="Audio Format" src="Audio Link URL">
        </audio>
        \`\`\`
6. **Language**: All Respond must be in the user's language
7. **Security & Safety**: Tools must be executed securely, and the invocation of any commands that could lead to system damage, data loss, or sensitive privacy disclosure is strictly prohibited.
    1.  **Comprehensive Risk Assessment**: Identify whether the operation involves sensitive data or irreversible data modification.
    2.  **Mandatory Warning Prompts**: For any risky operation, clear and detailed warnings must be issued to the user before execution, explaining potential consequences (e.g., exposure of sensitive information, data loss).
    3.  **Seek Explicit Confirmation**: Before executing irreversible or high-risk operations (e.g., deleting files, reading sensitive files), explicit secondary confirmation from the user must be required.
`,Lt=async(e=!1)=>{if(ye.value)return;if(Vt.value){r.info("Ê≠£Âú®Âä†ËΩΩÂ∑•ÂÖ∑ÔºåËØ∑Á®çÂêéÂÜçËØï...");return}if(!e){let h=await Ba();const m=dt.value.trim();if(h&&h.length>0||m){const w=[];m&&w.push({type:"text",text:m}),h&&h.length>0&&w.push(...h);const b=new Date().toLocaleString("sv-SE");if(w.length>0){const u=w.length===1&&w[0].type==="text"?w[0].text:w;W.value.push({role:"user",content:u}),T.value.push({id:Le.value++,role:"user",content:w,timestamp:b}),Rt()}else return}else return;dt.value=""}ye.value=!0,Ae.value=new AbortController,await he(),de.value=!0,_t("auto");const t=p.value.prompts[z.value],o=!!Se.value;let l=t?.stream&&!o,c=0,f=-1;try{const{OpenAI:h}=await Et(async()=>{const{OpenAI:w}=await import("./index-CRSldtV4.js");return{OpenAI:w}},[],import.meta.url),m=new h({apiKey:()=>window.api.getRandomItem(tt.value),baseURL:et.value,dangerouslyAllowBrowser:!0,maxRetries:3});for(;!Ae.value.signal.aborted;){I.value?.focus({cursor:"end"});let w=JSON.parse(JSON.stringify(W.value));if(w=w.filter(x=>!(x.role==="system"&&(!x.content||x.content.trim()===""))),w.forEach(x=>{Array.isArray(x.content)&&(x.content=x.content.filter(O=>!O.isTranscript),x.content.length===0&&(x.content=null)),["content","reasoning_content","extra_content"].forEach(O=>{x[O]===null&&delete x[O]})}),t&&t.ifTextNecessary){const x=new Date,O=`current time: ${x.getFullYear()}-${String(x.getMonth()+1).padStart(2,"0")}-${String(x.getDate()).padStart(2,"0")} ${String(x.getHours()).padStart(2,"0")}:${String(x.getMinutes()).padStart(2,"0")}`;w.forEach(A=>{A.role==="user"&&(A.content===void 0||A.content===null?A.content=O:typeof A.content=="string"?A.content.trim()===""&&(A.content=O):Array.isArray(A.content)&&(A.content.length===0?A.content=O:A.content.some(oe=>oe.type==="text"&&oe.text&&oe.text.trim()!=="")||A.content.push({type:"text",text:O})))})}let b="";if(Dt.value.length>0||Ye.value.length>0){b=Oa();const x=w.findIndex(O=>O.role==="system");x!==-1?w[x].content.includes("## Tool Use Rules")||(w[x].content+=b):w.unshift({role:"system",content:b})}const u={model:J.value.split("|")[1],messages:w,stream:l};t?.isTemperature&&(u.temperature=t.temperature),Je.value&&Je.value!=="default"&&(u.reasoning_effort=Je.value);let S=[...Dt.value];if(Ye.value.length>0&&p.value.skillPath)try{const x=await window.api.getSkillToolDefinition(p.value.skillPath,Ye.value);x&&S.push(x)}catch(x){console.error("Failed to generate skill tool definition:",x)}S.length>0&&(u.tools=S,u.tool_choice="auto"),o&&(u.stream=!1,l=!1,u.modalities=["text","audio"],u.audio={voice:Se.value.split("-")[0].trim(),format:"wav"});const V=Le.value++;T.value.push({id:V,role:"assistant",content:[],reasoning_content:"",status:"",aiName:Me.value[J.value]||J.value.split("|")[1],voiceName:Se.value,tool_calls:[]}),f=T.value.length-1,X.value&&_t("auto");let y;if(l){const x=await m.chat.completions.create(u,{signal:Ae.value.signal});let O="",A="",ee=[],oe=null,ie=Date.now();for await(const me of x){const ge=me.choices?.[0]?.delta;if(ge&&(ge.extra_content&&(oe={...oe,...ge.extra_content}),ge.thought_signature&&(oe=oe||{},oe.google=oe.google||{},oe.google.thought_signature=ge.thought_signature),ge.reasoning_content&&(O+=ge.reasoning_content,T.value[f].status!=="thinking"&&(T.value[f].status="thinking"),Date.now()-ie>100&&(T.value[f].reasoning_content=O,ie=Date.now())),ge.content&&(A+=ge.content,T.value[f].status=="thinking"&&(T.value[f].status="end"),Date.now()-ie>100&&(T.value[f].content=[{type:"text",text:A}],ie=Date.now())),ge.tool_calls))for(const te of ge.tool_calls){const We=te.index??ee.length;ee[We]||(ee[We]={id:"",type:"function",function:{name:"",arguments:""}});const Te=ee[We];te.id&&(Te.id=te.id),te.function?.name&&(Te.function.name=te.function.name),te.function?.arguments&&(Te.function.arguments+=te.function.arguments),te.extra_content&&(Te.extra_content={...Te.extra_content,...te.extra_content})}}y={role:"assistant",content:A||null,reasoning_content:O||null,extra_content:oe},ee.length>0&&(y.tool_calls=ee.filter(me=>me.id&&me.function.name))}else y=(await m.chat.completions.create(u,{signal:Ae.value.signal})).choices[0].message;y.tool_calls&&y.tool_calls.length>0&&y.tool_calls.forEach(x=>{x.function&&x.function.arguments&&(x.function.arguments=Bl(x.function.arguments))}),W.value.push(y);const Z=T.value[f];if(y.content&&(Z.content=[{type:"text",text:y.content}]),y.reasoning_content&&(Z.reasoning_content=y.reasoning_content,Z.status="end"),y.tool_calls&&y.tool_calls.length>0){c++,Z.tool_calls=y.tool_calls.map(O=>({id:O.id,name:O.function.name,args:O.function.arguments,result:"Á≠âÂæÖÊâπÂáÜ...",approvalStatus:fe.value?"approved":"waiting"})),await he();const x=await Promise.all(y.tool_calls.map(async O=>{const A=Z.tool_calls.find(ie=>ie.id===O.id);let ee;if(!fe.value)try{if(!await new Promise(me=>{Ve.value.set(O.id,me)}))return A&&(A.approvalStatus="rejected",A.result="Áî®Êà∑Â∑≤ÂèñÊ∂àÊâßË°å"),{tool_call_id:O.id,role:"tool",name:O.function.name,content:"User denied this tool execution."}}catch{}A&&(A.approvalStatus="executing",A.result="ÊâßË°å‰∏≠...");const oe=new AbortController;le.value.set(O.id,oe);try{const ie=JSON.parse(O.function.arguments);if(O.function.name==="Skill"){A&&(A.result=`Activating skill: ${ie.skill}...`);let me=null;const ge=tt.value,te=et.value,We=J.value.split("|")[1]||J.value,Te=$e=>{A&&(A.result=$e+`

[Skill (Sub-Agent) Running...]`)};if(me={apiKey:ge,baseUrl:te,model:We,tools:S.filter($e=>$e.function.name!=="sub_agent"),mcpSystemPrompt:b,onUpdate:Te},ee=await window.api.resolveSkillInvocation(p.value.skillPath,ie.skill,ie,me,le.value.get(O.id)?.signal||Ae.value.signal),A)if(ee.includes("[Sub-Agent]")){const $e=A.result?A.result.replace(`

[Skill (Sub-Agent) Running...]`,""):"";$e.includes(ee)?A.result=$e:A.result=`${$e}

=== Skill Execution Result ===
${ee}`}else A.result=`[Skill Instructions Loaded]
${ee}`}else{let me=null;if(O.function.name==="sub_agent"){const te=tt.value,We=et.value,Te=J.value.split("|")[1]||J.value,$e=S.filter(Tt=>Tt.function.name!=="sub_agent");me={apiKey:te,baseUrl:We,model:Te,tools:$e,mcpSystemPrompt:b,onUpdate:Tt=>{A&&(A.result=Tt+`

[Sub-Agent ÊâßË°å‰∏≠...]`)}}}const ge=await window.api.invokeMcpTool(O.function.name,ie,le.value.get(O.id)?.signal||Ae.value.signal,me);if(ee=Array.isArray(ge)?ge.filter(te=>te?.type==="text"&&typeof te.text=="string").map(te=>te.text).join(`

`):String(ge),A)if(O.function.name==="sub_agent"){const te=A.result?A.result.replace(`

[Sub-Agent ÊâßË°å‰∏≠...]`,""):"";te.includes(ee)?A.result=te:A.result=`${te}

=== ÊúÄÁªàÁªìÊûú ===
${ee}`}else A.result=ee}A&&(A.approvalStatus="finished")}catch(ie){ie.name==="AbortError"?(ee="Error: Tool call was canceled by the user.",A&&(A.approvalStatus="rejected")):(ee=`{'result':'Â∑•ÂÖ∑ÊâßË°åÊàñÂèÇÊï∞Ëß£ÊûêÈîôËØØ: ${ie.message}'}`,A&&(A.approvalStatus="finished")),A&&(A.result=ee)}finally{le.value.delete(O.id)}return{tool_call_id:O.id,role:"tool",name:O.function.name,content:ee}}));W.value.push(...x)}else{if(o&&y.audio){if(Z.content=Z.content||[],y.audio.transcript){const x=y.audio.transcript;Z.content.push({type:"text",text:`

${x}`,isTranscript:!0})}Z.content.push({type:"input_audio",input_audio:{data:y.audio.data,format:"wav"}})}break}}}catch(h){let m=`ÂèëÁîüÈîôËØØ: ${h.message||"Êú™Áü•ÈîôËØØ"}`;h.name==="AbortError"&&(m="ËØ∑Ê±ÇÂ∑≤ÂèñÊ∂à");const w=f>-1?f:T.value.length;f===-1&&T.value.push({id:Le.value++,role:"assistant",content:[],aiName:Me.value[J.value]||J.value.split("|")[1],voiceName:Se.value});const b=T.value[w];T.value[w].reasoning_content&&b.status==="thinking"&&(T.value[w].status="error");let u="";if(b.content&&Array.isArray(b.content)?u=b.content.filter(S=>S.type==="text").map(S=>S.text).join(""):typeof b.content=="string"&&(u=b.content),u&&u.trim().length>0){const S=`${u}

> **Error**: ${m}`;b.content=[{type:"text",text:S}],W.value.push({role:"assistant",content:S,reasoning_content:b.reasoning_content||null})}else b.content=[{type:"text",text:`${m}`}],W.value.push({role:"assistant",content:`${m}`,reasoning_content:b.reasoning_content||null})}finally{ye.value=!1,Ae.value=null,f>-1&&(T.value[f].completedTimestamp=new Date().toLocaleString("sv-SE")),await he(),I.value?.focus({cursor:"end"}),Rt()}},Fa=()=>{ye.value&&Ae.value&&(Ae.value.abort(),I.value?.focus())},Na=async(e,t)=>{ye.value&&t===T.value.length-1||await window.api.copyText(e)},To=async()=>{if(ye.value)return;const e=W.value.findLastIndex(o=>o.role!=="tool");if(e===-1){r.warning("Ê≤°ÊúâÂèØ‰ª•ÈáçÊñ∞ÊèêÈóÆÁöÑÁî®Êà∑Ê∂àÊÅØ");return}const t=W.value[e];if(t.role==="assistant"){const o=W.value.length-e,l=W.value.slice(e).filter(c=>c.role!=="tool").length;W.value.splice(e,o),l>0&&T.value.splice(T.value.length-l)}else if(t.role!=="user"){r.warning("Êó†Ê≥ï‰ªéÊ≠§Ê∂àÊÅØÁ±ªÂûãÈáçÊñ∞ÊèêÈóÆ„ÄÇ");return}De.value.clear(),await he(),await Lt(!0)},Ha=e=>{if(ye.value){r.warning("ËØ∑Á≠âÂæÖÂΩìÂâçÂõûÂ§çÂÆåÊàêÂêéÂÜçÊìç‰Ωú");return}if(e<0||e>=T.value.length)return;if(T.value[e]?.role==="system"){r.info("Á≥ªÁªüÊèêÁ§∫ËØç‰∏çËÉΩË¢´Âà†Èô§");return}let o=-1,l=-1;for(let V=0;V<W.value.length;V++)if(W.value[V].role!=="tool"&&l++,l===e){o=V;break}if(o===-1){console.error("ÂÖ≥ÈîÆÈîôËØØ: Êó†Ê≥ïÂ∞Ü chat_show Á¥¢ÂºïÊò†Â∞ÑÂà∞ history Á¥¢Âºï„ÄÇ‰∏≠Ê≠¢Âà†Èô§„ÄÇ"),r.error("Âà†Èô§Â§±Ë¥•ÔºöÊ∂àÊÅØÁä∂ÊÄÅ‰∏ç‰∏ÄËá¥„ÄÇ");return}const c=W.value[o];let f=o,h=o;if(c.role==="assistant"&&c.tool_calls&&c.tool_calls.length>0)for(;W.value[h+1]?.role==="tool";)h++;const m=h-f+1,w=1,b=e;m>0&&W.value.splice(f,m),T.value.splice(b,w);const u=e,S=new Set;for(const V of De.value)V<u?S.add(V):V>u&&S.add(V-1);De.value=S,N.value=null},Ua=()=>{if(ye.value)return;const e=p.value.prompts[z.value]?.prompt,t=W.value.length>0?W.value[0]:null,o=t&&t.role==="system"?t:null,l=e?{role:"system",content:e}:o;l?(W.value=[l],T.value=[{...l,id:Le.value++}]):(W.value=[],T.value=[]),De.value.clear(),P.clear(),N.value=null,ne.value="",I.value?.focus({cursor:"end"}),r.success("ÂéÜÂè≤ËÆ∞ÂΩïÂ∑≤Ê∏ÖÈô§")};function Eo(e){const t=j.value.indexOf(e);t===-1?j.value.push(e):j.value.splice(t,1)}async function Wa(e){const t=be.value.indexOf(e);t===-1?be.value.push(e):be.value.splice(t,1),j.value=[...be.value],await yt(!1)}const qa=()=>{setTimeout(()=>{I.value?.focus({cursor:"end"})},100)},ja=e=>{const t=le.value.get(e);t&&(t.abort(),r.info("Ê≠£Âú®ÂèñÊ∂àÂ∑•ÂÖ∑Ë∞ÉÁî®..."))};function Ao(e){if(!e)return"";const t=/^streamable[\s_-]?http$/i,o=e.toLowerCase();return o==="builtin"?"ÂÜÖÁΩÆ":t.test(o)||o==="http"?"ÂèØÊµÅÂºè HTTP":e}const Ka=async e=>{if(!z.value||!p.value.prompts[z.value]){r.warning("Êó†Ê≥ï‰øùÂ≠òÊ®°ÂûãÔºåÂõ†‰∏∫ÂΩìÂâç‰∏çÊòØ‰∏Ä‰∏™Â∑≤ÂÆö‰πâÁöÑÂø´Êç∑Âä©Êâã„ÄÇ");return}try{const t=await window.api.saveSetting(`prompts.${z.value}.model`,e);if(ot.value=!1,t&&t.success)p.value.prompts[z.value].model=e,r.success(`Ê®°ÂûãÂ∑≤‰∏∫Âø´Êç∑Âä©Êâã "${z.value}" ‰øùÂ≠òÊàêÂäüÔºÅ`);else throw new Error(t?.message||"‰øùÂ≠òÂ§±Ë¥•")}catch(t){console.error("‰øùÂ≠òÊ®°ÂûãÂ§±Ë¥•:",t),r.error(`‰øùÂ≠òÊ®°ÂûãÂ§±Ë¥•: ${t.message}`)}ot.value=!1},Io=e=>{const t=e.target;if(!(t instanceof HTMLImageElement)||!t.closest(".markdown-wrapper"))return;e.preventDefault();const o=t.src;if(t.parentNode&&t.parentNode.classList.contains("image-error-container"))return;const l=document.createElement("div");l.className="image-error-container",l.title="ÂõæÁâáÂä†ËΩΩÂ§±Ë¥•ÔºåÁÇπÂáªÈáçËØï";const c=document.createElementNS("http://www.w3.org/2000/svg","svg");c.setAttribute("viewBox","0 0 24 24"),c.innerHTML='<path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z" fill="currentColor"></path>';const f=document.createElement("span");f.textContent="Image",l.appendChild(c),l.appendChild(f),t.parentNode&&t.parentNode.replaceChild(l,t),l.onclick=h=>{h.stopPropagation();const m=document.createElement("img");m.src=`${o}?t=${new Date().getTime()}`,l.parentNode&&l.parentNode.replaceChild(m,l)}},Bo=e=>{const t=e.ctrlKey||e.metaKey;if(t&&e.key.toLowerCase()==="s"){if(e.preventDefault(),ye.value){r.warning("ËØ∑Á≠âÂæÖ AI ÂõûÂ§çÂÆåÊàêÂêéÂÜç‰øùÂ≠ò");return}if(document.querySelector(".el-dialog, .el-message-box"))return;_o();return}if(t){if(e.key==="0"){e.preventDefault(),ue.value=1,r.info("Áº©ÊîæÂ∑≤ÈáçÁΩÆ (100%)");return}if(e.key==="="||e.key==="+"){e.preventDefault();const o=ue.value+.1;ue.value=Math.min(2,o),r.info(`Áº©Êîæ: ${Math.round(ue.value*100)}%`);return}if(e.key==="-"){e.preventDefault();const o=ue.value-.1;ue.value=Math.max(.5,o),r.info(`Áº©Êîæ: ${Math.round(ue.value*100)}%`);return}}},Za=()=>{je&&je.show()};return(e,t)=>(_(),D(Re,null,[s("main",null,[st.value?(_(),D("div",zl)):ae("",!0),s("div",{class:Ce(["window-bg-layer",{"is-visible":!!st.value}]),style:No({backgroundImage:st.value?`url('${st.value}')`:"none",opacity:st.value?Bt.value:0,filter:`blur(${Ke.value}px)`})},null,6),n(a(dn),{class:Ce(["app-container",{"has-bg":!!st.value}])},{default:i(()=>[n(qn,{favicon:we.value,promptName:z.value,conversationName:ne.value,isAlwaysOnTop:kt.value,autoCloseOnBlur:se.value,isDarkMode:p.value.isDarkMode,os:St.value,onSaveWindowSize:aa,onSaveSession:ia,onTogglePin:Xt,onToggleAlwaysOnTop:sa,onMinimize:M,onMaximize:B,onClose:F},null,8,["favicon","promptName","conversationName","isAlwaysOnTop","autoCloseOnBlur","isDarkMode","os"]),n(Qn,{modelMap:Me.value,model:J.value,"is-mcp-loading":Vt.value,systemPrompt:pe.value,onOpenModelDialog:na,onShowSystemPrompt:xo,onOpenSearch:Za},null,8,["modelMap","model","is-mcp-loading","systemPrompt"]),s("div",Dl,[n(a(cn),{ref_key:"chatContainerRef",ref:Y,class:"chat-main custom-scrollbar",onClick:Yt,onScroll:ea},{default:i(()=>[(_(!0),D(Re,null,lt(T.value,(o,l)=>(_(),_e(a(E),{key:o.id,"is-auto-approve":fe.value,onUpdateAutoApprove:Uo,onConfirmTool:mt,onRejectTool:mt,ref_for:!0,ref:c=>Ct(c,o.id),message:o,index:l,"is-last-message":l===T.value.length-1,"is-loading":ye.value,"user-avatar":ke.value,"ai-avatar":Be.value,"is-collapsed":wo(l),"is-dark-mode":p.value.isDarkMode,onDeleteMessage:ra,onCopyText:ca,onReAsk:ua,onToggleCollapse:da,onShowSystemPrompt:xo,onAvatarClick:pa,onEditMessageRequested:Ca,onEditFinished:ka,onEditMessage:So,onCancelToolCall:ja},null,8,["is-auto-approve","message","index","is-last-message","is-loading","user-avatar","ai-avatar","is-collapsed","is-dark-mode"]))),128))]),_:1},512),K.value?(_(),D("div",Pl,[n(a(ce),{content:"ÂõûÂà∞È°∂ÈÉ®",placement:"left","show-after":500},{default:i(()=>[n(a(R),{class:"scroll-nav-btn",onClick:Qo},{default:i(()=>[n(a(H),{size:14},{default:i(()=>t[26]||(t[26]=[s("svg",{viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},[s("path",{d:"M492.367 74.709h46.406L960 503.076l-46.406 46.406-403.379-403.378-399.809 403.378L64 503.076 492.367 74.709z m0 399.809h46.406L960 902.884l-46.406 46.406-403.379-399.808-399.809 399.809L64 902.884l428.367-428.366z"})],-1)])),_:1})]),_:1})]),_:1}),n(a(ce),{content:"‰∏ä‰∏ÄÊù°Ê∂àÊÅØ",placement:"left","show-after":500},{default:i(()=>[n(a(R),{class:"scroll-nav-btn",onClick:ta},{default:i(()=>[n(a(H),{size:14},{default:i(()=>t[27]||(t[27]=[s("svg",{viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},[s("path",{d:"M902.5 749.2l57.5-57.5-421.6-416.9h-52.7L64 691.7l57.5 57.5 388.1-392.9 392.9 392.9z"})],-1)])),_:1})]),_:1})]),_:1}),n(a(ce),{content:Go.value,placement:"left","show-after":500},{default:i(()=>[n(a(R),{class:"scroll-nav-btn",onClick:oa},{default:i(()=>[n(a(H),{size:14},{default:i(()=>t[28]||(t[28]=[s("svg",{viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},[s("path",{d:"M121.5 274.8L64 332.3l421.6 416.9h52.7l421.6-416.9-57.5-57.5-388.1 392.9-392.8-392.9z"})],-1)])),_:1})]),_:1})]),_:1},8,["content"]),n(a(ce),{content:"Ë∑≥Âà∞Â∫ïÈÉ®",placement:"left","show-after":500},{default:i(()=>[n(a(R),{class:"scroll-nav-btn",onClick:ho},{default:i(()=>[n(a(H),{size:14},{default:i(()=>t[29]||(t[29]=[s("svg",{viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},[s("path",{d:"M535.203 545.912h-46.406L64 121.116l46.406-46.406 403.378 399.809 399.81-399.81L960 121.116 535.203 545.912z m0 403.379h-46.406L64 524.494l46.406-49.976 403.378 403.379 399.809-403.379L960 524.494 535.203 949.291z"})],-1)])),_:1})]),_:1})]),_:1})])):ae("",!0),n(Ll,{ref_key:"chatInputRef",ref:I,prompt:dt.value,"onUpdate:prompt":t[0]||(t[0]=o=>dt.value=o),fileList:ze.value,"onUpdate:fileList":t[1]||(t[1]=o=>ze.value=o),selectedVoice:Se.value,"onUpdate:selectedVoice":t[2]||(t[2]=o=>Se.value=o),tempReasoningEffort:Je.value,"onUpdate:tempReasoningEffort":t[3]||(t[3]=o=>Je.value=o),loading:ye.value,ctrlEnterToSend:p.value.CtrlEnterToSend,layout:jt.value,voiceList:p.value.voiceList,"is-mcp-active":qo.value,"all-mcp-servers":fo.value,"active-mcp-ids":be.value,"active-skill-ids":Ye.value,onSubmit:fa,onCancel:va,onClearHistory:ma,onRemoveFile:ga,onUpload:ha,onSendAudio:ya,onOpenMcpDialog:wa,onPickFileStart:$a,onToggleMcp:Wa,onOpenSkillDialog:Zo},null,8,["prompt","fileList","selectedVoice","tempReasoningEffort","loading","ctrlEnterToSend","layout","voiceList","is-mcp-active","all-mcp-servers","active-mcp-ids","active-skill-ids"])])]),_:1},8,["class"])]),n(Al,{modelValue:ot.value,"onUpdate:modelValue":t[4]||(t[4]=o=>ot.value=o),modelList:Ue.value,currentModel:J.value,onSelect:la,onSaveModel:Ka},null,8,["modelValue","modelList","currentModel"]),n(a(Ht),{modelValue:it.value,"onUpdate:modelValue":t[7]||(t[7]=o=>it.value=o),title:"","custom-class":"system-prompt-dialog",width:"60%","show-close":!1,"lock-scroll":!1,"append-to-body":!0,center:"","close-on-click-modal":!0,"close-on-press-escape":!0},{header:i(({close:o,titleId:l,titleClass:c})=>t[30]||(t[30]=[s("div",{style:{display:"none"}},null,-1)])),footer:i(()=>[n(a(R),{onClick:t[6]||(t[6]=o=>it.value=!1)},{default:i(()=>t[31]||(t[31]=[q("ÂèñÊ∂à")])),_:1}),n(a(R),{type:"primary",onClick:$o},{default:i(()=>t[32]||(t[32]=[q("‰øùÂ≠ò")])),_:1})]),default:i(()=>[n(a(nt),{modelValue:v.value,"onUpdate:modelValue":t[5]||(t[5]=o=>v.value=o),type:"textarea",autosize:{minRows:4,maxRows:15},class:"system-prompt-full-content",resize:"none",onKeydown:Sa},null,8,["modelValue"])]),_:1},8,["modelValue"]),d.value?(_(),_e(a(pn),{key:0,"url-list":k.value,"initial-index":G.value,onClose:t[8]||(t[8]=o=>d.value=!1),"hide-on-click-modal":!0,teleported:""},null,8,["url-list","initial-index"])):ae("",!0),d.value?(_(),D("div",Vl,[n(a(R),{type:"primary",icon:a(fn),circle:"",onClick:t[9]||(t[9]=o=>ba(k.value[0])),title:"Â§çÂà∂ÂõæÁâá"},null,8,["icon"]),n(a(R),{type:"primary",icon:a(io),circle:"",onClick:t[10]||(t[10]=o=>xa(k.value[0])),title:"‰∏ãËΩΩÂõæÁâá"},null,8,["icon"])])):ae("",!0),n(a(Ht),{modelValue:gt.value,"onUpdate:modelValue":t[19]||(t[19]=o=>gt.value=o),width:"80%","custom-class":"mcp-dialog no-header-dialog",onClose:qa,"show-close":!1},{header:i(()=>t[33]||(t[33]=[s("div",{style:{display:"none"}},null,-1)])),footer:i(()=>[s("div",os,[s("div",as,[s("span",{class:Ce(["mcp-limit-hint",{warning:po.value>5}])},[q(" ËøûÊé•Êï∞Ôºö"+Q(5-po.value)+"/5 ",1),n(a(ce),{placement:"top"},{content:i(()=>t[40]||(t[40]=[q(" ÊåÅ‰πÖËøûÊé•ÂêÑÂç†1‰∏™ÂêçÈ¢ù"),s("br",null,null,-1),q(" ÊâÄÊúâ‰∏¥Êó∂ËøûÊé•ÂÖ±Âç†1‰∏™ÂêçÈ¢ù ")])),default:i(()=>[n(a(H),{style:{"vertical-align":"middle","margin-left":"4px",cursor:"help"}},{default:i(()=>[n(a(hn))]),_:1})]),_:1})],2),n(a(so),{modelValue:fe.value,"onUpdate:modelValue":t[17]||(t[17]=o=>fe.value=o),label:"Ëá™Âä®ÊâπÂáÜÂ∑•ÂÖ∑Ë∞ÉÁî®",style:{"margin-left":"40px","margin-right":"0"}},null,8,["modelValue"])]),s("div",null,[n(a(R),{type:"primary",onClick:t[18]||(t[18]=o=>{be.value=[...j.value],yt()})},{default:i(()=>t[41]||(t[41]=[q("Â∫îÁî®")])),_:1})])])]),default:i(()=>[s("div",Rl,[s("div",Ol,[n(a(Ft),null,{default:i(()=>[n(a(R),{type:rt.value==="all"?"primary":"",onClick:t[11]||(t[11]=o=>rt.value="all")},{default:i(()=>t[34]||(t[34]=[q("ÂÖ®ÈÉ®")])),_:1},8,["type"]),n(a(R),{type:rt.value==="selected"?"primary":"",onClick:t[12]||(t[12]=o=>rt.value="selected")},{default:i(()=>t[35]||(t[35]=[q("Â∑≤ÈÄâ ")])),_:1},8,["type"]),n(a(R),{type:rt.value==="unselected"?"primary":"",onClick:t[13]||(t[13]=o=>rt.value="unselected")},{default:i(()=>t[36]||(t[36]=[q("Êú™ÈÄâ ")])),_:1},8,["type"])]),_:1}),n(a(Ft),null,{default:i(()=>[n(a(R),{onClick:Da},{default:i(()=>t[37]||(t[37]=[q("ÂÖ®ÈÄâ")])),_:1}),n(a(R),{onClick:za},{default:i(()=>t[38]||(t[38]=[q("Ê∏ÖÁ©∫")])),_:1})]),_:1})]),s("div",Fl,[(_(!0),D(Re,null,lt(vo.value,o=>(_(),D("div",{key:o.id,class:"mcp-server-item-wrapper"},[s("div",{class:Ce(["mcp-server-item",{"is-checked":j.value.includes(o.id)}]),onClick:l=>Eo(o.id)},[s("div",Hl,[s("div",Ul,[n(a(so),{"model-value":j.value.includes(o.id),size:"large",onChange:()=>Eo(o.id),onClick:t[14]||(t[14]=Xe(()=>{},["stop"])),class:"header-checkbox"},null,8,["model-value","onChange"]),n(a(Po),{src:o.logoUrl,shape:"square",size:20,class:"mcp-server-icon"},{default:i(()=>[n(a(H),{size:12},{default:i(()=>[n(a(vn))]),_:1})]),_:2},1032,["src"]),s("span",Wl,[q(Q(o.name)+" ",1),Kt(o.id)?(_(),D("span",ql," ("+Q(Kt(o.id).enabled)+"/"+Q(Kt(o.id).total)+") ",1)):ae("",!0)]),s("div",jl,[n(a(ce),{content:o.isPersistent?"ÊåÅ‰πÖËøûÊé•Â∑≤ÂºÄÂêØ":"ÊåÅ‰πÖËøûÊé•Â∑≤ÂÖ≥Èó≠",placement:"top"},{default:i(()=>[n(a(R),{text:"",circle:"",class:Ce([{"is-persistent-active":o.isPersistent},"persistent-btn"]),onClick:Xe(l=>Va(o.id,!o.isPersistent),["stop"])},{default:i(()=>[n(a(H),{size:16},{default:i(()=>t[39]||(t[39]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[s("polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2"})],-1)])),_:1})]),_:2},1032,["class","onClick"])]),_:2},1032,["content"]),s("div",Kl,[o.type?(_(),_e(a(Vo),{key:0,type:"info",size:"small",effect:"plain",round:""},{default:i(()=>[q(Q(Ao(o.type)),1)]),_:2},1024)):ae("",!0),(_(!0),D(Re,null,lt((o.tags||[]).slice(0,2),l=>(_(),_e(a(Vo),{key:l,size:"small",effect:"plain",round:""},{default:i(()=>[q(Q(l),1)]),_:2},1024))),128))])])]),s("div",Zl,[s("div",{class:"mcp-tools-toggle",onClick:Xe(l=>uo(o.id),["stop"])},[n(a(H),{class:Ce({"is-expanded":ht.value.has(o.id)})},{default:i(()=>[n(a(mn))]),_:2},1032,["class"]),s("span",null,Q(ht.value.has(o.id)?"Êî∂Ëµ∑":"Â∑•ÂÖ∑"),1)],8,Jl),o.description?(_(),D("span",{key:0,class:"mcp-server-description",onClick:Xe(l=>uo(o.id),["stop"])},Q(o.description),9,Yl)):ae("",!0)])])],10,Nl),ht.value.has(o.id)?(_(),D("div",{key:0,class:"mcp-tools-panel",onClick:t[15]||(t[15]=Xe(()=>{},["stop"]))},[pt.value[o.id]&&pt.value[o.id].length>0?(_(!0),D(Re,{key:0},lt(pt.value[o.id],l=>(_(),D("div",{key:l.name,class:"mcp-tool-row"},[n(a(gn),{"model-value":l.enabled!==!1,size:"small",onChange:c=>Wo(o.id,l.name,c)},null,8,["model-value","onChange"]),s("div",Xl,[s("span",Gl,Q(l.name),1),s("span",{class:"mcp-tool-desc",title:l.description},Q(l.description||"ÊöÇÊó†ÊèèËø∞"),9,Ql)])]))),128)):(_(),D("div",es," Â∑•ÂÖ∑Êú™ÁºìÂ≠òÔºå‰ΩøÁî®/ÊµãËØïÂêéÂç≥ÂèØÊü•ÁúãÂÖ∑‰ΩìÂ∑•ÂÖ∑ "))])):ae("",!0)]))),128))]),s("div",ts,[n(a(nt),{modelValue:Pt.value,"onUpdate:modelValue":t[16]||(t[16]=o=>Pt.value=o),placeholder:"ÊêúÁ¥¢Â∑•ÂÖ∑ÂêçÁß∞ÊàñÊèèËø∞...","prefix-icon":a(qt),clearable:""},null,8,["modelValue","prefix-icon"])])])]),_:1},8,["modelValue"]),n(a(Ht),{modelValue:wt.value,"onUpdate:modelValue":t[25]||(t[25]=o=>wt.value=o),width:"80%","custom-class":"mcp-dialog no-header-dialog","show-close":!1},{header:i(()=>t[42]||(t[42]=[s("div",{style:{display:"none"}},null,-1)])),footer:i(()=>[s("div",ms,[s("div",gs,[Ie.value.length>0?(_(),D("span",hs," Â∑≤ÈÄâ "+Q(Ie.value.length)+" ‰∏™ÊäÄËÉΩ ",1)):ae("",!0),s("span",ws,[n(a(H),{style:{"margin-right":"4px"}},{default:i(()=>[n(a(yn))]),_:1}),t[48]||(t[48]=q(" Skill ‰æùËµñÂÜÖÁΩÆ MCP ÊúçÂä°ÔºåËØ∑ÂãøÁ¶ÅÁî® "))])]),n(a(R),{type:"primary",onClick:Yo},{default:i(()=>t[49]||(t[49]=[q("Á°ÆÂÆö")])),_:1})])]),default:i(()=>[s("div",ns,[s("div",ls,[n(a(Ft),null,{default:i(()=>[n(a(R),{type:at.value==="all"?"primary":"",onClick:t[20]||(t[20]=o=>at.value="all")},{default:i(()=>t[43]||(t[43]=[q("ÂÖ®ÈÉ®")])),_:1},8,["type"]),n(a(R),{type:at.value==="selected"?"primary":"",onClick:t[21]||(t[21]=o=>at.value="selected")},{default:i(()=>t[44]||(t[44]=[q("Â∑≤ÈÄâ")])),_:1},8,["type"]),n(a(R),{type:at.value==="unselected"?"primary":"",onClick:t[22]||(t[22]=o=>at.value="unselected")},{default:i(()=>t[45]||(t[45]=[q("Êú™ÈÄâ")])),_:1},8,["type"])]),_:1}),n(a(Ft),null,{default:i(()=>[n(a(R),{onClick:jo},{default:i(()=>t[46]||(t[46]=[q("ÂÖ®ÈÄâ")])),_:1}),n(a(R),{onClick:Ko},{default:i(()=>t[47]||(t[47]=[q("Ê∏ÖÁ©∫")])),_:1})]),_:1})]),s("div",ss,[Zt.value.length===0?(_(),D("div",is," ÊöÇÊó†ÂåπÈÖçÁöÑÊäÄËÉΩ ")):(_(!0),D(Re,{key:1},lt(Zt.value,o=>(_(),D("div",{key:o.name,class:"mcp-server-item-wrapper"},[s("div",{class:Ce(["mcp-server-item",{"is-checked":Ie.value.includes(o.name)}]),onClick:l=>go(o.name)},[s("div",cs,[n(a(so),{"model-value":Ie.value.includes(o.name),size:"large",onChange:()=>go(o.name),onClick:t[23]||(t[23]=Xe(()=>{},["stop"])),class:"header-checkbox"},null,8,["model-value","onChange"]),n(a(Po),{shape:"square",size:20,class:"mcp-server-icon",style:{background:"transparent",color:"var(--el-text-color-primary)","flex-shrink":"0"}},{default:i(()=>[n(a(H),{size:16},{default:i(()=>[n(a(Ho))]),_:1})]),_:1}),s("span",us,Q(o.name),1),s("span",{class:"skill-desc-inline",title:o.description},Q(o.description),9,ds),s("div",ps,[n(a(ce),{content:o.context==="fork"?"Sub-Agent Ê®°ÂºèÂ∑≤ÂºÄÂêØ":"Sub-Agent Ê®°ÂºèÂ∑≤ÂÖ≥Èó≠",placement:"top"},{default:i(()=>[s("div",{class:Ce(["subagent-toggle-btn-small",{"is-active":o.context==="fork"}]),onClick:Xe(l=>Jo(o),["stop"])},[n(a(H),{size:14},{default:i(()=>[n(a(wn))]),_:1})],10,fs)]),_:2},1032,["content"])])])],10,rs)]))),128))]),s("div",vs,[n(a(nt),{modelValue:$t.value,"onUpdate:modelValue":t[24]||(t[24]=o=>$t.value=o),placeholder:"ÊêúÁ¥¢ÊäÄËÉΩÂêçÁß∞ÊàñÊèèËø∞...","prefix-icon":a(qt),clearable:""},null,8,["modelValue","prefix-icon"])])])]),_:1},8,["modelValue"])],64))}},bs=At(ys,[["__scopeId","data-v-605b3cce"]]),xs=bn(bs);xs.mount("#app");export{At as _,$s as a,Nt as f,Bl as s};
